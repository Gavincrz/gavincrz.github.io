<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Study Notes - 2021/03/29"><meta name="keywords" content="Study Notes,Penetration Testing"><meta name="author" content="Gavin Cui"><meta name="copyright" content="Gavin Cui"><title>Study Notes - 2021/03/29 | Gavin's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">1.</span> <span class="toc-text">Privilege Escalation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Manual-Enumeration"><span class="toc-number">1.1.</span> <span class="toc-text">Manual Enumeration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-OS-version"><span class="toc-number">1.2.</span> <span class="toc-text">Enumerating OS version</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Running-processes-and-services"><span class="toc-number">1.3.</span> <span class="toc-text">Running processes and services</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-Network-information"><span class="toc-number">1.4.</span> <span class="toc-text">Enumerating Network information</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-Firewall-Status-and-Rules"><span class="toc-number">1.5.</span> <span class="toc-text">Enumerating Firewall Status and Rules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-Scheduled-tasks"><span class="toc-number">1.6.</span> <span class="toc-text">Enumerating Scheduled tasks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-Installed-app-and-patch-levels"><span class="toc-number">1.7.</span> <span class="toc-text">Enumerating Installed app and patch levels</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-readble-and-writable-dirs"><span class="toc-number">1.8.</span> <span class="toc-text">Enumerating readble and writable dirs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-Unmounted-Disks"><span class="toc-number">1.9.</span> <span class="toc-text">Enumerating Unmounted Disks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-Device-Drivers-and-Kernel-Modules"><span class="toc-number">1.10.</span> <span class="toc-text">Enumerating Device Drivers and Kernel Modules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-Binaries-That-AutoElevate"><span class="toc-number">1.11.</span> <span class="toc-text">Enumerating Binaries That AutoElevate</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gavin Cui</div><div class="author-info__description text-center">No Description</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">23</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">8</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gavin's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Study Notes - 2021/03/29</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-29</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h1><h2 id="Manual-Enumeration"><a href="#Manual-Enumeration" class="headerlink" title="Manual Enumeration"></a>Manual Enumeration</h2><p>enumerating users:<br><code>whoami</code> work both for win and linux<br>windows: <code>net user &lt;username&gt;</code><br>Linux: <code>id</code><br>reveal other users :<br>windows: <code>net user</code><br>linux: <code>cat /etc/passwd</code>  </p>
<p>enumeratin hostname:<br><code>hostname</code>  </p>
<h2 id="Enumerating-OS-version"><a href="#Enumerating-OS-version" class="headerlink" title="Enumerating OS version"></a>Enumerating OS version</h2><p>Windows: systeminfo<br>linux: <code>cat /etc/issue</code><br><code>cat /etc/*-release</code><br><code>uname -a</code>  </p>
<h2 id="Running-processes-and-services"><a href="#Running-processes-and-services" class="headerlink" title="Running processes and services"></a>Running processes and services</h2><p><code>tasklist /SVC</code><br>/SVC                    Displays services hosted in each process.<br><strong>Does not list task run by privieleged users</strong>  </p>
<p>linux:<br><code>ps aux</code>  </p>
<h2 id="Enumerating-Network-information"><a href="#Enumerating-Network-information" class="headerlink" title="Enumerating Network information"></a>Enumerating Network information</h2><p>windows:<br><code>ipconfig /all</code><br><code>route print</code>  route information<br><code>netstat -ano</code>  network connections<br>-a display all active tcp connections<br>-n            Displays addresses and port numbers in numerical form.<br>-o            Displays the owning process ID associated with each connection.  </p>
<p>Linux:<br><code>ifconfig -a</code><br><code>ip a</code><br><code>/sbin/route</code><br><code>ss -anp</code><br><code>netstat -anp</code>  </p>
<h2 id="Enumerating-Firewall-Status-and-Rules"><a href="#Enumerating-Firewall-Status-and-Rules" class="headerlink" title="Enumerating Firewall Status and Rules"></a>Enumerating Firewall Status and Rules</h2><p>windows:<br><code>netsh advfirewall show currentprofile</code><br>list the firewall rules:<br><code>netsh advfirewall firewall show rule name=all</code>  </p>
<p>Linux: must have root privilege to access firewall rules<br>For example, the iptables-persistent464 package on Debian Linux saves firewall rules in specific<br>files under the /etc/iptables directory by default. These files are used by the system to restore<br>netfilter465 rules at boot time. These files are often left with weak permissions, allowing them to<br>be read by any local user on the target system.  </p>
<p>grep -Hs iptables /etc/*<br>-H display file name with file number<br>-s suppress error messages </p>
<h2 id="Enumerating-Scheduled-tasks"><a href="#Enumerating-Scheduled-tasks" class="headerlink" title="Enumerating Scheduled tasks"></a>Enumerating Scheduled tasks</h2><p><code>schtasks /query /fo LIST /v</code><br>/query argument displays tasks and /FO LIST sets the output format to a simple list. We can also use /V to request verbose output.</p>
<p>Linux:<br>The Linux-based job scheduler is known as Cron.467 Scheduled tasks are listed under the /etc/cron.* directories </p>
<p>ls -lah /etc/cron*  sometimes need permision<br>-h human readable  </p>
<p>cat /etc/crontab  </p>
<p>if those script have a weak permissions, we change change it and escalate pribilege  </p>
<h2 id="Enumerating-Installed-app-and-patch-levels"><a href="#Enumerating-Installed-app-and-patch-levels" class="headerlink" title="Enumerating Installed app and patch levels"></a>Enumerating Installed app and patch levels</h2><p><code>wmic product get name, version, vendor</code>  </p>
<p>We can use wmic with the <strong>product</strong> WMI class argument followed by <strong>get</strong>, which, as the name states, is used to retrieve specific property values. We can then choose the properties we are interested in, such as name, version, and vendor  </p>
<p>note: product class only list application installed by the windows installer  </p>
<p>Similarly, and more importantly, wmic can also be used to list system-wide updates by querying the Win32_QuickFixEngineering (qfe) WMI class.<br><code>wmic qfe get Caption, Description, HotFixID, InstalledOn</code>  </p>
<p>Linux:<br>Debian based:<br>dpkg -l<br>Redhat based:<br>rpm  </p>
<h2 id="Enumerating-readble-and-writable-dirs"><a href="#Enumerating-readble-and-writable-dirs" class="headerlink" title="Enumerating readble and writable dirs"></a>Enumerating readble and writable dirs</h2><p><strong>Accesschk</strong>:<br>enumerate the Program Files directory in search of any file or directory that allows the Everyone group write permissions  </p>
<p>We will use -u to suppress errors, -w to search for write access permissions, and -s to perform a recursive search.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accesschk.exe -uws &quot;Everyone&quot; &quot;C:\Program Files&quot;</span><br></pre></td></tr></table></figure>
<p>powershell:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ChildItem &quot;C:\Program Files&quot; -Recurse | Get-ACL | ?&#123;$_.AccessToString -match &quot;Everyone\sAllow\s\sModify&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>Linux:  -type d to locate directories</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -writable -type d 2&gt;&#x2F;dev&#x2F;null  </span><br></pre></td></tr></table></figure>


<h2 id="Enumerating-Unmounted-Disks"><a href="#Enumerating-Unmounted-Disks" class="headerlink" title="Enumerating Unmounted Disks"></a>Enumerating Unmounted Disks</h2><p><code>mountvol</code><br>On Linux-based systems, we can use the <code>mount</code> command to list all mounted filesystems. In addition, the <code>/etc/fstab </code>file lists all drives that will be mounted at boot time.<br>use <code>lsblk</code> to view all available disks  </p>
<h2 id="Enumerating-Device-Drivers-and-Kernel-Modules"><a href="#Enumerating-Device-Drivers-and-Kernel-Modules" class="headerlink" title="Enumerating Device Drivers and Kernel Modules"></a>Enumerating Device Drivers and Kernel Modules</h2><p>powershell: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driverquery.exe &#x2F;v &#x2F;fo csv | ConvertFrom-CSV | Select-Object &#39;Display Name&#39;, &#39;Start Mode&#39;, Path</span><br></pre></td></tr></table></figure>

<p>find version number of each module: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object &#123;$_.DeviceName -like &quot;*VMware*&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>Linux:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsmod</span><br><span class="line">&#x2F;sbin&#x2F;modinfo libata  </span><br></pre></td></tr></table></figure>
<p>modinfo require full path name to run  </p>
<h2 id="Enumerating-Binaries-That-AutoElevate"><a href="#Enumerating-Binaries-That-AutoElevate" class="headerlink" title="Enumerating Binaries That AutoElevate"></a>Enumerating Binaries That AutoElevate</h2><p>First, on Windows systems, we should check the status of the <code>AlwaysInstallElevated</code> registry setting. If this key is enabled (set to 1) in either <code>HKEY_CURRENT_USER</code> or <code>HKEY_LOCAL_MACHINE</code>, any user can run Windows Installer packages with elevated privileges.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line">reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer</span><br></pre></td></tr></table></figure>

<p>If this setting is enabled, we could craft an MSI file and run it to elevate our privileges</p>
<p>Linux:<br>find suid-marked binaries, the binary will be executed with the file ownerâ€™s permission</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Gavin Cui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://gavincrz.github.io/2021/03/29/Study-Notes-2021-03-29/">https://gavincrz.github.io/2021/03/29/Study-Notes-2021-03-29/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Study-Notes/">Study Notes</a><a class="post-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/23/Study-Notes-2021-04-23/"><i class="fa fa-chevron-left">  </i><span>Study Notes - 2021/04/23</span></a></div><div class="next-post pull-right"><a href="/2021/03/23/Study-Notes-2021-03-24/"><span>Study Notes - 2021/03/24</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Gavin Cui</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>